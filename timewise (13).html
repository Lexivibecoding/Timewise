<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TimeWise - Time Management App</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'DM Sans', -apple-system, BlinkMacSystemFont, sans-serif;
      background: linear-gradient(135deg, #f5f7f5 0%, #e8f0e8 100%);
      min-height: 100vh;
      color: #2d5a3d;
    }

    #root {
      min-height: 100vh;
    }

    .countdown-bar {
      background: linear-gradient(90deg, #2d5a3d 0%, #4a7c59 100%);
      color: white;
      padding: 12px 24px;
      display: flex;
      gap: 32px;
      align-items: center;
      box-shadow: 0 2px 8px rgba(45, 90, 61, 0.15);
    }

    .countdown-item {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 14px;
      font-weight: 500;
    }

    .countdown-settings {
      margin-left: auto;
      background: rgba(255, 255, 255, 0.2);
      border: none;
      color: white;
      padding: 6px 10px;
      border-radius: 6px;
      cursor: pointer;
      display: flex;
      align-items: center;
      transition: all 0.2s;
    }

    .countdown-settings:hover {
      background: rgba(255, 255, 255, 0.3);
    }

    .app-header {
      background: white;
      padding: 20px 24px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 32px;
    }

    h1 {
      font-size: 28px;
      font-weight: 700;
      color: #2d5a3d;
      letter-spacing: -0.5px;
    }

    .view-switcher {
      display: flex;
      gap: 4px;
      background: #f5f7f5;
      padding: 4px;
      border-radius: 8px;
    }

    .view-switcher button {
      padding: 8px 16px;
      border: none;
      background: transparent;
      color: #6b9b7a;
      font-weight: 500;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .view-switcher button.active {
      background: white;
      color: #2d5a3d;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }

    .header-right {
      display: flex;
      gap: 12px;
      align-items: center;
    }

    .btn-icon {
      background: white;
      border: 1px solid #e0e7e0;
      padding: 10px;
      border-radius: 8px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #4a7c59;
      transition: all 0.2s;
    }

    .btn-icon:hover {
      background: #f5f7f5;
      border-color: #6b9b7a;
    }

    .btn-primary {
      background: #4a7c59;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: all 0.2s;
    }

    .btn-primary:hover {
      background: #3d6749;
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(74, 124, 89, 0.3);
    }

    .btn-secondary {
      background: white;
      color: #4a7c59;
      border: 1px solid #4a7c59;
      padding: 10px 20px;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn-secondary:hover {
      background: #f5f7f5;
    }

    .calendar-nav {
      background: white;
      padding: 16px 24px;
      display: flex;
      align-items: center;
      gap: 16px;
      border-bottom: 1px solid #e0e7e0;
      flex-wrap: wrap;
    }

    .calendar-nav button {
      background: white;
      border: 1px solid #e0e7e0;
      padding: 8px 12px;
      border-radius: 6px;
      cursor: pointer;
      display: flex;
      align-items: center;
      color: #4a7c59;
      transition: all 0.2s;
    }

    .calendar-nav button:hover {
      background: #f5f7f5;
      border-color: #6b9b7a;
    }

    .calendar-nav h2 {
      font-size: 20px;
      font-weight: 600;
      color: #2d5a3d;
    }

    .btn-today {
      margin-left: auto;
      padding: 8px 16px;
      font-weight: 600;
    }

    .daily-toggle {
      display: flex;
      gap: 4px;
      background: #f5f7f5;
      padding: 4px;
      border-radius: 6px;
    }

    .daily-toggle button {
      padding: 6px 12px;
      border: none;
      background: transparent;
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 14px;
    }

    .daily-toggle button.active {
      background: white;
      box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
    }

    .main-content {
      padding: 24px;
      max-width: 1400px;
      margin: 0 auto;
    }

    .calendar-grid {
      background: white;
      border-radius: 12px;
      padding: 24px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    }

    .calendar-header {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 8px;
      margin-bottom: 16px;
    }

    .calendar-day-header {
      text-align: center;
      font-weight: 600;
      color: #6b9b7a;
      padding: 12px;
      font-size: 14px;
    }

    .calendar-body {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 8px;
    }

    .calendar-day {
      min-height: 120px;
      border: 1px solid #e0e7e0;
      border-radius: 8px;
      padding: 8px;
      background: #fafbfa;
      transition: all 0.2s;
    }

    .calendar-day:hover:not(.empty) {
      background: #f5f7f5;
      border-color: #6b9b7a;
      cursor: pointer;
    }

    .calendar-day.empty {
      background: transparent;
      border: none;
    }

    .calendar-day.today {
      background: #e8f5eb;
      border-color: #4a7c59;
    }

    .day-number {
      font-weight: 600;
      color: #2d5a3d;
      margin-bottom: 8px;
    }

    .day-events {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .event-item {
      font-size: 12px;
      padding: 6px 8px;
      background: white;
      border-left: 3px solid #4a7c59;
      border-radius: 4px;
      overflow: hidden;
      text-overflow: ellipsis;
      margin-bottom: 4px;
    }

    .event-item.planned {
      border-style: dashed;
    }

    .event-item.actual {
      border-style: solid;
    }

    .more-events {
      font-size: 11px;
      color: #6b9b7a;
      text-align: center;
      padding: 4px;
    }

    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(45, 90, 61, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      backdrop-filter: blur(4px);
    }

    .modal {
      background: white;
      padding: 32px;
      border-radius: 16px;
      max-width: 500px;
      width: 90%;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 20px 60px rgba(45, 90, 61, 0.3);
    }

    .modal h2 {
      margin-bottom: 24px;
      color: #2d5a3d;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: #4a7c59;
      font-size: 14px;
    }

    .form-group input,
    .form-group select,
    .form-group textarea {
      width: 100%;
      padding: 10px 12px;
      border: 1px solid #e0e7e0;
      border-radius: 8px;
      font-size: 14px;
      font-family: inherit;
      transition: all 0.2s;
    }

    .form-group input:focus,
    .form-group select:focus,
    .form-group textarea:focus {
      outline: none;
      border-color: #4a7c59;
      box-shadow: 0 0 0 3px rgba(74, 124, 89, 0.1);
    }

    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }

    .event-type-toggle {
      display: flex;
      gap: 8px;
    }

    .event-type-toggle button {
      flex: 1;
      padding: 10px;
      border: 1px solid #e0e7e0;
      background: white;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      color: #6b9b7a;
      transition: all 0.2s;
    }

    .event-type-toggle button.active {
      background: #4a7c59;
      color: white;
      border-color: #4a7c59;
    }

    .modal-actions {
      display: flex;
      gap: 12px;
      justify-content: flex-end;
      margin-top: 24px;
    }

    .category-list,
    .project-list {
      margin-bottom: 24px;
    }

    .category-item,
    .project-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px;
      background: #f5f7f5;
      border-radius: 8px;
      margin-bottom: 8px;
    }

    .category-color {
      width: 24px;
      height: 24px;
      border-radius: 6px;
      flex-shrink: 0;
    }

    .project-deadline {
      font-size: 12px;
      color: #6b9b7a;
    }

    .btn-delete {
      margin-left: auto;
      background: #ff6b6b;
      color: white;
      border: none;
      width: 28px;
      height: 28px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
      flex-shrink: 0;
    }

    .btn-delete:hover {
      background: #ff5252;
    }

    .analytics-panel {
      background: white;
      padding: 32px;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    }

    .analytics-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 32px;
    }

    .analytics-header select {
      padding: 8px 12px;
      border: 1px solid #e0e7e0;
      border-radius: 6px;
      font-size: 14px;
    }

    .category-stats {
      display: flex;
      flex-direction: column;
      gap: 24px;
      margin-bottom: 32px;
    }

    .stat-item {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .stat-header {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .stat-color {
      width: 20px;
      height: 20px;
      border-radius: 4px;
      flex-shrink: 0;
    }

    .stat-name {
      font-weight: 600;
      color: #2d5a3d;
    }

    .stat-hours {
      margin-left: auto;
      font-weight: 600;
      color: #4a7c59;
    }

    .stat-bar {
      height: 12px;
      background: #f5f7f5;
      border-radius: 6px;
      overflow: hidden;
    }

    .stat-fill {
      height: 100%;
      transition: width 0.3s ease;
    }

    .stat-percentage {
      font-size: 12px;
      color: #6b9b7a;
      text-align: right;
    }

    .placeholder-view {
      background: white;
      padding: 60px 24px;
      border-radius: 12px;
      text-align: center;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    }

    .daily-view-container {
      background: white;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
      overflow: hidden;
    }

    .time-grid {
      display: flex;
      position: relative;
      user-select: none;
    }

    .time-labels {
      width: 80px;
      flex-shrink: 0;
      border-right: 1px solid #e0e7e0;
    }

    .time-label {
      height: 40px;
      display: flex;
      align-items: flex-start;
      justify-content: flex-end;
      padding-right: 12px;
      padding-top: 4px;
      font-size: 12px;
      color: #6b9b7a;
      font-weight: 500;
    }

    .time-slots {
      flex: 1;
      position: relative;
    }

    .time-slot {
      height: 40px;
      border-bottom: 1px solid #f0f4f0;
      cursor: pointer;
      position: relative;
      transition: background 0.15s;
    }

    .time-slot:hover {
      background: #f5f7f5;
    }

    .time-slot.selected {
      background: #d4e8d9;
    }

    .hour-line {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 1px;
      background: #e0e7e0;
    }

    .events-overlay {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      pointer-events: none;
    }

    .daily-event {
      position: absolute;
      border-left: 4px solid #4a7c59;
      border-radius: 6px;
      padding: 8px 12px;
      pointer-events: auto;
      cursor: pointer;
      overflow: hidden;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      transition: all 0.2s;
    }

    .daily-event.planned {
      left: 8px;
      right: 50%;
      margin-right: 4px;
      opacity: 1;
      border-style: dashed;
    }

    .daily-event.actual {
      left: 50%;
      right: 8px;
      margin-left: 4px;
      opacity: 1;
      border-style: solid;
    }

    .daily-event:hover {
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
      transform: translateY(-1px);
    }

    .daily-event.completed {
      opacity: 1;
    }

    .daily-event.completed .event-title {
      text-decoration: line-through;
    }

    .daily-event.planned:not(.completed) {
      cursor: pointer;
    }

    .daily-event.planned:not(.completed):hover {
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
      transform: translateX(4px);
    }

    .event-type-toggle button {
      background: white;
      color: #6b9b7a;
    }

    .event-type-toggle button.active {
      background: #4a7c59;
      color: white;
    }

    .weekly-view {
      background: transparent;
    }

    .event-time {
      font-size: 11px;
      font-weight: 600;
      color: #2d5a3d;
      margin-bottom: 2px;
    }

    .event-title {
      font-size: 13px;
      font-weight: 600;
      color: #2d5a3d;
      margin-bottom: 2px;
    }

    .event-location {
      font-size: 11px;
      color: #6b9b7a;
    }

    .sync-section {
      background: white;
      padding: 24px;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
      margin-bottom: 24px;
    }

    .sync-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }

    .sync-status {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 16px;
      background: #f5f7f5;
      border-radius: 6px;
      font-size: 14px;
    }

    .sync-status.connected {
      background: #e8f5eb;
      color: #2d5a3d;
    }

    .sync-status.disconnected {
      background: #fff3e0;
      color: #f57c00;
    }

    .btn-google {
      background: white;
      color: #4285f4;
      border: 1px solid #4285f4;
      padding: 10px 20px;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: all 0.2s;
    }

    .btn-google:hover {
      background: #4285f4;
      color: white;
    }

    @media (max-width: 768px) {
      .app-header {
        flex-direction: column;
        gap: 16px;
      }

      .header-left {
        flex-direction: column;
        align-items: flex-start;
        gap: 16px;
        width: 100%;
      }

      .header-right {
        width: 100%;
        justify-content: space-between;
      }

      .calendar-nav {
        gap: 8px;
      }

      .calendar-nav h2 {
        width: 100%;
        font-size: 16px;
      }

      .calendar-day-header {
        font-size: 12px;
        padding: 8px 4px;
      }

      .calendar-day {
        min-height: 80px;
        padding: 4px;
      }

      .form-row {
        grid-template-columns: 1fr;
      }

      .btn-today {
        margin-left: 0;
      }
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    // Simple icon components
    const ChevronLeft = () => <span>‚Üê</span>;
    const ChevronRight = () => <span>‚Üí</span>;
    const Plus = () => <span>+</span>;
    const Settings = () => <span>‚öôÔ∏è</span>;
    const BarChart3 = () => <span>üìä</span>;
    const Bell = () => <span>üîî</span>;
    const Target = () => <span>üéØ</span>;
    const Grid = () => <span>üìÖ</span>;
    const List = () => <span>üìã</span>;

    // Utility functions
    const formatDate = (date) => {
      return date.toISOString().split('T')[0];
    };

    const formatTime = (date) => {
      return date.toTimeString().slice(0, 5);
    };

    const App = () => {
      const [currentDate, setCurrentDate] = useState(new Date());
      const [view, setView] = useState('monthly');
      const [dailyViewMode, setDailyViewMode] = useState('calendar');
      const [events, setEvents] = useState([]);
      const [categories, setCategories] = useState([
        { id: '1', name: 'Sleep', color: '#8e44ad' },
        { id: '2', name: 'Reading', color: '#3498db' },
        { id: '3', name: 'Working', color: '#e74c3c' },
        { id: '4', name: 'Sports', color: '#f39c12' }
      ]);
      const [yearlyProjects, setYearlyProjects] = useState([
        { id: '1', name: 'Q4 Financial Report', deadline: new Date('2025-03-31') },
        { id: '2', name: 'Yoga Certification', deadline: new Date('2025-06-15') }
      ]);
      const [showEventModal, setShowEventModal] = useState(false);
      const [showCategoryModal, setShowCategoryModal] = useState(false);
      const [showProjectModal, setShowProjectModal] = useState(false);
      const [showAnalytics, setShowAnalytics] = useState(false);
      const [showSyncModal, setShowSyncModal] = useState(false);
      const [showCompletionModal, setShowCompletionModal] = useState(false);
      const [showExportModal, setShowExportModal] = useState(false);
      const [showGoogleSetupModal, setShowGoogleSetupModal] = useState(false);
      const [selectedEventForCompletion, setSelectedEventForCompletion] = useState(null);
      const [prefilledEventData, setPrefilledEventData] = useState(null);
      const [googleConnected, setGoogleConnected] = useState(false);
      const [syncStatus, setSyncStatus] = useState('disconnected');
      const [googleSheetUrl, setGoogleSheetUrl] = useState('');
      const [googleClientId, setGoogleClientId] = useState('');
      const [googleAccessToken, setGoogleAccessToken] = useState('');

      // Load data from localStorage
      useEffect(() => {
        const savedEvents = localStorage.getItem('timewise_events');
        const savedCategories = localStorage.getItem('timewise_categories');
        const savedProjects = localStorage.getItem('timewise_projects');
        const savedGoogleConnection = localStorage.getItem('google_connected');
        const savedSheetUrl = localStorage.getItem('google_sheet_url');
        const savedClientId = localStorage.getItem('google_client_id');
        const savedAccessToken = localStorage.getItem('google_access_token');
        const savedTokenExpiry = localStorage.getItem('google_token_expiry');
        
        if (savedEvents) setEvents(JSON.parse(savedEvents));
        if (savedCategories) setCategories(JSON.parse(savedCategories));
        if (savedProjects) {
          const projects = JSON.parse(savedProjects);
          setYearlyProjects(projects.map(p => ({ ...p, deadline: new Date(p.deadline) })));
        }
        if (savedSheetUrl) {
          setGoogleSheetUrl(savedSheetUrl);
        }
        if (savedClientId) {
          setGoogleClientId(savedClientId);
        }
        
        // Check if token is still valid
        if (savedGoogleConnection === 'true' && savedAccessToken && savedTokenExpiry) {
          const expiry = parseInt(savedTokenExpiry);
          if (Date.now() < expiry) {
            setGoogleConnected(true);
            setGoogleAccessToken(savedAccessToken);
            setSyncStatus('connected');
          } else {
            // Token expired, clear connection
            setGoogleConnected(false);
            setSyncStatus('disconnected');
            localStorage.removeItem('google_connected');
            localStorage.removeItem('google_access_token');
            localStorage.removeItem('google_token_expiry');
          }
        }
      }, []);

      // Save to localStorage
      useEffect(() => {
        localStorage.setItem('timewise_events', JSON.stringify(events));
      }, [events]);

      useEffect(() => {
        localStorage.setItem('timewise_categories', JSON.stringify(categories));
      }, [categories]);

      useEffect(() => {
        localStorage.setItem('timewise_projects', JSON.stringify(yearlyProjects));
      }, [yearlyProjects]);

      const getDaysUntil = (deadline) => {
        const today = new Date();
        today.setHours(0, 0, 0, 0);
        const target = new Date(deadline);
        target.setHours(0, 0, 0, 0);
        const diffTime = target - today;
        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
        return diffDays;
      };

      const EventModal = () => {
        const initialData = prefilledEventData || {
          title: '',
          startDate: formatDate(new Date()),
          startTime: '09:00',
          endDate: formatDate(new Date()),
          endTime: '10:00',
          categoryId: categories[0]?.id || '',
          type: 'planned',
          description: '',
          location: '',
          projectId: ''
        };

        const [eventData, setEventData] = useState(initialData);

        const handleSave = () => {
          if (!eventData.title.trim()) {
            alert('Please enter an event title');
            return;
          }
          
          const eventToSave = {
            ...eventData,
            startDateTime: new Date(`${eventData.startDate}T${eventData.startTime}`),
            endDateTime: new Date(`${eventData.endDate}T${eventData.endTime}`)
          };

          // Check if we're editing an existing event
          if (window.__editingEventId) {
            // Update existing event
            const updatedEvents = events.map(e => 
              e.id === window.__editingEventId ? { ...e, ...eventToSave } : e
            );
            setEvents(updatedEvents);
            window.__editingEventId = null;
          } else {
            // Create new event
            const newEvent = {
              id: Date.now().toString(),
              ...eventToSave
            };
            setEvents([...events, newEvent]);
          }
          
          setShowEventModal(false);
          setPrefilledEventData(null);
        };

        return (
          <div className="modal-overlay" onClick={() => {
            setShowEventModal(false);
            setPrefilledEventData(null);
          }}>
            <div className="modal" onClick={e => e.stopPropagation()}>
              <h2>Create Event</h2>
              
              <div className="form-group">
                <label>Event Type</label>
                <div className="event-type-toggle">
                  <button 
                    className={eventData.type === 'planned' ? 'active' : ''}
                    onClick={() => setEventData({...eventData, type: 'planned'})}
                  >
                    Planned
                  </button>
                  <button 
                    className={eventData.type === 'actual' ? 'active' : ''}
                    onClick={() => setEventData({...eventData, type: 'actual'})}
                  >
                    Actual
                  </button>
                </div>
              </div>

              <div className="form-group">
                <label>Title *</label>
                <input 
                  type="text" 
                  value={eventData.title}
                  onChange={e => setEventData({...eventData, title: e.target.value})}
                  placeholder="Meeting with Luigi"
                />
              </div>

              <div className="form-row">
                <div className="form-group">
                  <label>Start Date</label>
                  <input 
                    type="date" 
                    value={eventData.startDate}
                    onChange={e => setEventData({...eventData, startDate: e.target.value})}
                  />
                </div>
                <div className="form-group">
                  <label>Start Time</label>
                  <input 
                    type="time" 
                    value={eventData.startTime}
                    onChange={e => setEventData({...eventData, startTime: e.target.value})}
                  />
                </div>
              </div>

              <div className="form-row">
                <div className="form-group">
                  <label>End Date</label>
                  <input 
                    type="date" 
                    value={eventData.endDate}
                    onChange={e => setEventData({...eventData, endDate: e.target.value})}
                  />
                </div>
                <div className="form-group">
                  <label>End Time</label>
                  <input 
                    type="time" 
                    value={eventData.endTime}
                    onChange={e => setEventData({...eventData, endTime: e.target.value})}
                  />
                </div>
              </div>

              <div className="form-group">
                <label>Category</label>
                <select 
                  value={eventData.categoryId}
                  onChange={e => setEventData({...eventData, categoryId: e.target.value})}
                >
                  {categories.map(cat => (
                    <option key={cat.id} value={cat.id}>{cat.name}</option>
                  ))}
                </select>
              </div>

              <div className="form-group">
                <label>Related Yearly Project (optional)</label>
                <select 
                  value={eventData.projectId || ''}
                  onChange={e => setEventData({...eventData, projectId: e.target.value})}
                >
                  <option value="">None</option>
                  {yearlyProjects.map(proj => (
                    <option key={proj.id} value={proj.id}>{proj.name}</option>
                  ))}
                </select>
                <p style={{ fontSize: '12px', color: '#6b9b7a', marginTop: '4px' }}>
                  Link this event to a yearly project to track time spent
                </p>
              </div>

              <div className="form-group">
                <label>Location (optional)</label>
                <input 
                  type="text" 
                  value={eventData.location}
                  onChange={e => setEventData({...eventData, location: e.target.value})}
                  placeholder="Office, Home, etc."
                />
              </div>

              <div className="form-group">
                <label>Description (optional)</label>
                <textarea 
                  value={eventData.description}
                  onChange={e => setEventData({...eventData, description: e.target.value})}
                  rows="3"
                />
              </div>

              <div className="modal-actions">
                <button className="btn-secondary" onClick={() => {
                  setShowEventModal(false);
                  setPrefilledEventData(null);
                }}>Cancel</button>
                <button className="btn-primary" onClick={handleSave}>Save Event</button>
              </div>
            </div>
          </div>
        );
      };

      const CategoryModal = () => {
        const [newCategory, setNewCategory] = useState({ name: '', color: '#6b9b7a' });

        const addCategory = () => {
          if (newCategory.name.trim()) {
            setCategories([...categories, { 
              id: Date.now().toString(), 
              ...newCategory 
            }]);
            setNewCategory({ name: '', color: '#6b9b7a' });
          }
        };

        const deleteCategory = (id) => {
          if (categories.length <= 1) {
            alert('You must have at least one category');
            return;
          }
          setCategories(categories.filter(cat => cat.id !== id));
        };

        return (
          <div className="modal-overlay" onClick={() => setShowCategoryModal(false)}>
            <div className="modal" onClick={e => e.stopPropagation()}>
              <h2>Manage Categories</h2>
              
              <div className="category-list">
                {categories.map(cat => (
                  <div key={cat.id} className="category-item">
                    <div className="category-color" style={{ backgroundColor: cat.color }}></div>
                    <span>{cat.name}</span>
                    <button onClick={() => deleteCategory(cat.id)} className="btn-delete">√ó</button>
                  </div>
                ))}
              </div>

              <div className="form-group">
                <label>Add New Category</label>
                <div className="form-row">
                  <input 
                    type="text" 
                    value={newCategory.name}
                    onChange={e => setNewCategory({...newCategory, name: e.target.value})}
                    placeholder="Category name"
                  />
                  <input 
                    type="color" 
                    value={newCategory.color}
                    onChange={e => setNewCategory({...newCategory, color: e.target.value})}
                    style={{ width: '60px' }}
                  />
                </div>
                <button className="btn-primary" onClick={addCategory} style={{ marginTop: '8px', width: '100%' }}>Add Category</button>
              </div>

              <div className="modal-actions">
                <button className="btn-primary" onClick={() => setShowCategoryModal(false)}>Done</button>
              </div>
            </div>
          </div>
        );
      };

      const ProjectModal = () => {
        const [newProject, setNewProject] = useState({ name: '', deadline: formatDate(new Date()) });
        const [editingProject, setEditingProject] = useState(null);

        const addProject = () => {
          if (newProject.name.trim() && yearlyProjects.length < 3) {
            setYearlyProjects([...yearlyProjects, {
              id: Date.now().toString(),
              name: newProject.name,
              deadline: new Date(newProject.deadline)
            }]);
            setNewProject({ name: '', deadline: formatDate(new Date()) });
          }
        };

        const startEdit = (project) => {
          setEditingProject({
            id: project.id,
            name: project.name,
            deadline: formatDate(project.deadline)
          });
        };

        const saveEdit = () => {
          if (editingProject && editingProject.name.trim()) {
            setYearlyProjects(yearlyProjects.map(p => 
              p.id === editingProject.id 
                ? { ...p, name: editingProject.name, deadline: new Date(editingProject.deadline) }
                : p
            ));
            setEditingProject(null);
          }
        };

        const cancelEdit = () => {
          setEditingProject(null);
        };

        const deleteProject = (id) => {
          setYearlyProjects(yearlyProjects.filter(p => p.id !== id));
        };

        return (
          <div className="modal-overlay" onClick={() => setShowProjectModal(false)}>
            <div className="modal" onClick={e => e.stopPropagation()}>
              <h2>
                Yearly Projects (Max 3)
                <span 
                  style={{ 
                    marginLeft: '8px',
                    fontSize: '18px',
                    cursor: 'help',
                    display: 'inline-block',
                    position: 'relative'
                  }}
                  title="Less is more, please prioritize your yearly target and limit the number of yearly targets to only 3"
                >
                  ‚ÑπÔ∏è
                </span>
              </h2>
              
              <div className="project-list">
                {yearlyProjects.map(proj => (
                  <div key={proj.id} className="project-item">
                    {editingProject && editingProject.id === proj.id ? (
                      // Edit mode
                      <div style={{ flex: 1, display: 'flex', flexDirection: 'column', gap: '8px' }}>
                        <input 
                          type="text" 
                          value={editingProject.name}
                          onChange={e => setEditingProject({...editingProject, name: e.target.value})}
                          placeholder="Project name"
                          style={{ padding: '8px', borderRadius: '6px', border: '1px solid #d4e8d9' }}
                        />
                        <input 
                          type="date" 
                          value={editingProject.deadline}
                          onChange={e => setEditingProject({...editingProject, deadline: e.target.value})}
                          style={{ padding: '8px', borderRadius: '6px', border: '1px solid #d4e8d9' }}
                        />
                        <div style={{ display: 'flex', gap: '8px' }}>
                          <button onClick={saveEdit} className="btn-primary" style={{ flex: 1 }}>
                            ‚úì Save
                          </button>
                          <button onClick={cancelEdit} className="btn-secondary" style={{ flex: 1 }}>
                            ‚úó Cancel
                          </button>
                        </div>
                      </div>
                    ) : (
                      // View mode
                      <>
                        <div style={{ flex: 1 }}>
                          <strong>{proj.name}</strong>
                          <div className="project-deadline">
                            Deadline: {proj.deadline.toLocaleDateString()} ({getDaysUntil(proj.deadline)} days)
                          </div>
                        </div>
                        <button 
                          onClick={() => startEdit(proj)} 
                          className="btn-secondary"
                          style={{ 
                            padding: '6px 12px',
                            fontSize: '13px',
                            marginRight: '8px'
                          }}
                          title="Edit project"
                        >
                          ‚úèÔ∏è
                        </button>
                        <button 
                          onClick={() => deleteProject(proj.id)} 
                          className="btn-delete"
                          title="Delete project"
                        >
                          √ó
                        </button>
                      </>
                    )}
                  </div>
                ))}
              </div>

              {yearlyProjects.length < 3 && (
                <div className="form-group">
                  <label>Add New Project</label>
                  <input 
                    type="text" 
                    value={newProject.name}
                    onChange={e => setNewProject({...newProject, name: e.target.value})}
                    placeholder="Project name"
                    style={{ marginBottom: '8px' }}
                  />
                  <input 
                    type="date" 
                    value={newProject.deadline}
                    onChange={e => setNewProject({...newProject, deadline: e.target.value})}
                    style={{ marginBottom: '8px' }}
                  />
                  <button className="btn-primary" onClick={addProject} style={{ width: '100%' }}>Add Project</button>
                </div>
              )}

              {yearlyProjects.length >= 3 && (
                <div style={{ 
                  padding: '12px', 
                  background: '#fff9e6', 
                  borderRadius: '8px',
                  border: '1px solid #f39c12',
                  marginTop: '12px'
                }}>
                  <p style={{ color: '#d68910', fontSize: '13px', textAlign: 'center', margin: 0 }}>
                    üí° Less is more, please prioritize your yearly target and limit the number of yearly targets to only 3
                  </p>
                </div>
              )}

              <div className="modal-actions">
                <button className="btn-primary" onClick={() => setShowProjectModal(false)}>Done</button>
              </div>
            </div>
          </div>
        );
      };

      const ExportModal = () => {
        const [sheetUrl, setSheetUrl] = useState(googleSheetUrl);
        const [exportType, setExportType] = useState('planned'); // planned, actual, or both

        const calculateProjectTime = (projectId) => {
          const projectEvents = events.filter(e => 
            e.projectId === projectId && 
            e.type === 'actual'
          );

          const totalMinutes = projectEvents.reduce((sum, event) => {
            const start = new Date(event.startDateTime);
            const end = new Date(event.endDateTime);
            return sum + (end - start) / (1000 * 60);
          }, 0);

          return Math.round(totalMinutes / 60 * 10) / 10; // hours with 1 decimal
        };

        const generateWeeklyCalendar = (type) => {
          const getWeekDates = () => {
            const curr = new Date(currentDate);
            const first = curr.getDate() - curr.getDay() + 1;
            const dates = [];
            
            for (let i = 0; i < 7; i++) {
              const date = new Date(curr.setDate(first + i));
              dates.push(new Date(date));
            }
            return dates;
          };

          const weekDates = getWeekDates();
          // Start from 5:00 instead of 0:00
          const hours = Array.from({ length: 19 }, (_, i) => i + 5); // 5 to 23

          let csv = 'Time,Monday,Tuesday,Wednesday,Thursday,Friday,Saturday,Sunday,,Project Info,Days Until Deadline,Hours Invested\n';

          hours.forEach((hour, index) => {
            const timeLabel = `${hour.toString().padStart(2, '0')}:00`;
            const row = [timeLabel];

            weekDates.forEach(date => {
              const dayEvents = events.filter(e => {
                const eventDate = new Date(e.startDateTime);
                const eventHour = eventDate.getHours();
                return eventDate.toDateString() === date.toDateString() && 
                       eventHour === hour &&
                       e.type === type;
              });

              if (dayEvents.length > 0) {
                const eventTitles = dayEvents.map(e => {
                  const category = categories.find(c => c.id === e.categoryId);
                  return `${e.title} (${category?.name || 'Unknown'})`;
                }).join('; ');
                row.push(`"${eventTitles}"`);
              } else {
                row.push('');
              }
            });

            // Add project info in right columns
            row.push(''); // Empty separator column
            
            if (index < yearlyProjects.length) {
              const project = yearlyProjects[index];
              const daysLeft = getDaysUntil(project.deadline);
              const hoursInvested = calculateProjectTime(project.id);
              
              row.push(`"${project.name}"`);
              row.push(daysLeft.toString());
              row.push(hoursInvested.toString());
            } else {
              row.push('');
              row.push('');
              row.push('');
            }

            csv += row.join(',') + '\n';
          });

          return csv;
        };

        const handleExport = () => {
          let csv = '';
          let filename = '';

          if (exportType === 'both') {
            // Export both in separate sheets (combined CSV with separator)
            csv = '=== PLANNED EVENTS ===\n' + generateWeeklyCalendar('planned') + '\n\n';
            csv += '=== ACTUAL EVENTS ===\n' + generateWeeklyCalendar('actual');
            filename = `weekly-calendar-both-${formatDate(currentDate)}.csv`;
          } else {
            csv = generateWeeklyCalendar(exportType);
            filename = `weekly-calendar-${exportType}-${formatDate(currentDate)}.csv`;
          }

          const blob = new Blob([csv], { type: 'text/csv' });
          const url = window.URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = filename;
          a.click();
          window.URL.revokeObjectURL(url);
          
          const typeLabel = exportType === 'both' ? 'Planned & Actual' : exportType.charAt(0).toUpperCase() + exportType.slice(1);
          alert(`Weekly calendar exported as CSV!\n\nExported: ${typeLabel} Events\n\nIncludes:\n‚úì Schedule from 5:00 - 23:00\n‚úì Yearly project countdown\n‚úì Hours invested per project\n\nYou can:\n1. Open this CSV file\n2. Copy the data\n3. Paste into your Google Sheet`);
        };

        const handleSaveSheetUrl = () => {
          setGoogleSheetUrl(sheetUrl);
          localStorage.setItem('google_sheet_url', sheetUrl);
          alert('Google Sheet URL saved!\n\nIn a full implementation, TimeWise would:\n1. Use Google Sheets API to write data directly\n2. Authenticate with OAuth\n3. Update the sheet automatically');
        };

        return (
          <div className="modal-overlay" onClick={() => setShowExportModal(false)}>
            <div className="modal" onClick={e => e.stopPropagation()}>
              <h2>Export to Google Sheets</h2>
              
              {/* Export Type Selection */}
              <div className="form-group">
                <label>What would you like to export?</label>
                <div style={{ display: 'flex', flexDirection: 'column', gap: '8px', marginTop: '8px' }}>
                  <button 
                    className={`event-type-toggle ${exportType === 'planned' ? 'active' : ''}`}
                    onClick={() => setExportType('planned')}
                    style={{ width: '100%', padding: '12px', textAlign: 'left' }}
                  >
                    üìã <strong>Planned Events Only</strong>
                    <div style={{ fontSize: '12px', marginTop: '4px', opacity: 0.8 }}>
                      Export your planned schedule
                    </div>
                  </button>
                  <button 
                    className={`event-type-toggle ${exportType === 'actual' ? 'active' : ''}`}
                    onClick={() => setExportType('actual')}
                    style={{ width: '100%', padding: '12px', textAlign: 'left' }}
                  >
                    ‚úÖ <strong>Actual Events Only</strong>
                    <div style={{ fontSize: '12px', marginTop: '4px', opacity: 0.8 }}>
                      Export what actually happened
                    </div>
                  </button>
                  <button 
                    className={`event-type-toggle ${exportType === 'both' ? 'active' : ''}`}
                    onClick={() => setExportType('both')}
                    style={{ width: '100%', padding: '12px', textAlign: 'left' }}
                  >
                    üìä <strong>Both (Planned & Actual)</strong>
                    <div style={{ fontSize: '12px', marginTop: '4px', opacity: 0.8 }}>
                      Export both in separate sections
                    </div>
                  </button>
                </div>
              </div>

              <div className="form-group">
                <label>Google Sheet URL (Optional)</label>
                <input 
                  type="text" 
                  value={sheetUrl}
                  onChange={e => setSheetUrl(e.target.value)}
                  placeholder="https://docs.google.com/spreadsheets/d/..."
                />
                <p style={{ fontSize: '12px', color: '#6b9b7a', marginTop: '6px' }}>
                  Save your Google Sheet URL for quick exports
                </p>
              </div>

              {sheetUrl && (
                <button 
                  className="btn-secondary" 
                  onClick={handleSaveSheetUrl}
                  style={{ width: '100%', marginBottom: '12px' }}
                >
                  üíæ Save Sheet URL
                </button>
              )}

              <div style={{ 
                background: '#f5f7f5', 
                padding: '16px', 
                borderRadius: '8px',
                marginBottom: '20px'
              }}>
                <h4 style={{ fontSize: '14px', color: '#2d5a3d', marginBottom: '12px' }}>
                  Weekly Calendar Format
                </h4>
                <ul style={{ fontSize: '13px', color: '#6b9b7a', paddingLeft: '20px', margin: 0 }}>
                  <li>Monday to Sunday (left to right)</li>
                  <li>Time from 5:00 to 23:00 (skip night hours)</li>
                  {exportType === 'planned' && <li>Shows planned events with categories</li>}
                  {exportType === 'actual' && <li>Shows actual events with categories</li>}
                  {exportType === 'both' && <li>Two sections: Planned events followed by Actual events</li>}
                  <li>Right side: Yearly project info</li>
                  <li>Includes days until deadline</li>
                  <li>Shows hours invested (from actual events)</li>
                </ul>
              </div>

              {yearlyProjects.length > 0 && (
                <div style={{ 
                  background: '#e8f5eb', 
                  padding: '16px', 
                  borderRadius: '8px',
                  marginBottom: '20px'
                }}>
                  <h4 style={{ fontSize: '14px', color: '#2d5a3d', marginBottom: '12px' }}>
                    üìä Project Summary Preview
                  </h4>
                  {yearlyProjects.map(project => {
                    const daysLeft = getDaysUntil(project.deadline);
                    const hoursInvested = calculateProjectTime(project.id);
                    return (
                      <div key={project.id} style={{ 
                        fontSize: '13px', 
                        color: '#2d5a3d',
                        marginBottom: '8px',
                        paddingBottom: '8px',
                        borderBottom: '1px solid #d4e8d9'
                      }}>
                        <strong>{project.name}</strong>
                        <div style={{ fontSize: '12px', color: '#6b9b7a', marginTop: '4px' }}>
                          {daysLeft} days left ‚Ä¢ {hoursInvested} hours invested
                        </div>
                      </div>
                    );
                  })}
                </div>
              )}

              <div className="modal-actions">
                <button className="btn-secondary" onClick={() => setShowExportModal(false)}>
                  Cancel
                </button>
                <button className="btn-primary" onClick={handleExport}>
                  üì• Export CSV
                </button>
              </div>
            </div>
          </div>
        );
      };

      const CompletionModal = () => {
        const [completionType, setCompletionType] = useState('on_time'); // on_time, late, incomplete
        const [lateTime, setLateTime] = useState('');
        const [lateReason, setLateReason] = useState('');
        const [incompleteReason, setIncompleteReason] = useState('');
        const [actualEventTitle, setActualEventTitle] = useState('');
        const [actualStartTime, setActualStartTime] = useState('');
        const [actualEndTime, setActualEndTime] = useState('');

        if (!selectedEventForCompletion) return null;

        const event = selectedEventForCompletion;
        const category = categories.find(c => c.id === event.categoryId);

        const handleComplete = () => {
          const actualEvent = {
            id: Date.now().toString(),
            categoryId: event.categoryId,
            type: 'actual',
            description: event.description,
            location: event.location,
            relatedPlannedEvent: event.id
          };

          if (completionType === 'on_time') {
            actualEvent.title = event.title;
            actualEvent.startDateTime = event.startDateTime;
            actualEvent.endDateTime = event.endDateTime;
            actualEvent.startDate = formatDate(new Date(event.startDateTime));
            actualEvent.startTime = formatTime(new Date(event.startDateTime));
            actualEvent.endDate = formatDate(new Date(event.endDateTime));
            actualEvent.endTime = formatTime(new Date(event.endDateTime));
            actualEvent.completionStatus = 'completed_on_time';
          } else if (completionType === 'late') {
            if (!lateTime || !lateReason) {
              alert('Please enter late completion time and reason');
              return;
            }
            const lateEndDateTime = new Date(event.startDateTime);
            const [hours, minutes] = lateTime.split(':');
            lateEndDateTime.setHours(parseInt(hours), parseInt(minutes));
            
            actualEvent.title = event.title;
            actualEvent.startDateTime = event.startDateTime;
            actualEvent.endDateTime = lateEndDateTime;
            actualEvent.startDate = formatDate(new Date(event.startDateTime));
            actualEvent.startTime = formatTime(new Date(event.startDateTime));
            actualEvent.endDate = formatDate(lateEndDateTime);
            actualEvent.endTime = formatTime(lateEndDateTime);
            actualEvent.completionStatus = 'completed_late';
            actualEvent.lateReason = lateReason;
          } else {
            if (!incompleteReason || !actualEventTitle || !actualStartTime || !actualEndTime) {
              alert('Please fill in all required fields');
              return;
            }
            const startDate = formatDate(new Date(event.startDateTime));
            actualEvent.title = actualEventTitle;
            actualEvent.startDateTime = new Date(`${startDate}T${actualStartTime}`);
            actualEvent.endDateTime = new Date(`${startDate}T${actualEndTime}`);
            actualEvent.startDate = startDate;
            actualEvent.startTime = actualStartTime;
            actualEvent.endDate = startDate;
            actualEvent.endTime = actualEndTime;
            actualEvent.completionStatus = 'incomplete';
            actualEvent.incompleteReason = incompleteReason;
          }

          const updatedEvent = {
            ...event,
            completed: true,
            completionStatus: actualEvent.completionStatus,
            actualEventId: actualEvent.id
          };

          setEvents([...events.filter(e => e.id !== event.id), updatedEvent, actualEvent]);
          setShowCompletionModal(false);
          setSelectedEventForCompletion(null);
        };

        return (
          <div className="modal-overlay" onClick={() => setShowCompletionModal(false)}>
            <div className="modal" onClick={e => e.stopPropagation()}>
              <h2>Event Options</h2>
              
              <div style={{ 
                padding: '12px', 
                background: '#f5f7f5', 
                borderRadius: '8px', 
                marginBottom: '20px',
                borderLeft: `4px solid ${category?.color}`
              }}>
                <div style={{ fontWeight: 600, color: '#2d5a3d', marginBottom: '4px' }}>
                  {event.title}
                </div>
                <div style={{ fontSize: '13px', color: '#6b9b7a' }}>
                  {new Date(event.startDateTime).toLocaleString()} - {new Date(event.endDateTime).toLocaleTimeString()}
                </div>
              </div>

              <div className="form-group">
                <label>What would you like to do?</label>
                <div style={{ display: 'flex', flexDirection: 'column', gap: '8px' }}>
                  <button 
                    className="btn-primary"
                    onClick={() => {
                      setSelectedEventForCompletion(null);
                      setShowCompletionModal(false);
                      setPrefilledEventData({
                        title: event.title,
                        startDate: formatDate(new Date(event.startDateTime)),
                        startTime: formatTime(new Date(event.startDateTime)),
                        endDate: formatDate(new Date(event.endDateTime)),
                        endTime: formatTime(new Date(event.endDateTime)),
                        categoryId: event.categoryId,
                        type: 'planned',
                        description: event.description || '',
                        location: event.location || '',
                        projectId: event.projectId || ''
                      });
                      // Store the original event ID for updating
                      window.__editingEventId = event.id;
                      setShowEventModal(true);
                    }}
                    style={{ width: '100%', padding: '12px', textAlign: 'left', marginBottom: '12px' }}
                  >
                    ‚úèÔ∏è <strong>Edit Event</strong>
                    <div style={{ fontSize: '12px', marginTop: '4px', opacity: 0.8 }}>
                      Modify event details
                    </div>
                  </button>
                  <div style={{ borderTop: '1px solid #e0e7e0', margin: '8px 0', paddingTop: '12px' }}>
                    <div style={{ fontSize: '13px', color: '#6b9b7a', marginBottom: '8px' }}>
                      Or mark as complete:
                    </div>
                  </div>
                  <button 
                    className={`event-type-toggle ${completionType === 'on_time' ? 'active' : ''}`}
                    onClick={() => setCompletionType('on_time')}
                    style={{ width: '100%', padding: '12px', textAlign: 'left' }}
                  >
                    ‚úÖ <strong>Completed On Time</strong>
                    <div style={{ fontSize: '12px', marginTop: '4px', opacity: 0.8 }}>
                      Finished as planned
                    </div>
                  </button>
                  <button 
                    className={`event-type-toggle ${completionType === 'late' ? 'active' : ''}`}
                    onClick={() => setCompletionType('late')}
                    style={{ width: '100%', padding: '12px', textAlign: 'left' }}
                  >
                    ‚ö†Ô∏è <strong>Completed Late</strong>
                    <div style={{ fontSize: '12px', marginTop: '4px', opacity: 0.8 }}>
                      Took longer than expected
                    </div>
                  </button>
                  <button 
                    className={`event-type-toggle ${completionType === 'incomplete' ? 'active' : ''}`}
                    onClick={() => setCompletionType('incomplete')}
                    style={{ width: '100%', padding: '12px', textAlign: 'left' }}
                  >
                    ‚ùå <strong>Not Completed</strong>
                    <div style={{ fontSize: '12px', marginTop: '4px', opacity: 0.8 }}>
                      Did something else instead
                    </div>
                  </button>
                </div>
              </div>

              {completionType === 'late' && (
                <>
                  <div className="form-group">
                    <label>Actual End Time *</label>
                    <input 
                      type="time" 
                      value={lateTime}
                      onChange={e => setLateTime(e.target.value)}
                    />
                  </div>
                  <div className="form-group">
                    <label>Reason for Delay *</label>
                    <textarea 
                      value={lateReason}
                      onChange={e => setLateReason(e.target.value)}
                      rows="3"
                      placeholder="Why did this take longer than planned?"
                    />
                  </div>
                </>
              )}

              {completionType === 'incomplete' && (
                <>
                  <div className="form-group">
                    <label>Reason Not Completed *</label>
                    <select 
                      value={incompleteReason}
                      onChange={e => setIncompleteReason(e.target.value)}
                    >
                      <option value="">Select reason...</option>
                      <option value="lack_of_time">Lack of Time</option>
                      <option value="unexpected_interruption">Unexpected Interruption</option>
                      <option value="changed_priority">Changed Priority</option>
                      <option value="lack_of_motivation">Lack of Motivation</option>
                      <option value="technical_issue">Technical Issue</option>
                      <option value="other">Other</option>
                    </select>
                  </div>
                  <div className="form-group">
                    <label>What did you actually do? *</label>
                    <input 
                      type="text" 
                      value={actualEventTitle}
                      onChange={e => setActualEventTitle(e.target.value)}
                      placeholder="Actual activity during this time"
                    />
                  </div>
                  <div className="form-row">
                    <div className="form-group">
                      <label>Actual Start Time *</label>
                      <input 
                        type="time" 
                        value={actualStartTime}
                        onChange={e => setActualStartTime(e.target.value)}
                      />
                    </div>
                    <div className="form-group">
                      <label>Actual End Time *</label>
                      <input 
                        type="time" 
                        value={actualEndTime}
                        onChange={e => setActualEndTime(e.target.value)}
                      />
                    </div>
                  </div>
                </>
              )}

              <div className="modal-actions">
                <button className="btn-secondary" onClick={() => setShowCompletionModal(false)}>Cancel</button>
                <button className="btn-primary" onClick={handleComplete}>Confirm</button>
              </div>
            </div>
          </div>
        );
      };

      const GoogleSetupModal = () => {
        const [clientId, setClientId] = useState(googleClientId);

        const handleSave = () => {
          if (!clientId.trim()) {
            alert('Please enter a valid Google OAuth Client ID');
            return;
          }
          setGoogleClientId(clientId.trim());
          localStorage.setItem('google_client_id', clientId.trim());
          setShowGoogleSetupModal(false);
          alert('Google OAuth Client ID saved!\n\nYou can now connect to Google Calendar.');
        };

        return (
          <div className="modal-overlay" onClick={() => setShowGoogleSetupModal(false)}>
            <div className="modal" onClick={e => e.stopPropagation()}>
              <h2>Google Calendar Setup</h2>
              
              <div style={{ 
                background: '#fff3e0', 
                padding: '16px', 
                borderRadius: '8px',
                marginBottom: '20px',
                fontSize: '13px',
                color: '#f57c00'
              }}>
                ‚ö†Ô∏è <strong>One-time setup required</strong>
                <p style={{ marginTop: '8px', lineHeight: '1.5' }}>
                  To enable real Google Calendar sync, you need to create a Google Cloud Project and get OAuth credentials.
                </p>
              </div>

              <div style={{ 
                background: '#f5f7f5', 
                padding: '16px', 
                borderRadius: '8px',
                marginBottom: '20px'
              }}>
                <h4 style={{ fontSize: '14px', color: '#2d5a3d', marginBottom: '12px' }}>
                  How to get your OAuth Client ID:
                </h4>
                <ol style={{ fontSize: '13px', color: '#6b9b7a', paddingLeft: '20px', margin: 0, lineHeight: '1.8' }}>
                  <li>Go to <a href="https://console.cloud.google.com" target="_blank" style={{ color: '#4285f4' }}>Google Cloud Console</a></li>
                  <li>Create a new project or select existing one</li>
                  <li>Enable "Google Calendar API"</li>
                  <li>Go to "Credentials" ‚Üí "Create Credentials" ‚Üí "OAuth client ID"</li>
                  <li>Application type: "Web application"</li>
                  <li>Add authorized JavaScript origins: <code style={{ background: '#e0e7e0', padding: '2px 6px', borderRadius: '3px' }}>file://</code> or your domain</li>
                  <li>Add authorized redirect URIs: <code style={{ background: '#e0e7e0', padding: '2px 6px', borderRadius: '3px' }}>file:///</code> or your domain</li>
                  <li>Copy the Client ID</li>
                </ol>
              </div>

              <div className="form-group">
                <label>Google OAuth Client ID</label>
                <input 
                  type="text" 
                  value={clientId}
                  onChange={e => setClientId(e.target.value)}
                  placeholder="123456789-abcdefg.apps.googleusercontent.com"
                />
                <p style={{ fontSize: '12px', color: '#6b9b7a', marginTop: '6px' }}>
                  Your Client ID will be stored locally in this browser
                </p>
              </div>

              <div className="modal-actions">
                <button className="btn-secondary" onClick={() => setShowGoogleSetupModal(false)}>
                  Cancel
                </button>
                <button className="btn-primary" onClick={handleSave}>
                  Save Client ID
                </button>
              </div>
            </div>
          </div>
        );
      };

      const GoogleSyncModal = () => {
        const handleConnectGoogle = async () => {
          if (!googleClientId) {
            if (confirm('Google OAuth Client ID not configured. Set it up now?')) {
              setShowSyncModal(false);
              setShowGoogleSetupModal(true);
            }
            return;
          }

          setSyncStatus('connecting');

          try {
            // Initialize Google Identity Services
            const client = window.google.accounts.oauth2.initTokenClient({
              client_id: googleClientId,
              scope: 'https://www.googleapis.com/auth/calendar https://www.googleapis.com/auth/calendar.events',
              callback: async (response) => {
                if (response.access_token) {
                  setGoogleAccessToken(response.access_token);
                  localStorage.setItem('google_access_token', response.access_token);
                  localStorage.setItem('google_token_expiry', Date.now() + (response.expires_in * 1000));
                  setGoogleConnected(true);
                  setSyncStatus('connected');
                  localStorage.setItem('google_connected', 'true');
                  alert('Successfully connected to Google Calendar!');
                } else {
                  setSyncStatus('disconnected');
                  alert('Failed to connect to Google Calendar');
                }
              },
            });

            client.requestAccessToken();
          } catch (error) {
            console.error('Google OAuth error:', error);
            setSyncStatus('disconnected');
            alert('Error connecting to Google Calendar. Please check your Client ID and try again.');
          }
        };

        const handleSignOut = async () => {
          if (!confirm('Sign out from Google Calendar?\n\nThis will:\n- Revoke access to your Google Calendar\n- Clear your connection\n- Keep your local events')) {
            return;
          }

          try {
            // Revoke the access token
            if (googleAccessToken) {
              await fetch(`https://oauth2.googleapis.com/revoke?token=${googleAccessToken}`, {
                method: 'POST',
                headers: {
                  'Content-type': 'application/x-www-form-urlencoded'
                }
              });
            }
          } catch (error) {
            console.error('Error revoking token:', error);
          }

          // Clear all Google-related data
          setGoogleConnected(false);
          setGoogleAccessToken('');
          setSyncStatus('disconnected');
          localStorage.removeItem('google_connected');
          localStorage.removeItem('google_access_token');
          localStorage.removeItem('google_token_expiry');
          
          alert('Successfully signed out from Google Calendar.\n\nYou can now connect with a different account or reconfigure your setup.');
        };

        const handleResetOAuth = () => {
          if (!confirm('Reset Google OAuth setup?\n\nThis will:\n- Remove your saved Client ID\n- Sign you out\n- Allow you to reconfigure from scratch\n\nYour local events will NOT be deleted.')) {
            return;
          }

          // Clear everything
          setGoogleConnected(false);
          setGoogleAccessToken('');
          setGoogleClientId('');
          setSyncStatus('disconnected');
          localStorage.removeItem('google_connected');
          localStorage.removeItem('google_access_token');
          localStorage.removeItem('google_token_expiry');
          localStorage.removeItem('google_client_id');
          
          alert('Google OAuth setup has been reset.\n\nClick "Set Up Google OAuth" to reconfigure.');
        };

        const syncToGoogle = async () => {
          if (!googleAccessToken) {
            alert('Not connected to Google Calendar');
            return;
          }

          setSyncStatus('syncing');

          try {
            // Get all planned events
            const plannedEvents = events.filter(e => e.type === 'planned');
            let synced = 0;

            for (const event of plannedEvents) {
              const category = categories.find(c => c.id === event.categoryId);
              
              const googleEvent = {
                summary: `${event.title}${event.completionStatus ? ' [' + event.completionStatus + ']' : ''}`,
                description: event.description || '',
                location: event.location || '',
                start: {
                  dateTime: new Date(event.startDateTime).toISOString(),
                  timeZone: Intl.DateTimeFormat().resolvedOptions().timeZone
                },
                end: {
                  dateTime: new Date(event.endDateTime).toISOString(),
                  timeZone: Intl.DateTimeFormat().resolvedOptions().timeZone
                },
                colorId: getCategoryColorId(category?.color)
              };

              const response = await fetch('https://www.googleapis.com/calendar/v3/calendars/primary/events', {
                method: 'POST',
                headers: {
                  'Authorization': `Bearer ${googleAccessToken}`,
                  'Content-Type': 'application/json'
                },
                body: JSON.stringify(googleEvent)
              });

              if (response.ok) {
                synced++;
              }
            }

            setSyncStatus('connected');
            alert(`Sync to Google complete!\n\nSynced ${synced} out of ${plannedEvents.length} events to Google Calendar.`);
          } catch (error) {
            console.error('Sync error:', error);
            setSyncStatus('connected');
            alert('Error syncing to Google Calendar. Please try again.');
          }
        };

        const syncFromGoogle = async () => {
          if (!googleAccessToken) {
            alert('Not connected to Google Calendar');
            return;
          }

          setSyncStatus('syncing');

          try {
            // Fetch events from Google Calendar
            const timeMin = new Date();
            timeMin.setMonth(timeMin.getMonth() - 1); // Get events from last month
            const timeMax = new Date();
            timeMax.setMonth(timeMax.getMonth() + 3); // Get events up to 3 months ahead

            const response = await fetch(
              `https://www.googleapis.com/calendar/v3/calendars/primary/events?` +
              `timeMin=${timeMin.toISOString()}&` +
              `timeMax=${timeMax.toISOString()}&` +
              `singleEvents=true&` +
              `orderBy=startTime`,
              {
                headers: {
                  'Authorization': `Bearer ${googleAccessToken}`
                }
              }
            );

            if (!response.ok) {
              throw new Error('Failed to fetch events from Google Calendar');
            }

            const data = await response.json();
            const googleEvents = data.items || [];
            
            let imported = 0;
            const newEvents = [];

            for (const gEvent of googleEvents) {
              // Skip all-day events
              if (!gEvent.start.dateTime) continue;

              // Check if event already exists in TimeWise
              const existingEvent = events.find(e => 
                e.title === gEvent.summary &&
                new Date(e.startDateTime).getTime() === new Date(gEvent.start.dateTime).getTime()
              );

              if (existingEvent) continue; // Skip duplicates

              // Create new event in TimeWise
              const newEvent = {
                id: Date.now().toString() + Math.random().toString(36).substr(2, 9),
                title: gEvent.summary || 'Untitled Event',
                startDateTime: new Date(gEvent.start.dateTime),
                endDateTime: new Date(gEvent.end.dateTime),
                startDate: formatDate(new Date(gEvent.start.dateTime)),
                startTime: formatTime(new Date(gEvent.start.dateTime)),
                endDate: formatDate(new Date(gEvent.end.dateTime)),
                endTime: formatTime(new Date(gEvent.end.dateTime)),
                categoryId: categories[0]?.id || '',
                type: 'planned',
                description: gEvent.description || '',
                location: gEvent.location || '',
                projectId: '',
                googleEventId: gEvent.id // Store Google event ID for future updates
              };

              newEvents.push(newEvent);
              imported++;
            }

            if (newEvents.length > 0) {
              setEvents([...events, ...newEvents]);
            }

            setSyncStatus('connected');
            alert(`Sync from Google complete!\n\nImported ${imported} new events from Google Calendar.`);
          } catch (error) {
            console.error('Sync from Google error:', error);
            setSyncStatus('connected');
            alert('Error syncing from Google Calendar. Please try again.');
          }
        };

        const syncBothWays = async () => {
          if (!googleAccessToken) {
            alert('Not connected to Google Calendar');
            return;
          }

          if (!confirm('Two-way sync will:\n1. Push all TimeWise events to Google Calendar\n2. Import all Google Calendar events to TimeWise\n\nContinue?')) {
            return;
          }

          setSyncStatus('syncing');

          // First sync to Google
          await syncToGoogle();
          
          // Wait a moment
          await new Promise(resolve => setTimeout(resolve, 1000));
          
          // Then sync from Google
          await syncFromGoogle();

          setSyncStatus('connected');
          alert('Two-way sync complete! ‚úÖ');
        };

        const getCategoryColorId = (hexColor) => {
          // Map hex colors to Google Calendar color IDs (1-11)
          const colorMap = {
            '#8e44ad': '3', // purple
            '#3498db': '9', // blue
            '#e74c3c': '11', // red
            '#f39c12': '6', // orange
            '#27ae60': '10', // green
          };
          return colorMap[hexColor] || '1';
        };

        return (
          <div className="modal-overlay" onClick={() => setShowSyncModal(false)}>
            <div className="modal" onClick={e => e.stopPropagation()}>
              <h2>Google Calendar Sync</h2>
              
              <div className="sync-section" style={{ padding: '16px', marginBottom: '16px' }}>
                <div className="sync-header">
                  <h3 style={{ margin: 0, fontSize: '16px' }}>Connection Status</h3>
                  <div className={`sync-status ${googleConnected ? 'connected' : 'disconnected'}`}>
                    {googleConnected ? 'üü¢ Connected' : 'üî¥ Not Connected'}
                  </div>
                </div>
                {googleConnected && (
                  <div style={{ fontSize: '12px', color: '#6b9b7a', marginTop: '8px' }}>
                    Connected with Google account
                  </div>
                )}
              </div>

              {!googleClientId && (
                <div style={{ 
                  background: '#fff3e0', 
                  padding: '16px', 
                  borderRadius: '8px',
                  marginBottom: '20px'
                }}>
                  <p style={{ fontSize: '14px', color: '#f57c00', marginBottom: '12px' }}>
                    ‚ö†Ô∏è Google OAuth Client ID not configured
                  </p>
                  <button 
                    className="btn-primary" 
                    onClick={() => {
                      setShowSyncModal(false);
                      setShowGoogleSetupModal(true);
                    }}
                    style={{ width: '100%', justifyContent: 'center' }}
                  >
                    Set Up Google OAuth
                  </button>
                </div>
              )}

              {googleClientId && !googleConnected && (
                <div style={{ marginBottom: '20px' }}>
                  <p style={{ color: '#6b9b7a', marginBottom: '16px', fontSize: '14px' }}>
                    Connect TimeWise to your Google Calendar to:
                  </p>
                  <ul style={{ color: '#6b9b7a', fontSize: '14px', paddingLeft: '20px', marginBottom: '20px' }}>
                    <li>Sync events to Google Calendar</li>
                    <li>Apply category colors</li>
                    <li>Mark completion status</li>
                    <li>Access across all devices</li>
                  </ul>
                  <button className="btn-google" onClick={handleConnectGoogle} style={{ width: '100%', justifyContent: 'center', marginBottom: '12px' }}>
                    <span>üîó</span>
                    Connect Google Calendar
                  </button>
                  <button 
                    className="btn-secondary" 
                    onClick={handleResetOAuth}
                    style={{ width: '100%', justifyContent: 'center', fontSize: '13px' }}
                  >
                    üîÑ Reset OAuth Setup
                  </button>
                </div>
              )}

              {googleConnected && (
                <div>
                  <div style={{ marginBottom: '20px' }}>
                    <h4 style={{ marginBottom: '12px', color: '#2d5a3d', fontSize: '14px' }}>Sync Options</h4>
                    <div style={{ background: '#e8f5eb', padding: '12px', borderRadius: '8px', marginBottom: '12px', fontSize: '13px', color: '#2d5a3d' }}>
                      <strong>Two-way sync available!</strong><br/>
                      ‚Ä¢ Push TimeWise ‚Üí Google Calendar<br/>
                      ‚Ä¢ Pull Google Calendar ‚Üí TimeWise<br/>
                      ‚Ä¢ Or do both at once
                    </div>
                  </div>

                  <div style={{ display: 'flex', flexDirection: 'column', gap: '8px', marginBottom: '16px' }}>
                    <button 
                      className="btn-primary" 
                      onClick={syncBothWays}
                      style={{ width: '100%', justifyContent: 'center' }}
                      disabled={syncStatus === 'syncing'}
                    >
                      {syncStatus === 'syncing' ? '‚è≥ Syncing...' : 'üîÑ Two-Way Sync'}
                    </button>
                    <button 
                      className="btn-secondary" 
                      onClick={syncToGoogle}
                      style={{ width: '100%', justifyContent: 'center' }}
                      disabled={syncStatus === 'syncing'}
                    >
                      ‚¨ÜÔ∏è Push to Google
                    </button>
                    <button 
                      className="btn-secondary" 
                      onClick={syncFromGoogle}
                      style={{ width: '100%', justifyContent: 'center' }}
                      disabled={syncStatus === 'syncing'}
                    >
                      ‚¨áÔ∏è Pull from Google
                    </button>
                  </div>

                  <div style={{ 
                    paddingTop: '16px', 
                    borderTop: '1px solid #e0e7e0',
                    display: 'flex',
                    flexDirection: 'column',
                    gap: '8px'
                  }}>
                    <button 
                      className="btn-secondary" 
                      onClick={handleSignOut}
                      style={{ width: '100%', justifyContent: 'center' }}
                    >
                      üö™ Sign Out
                    </button>
                    <button 
                      onClick={handleResetOAuth}
                      style={{ 
                        width: '100%', 
                        justifyContent: 'center',
                        background: 'transparent',
                        border: '1px solid #e0e7e0',
                        padding: '8px 16px',
                        borderRadius: '6px',
                        color: '#6b9b7a',
                        fontSize: '13px',
                        cursor: 'pointer',
                        transition: 'all 0.2s'
                      }}
                      onMouseEnter={e => e.target.style.background = '#f5f7f5'}
                      onMouseLeave={e => e.target.style.background = 'transparent'}
                    >
                      üîÑ Reset OAuth Setup
                    </button>
                  </div>
                </div>
              )}

              <div className="modal-actions">
                <button className="btn-primary" onClick={() => setShowSyncModal(false)}>Close</button>
              </div>
            </div>
          </div>
        );
      };

      const Analytics = () => {
        const [timeRange, setTimeRange] = useState('month');
        const [customStartDate, setCustomStartDate] = useState('');
        const [customEndDate, setCustomEndDate] = useState('');
        const [showProjectStats, setShowProjectStats] = useState(true);

        const getDateRange = () => {
          const now = new Date();
          let startDate = new Date();
          let endDate = new Date();

          if (timeRange === 'custom') {
            if (customStartDate && customEndDate) {
              startDate = new Date(customStartDate);
              endDate = new Date(customEndDate);
              endDate.setHours(23, 59, 59, 999);
            } else {
              return null;
            }
          } else {
            switch(timeRange) {
              case 'day':
                startDate.setHours(0, 0, 0, 0);
                endDate.setHours(23, 59, 59, 999);
                break;
              case 'week':
                startDate.setDate(now.getDate() - 7);
                break;
              case 'month':
                startDate.setMonth(now.getMonth() - 1);
                break;
              case 'year':
                startDate.setFullYear(now.getFullYear() - 1);
                break;
            }
          }

          return { startDate, endDate };
        };

        const calculateStats = (eventType) => {
          const range = getDateRange();
          if (!range) return { categoryStats: [], projectStats: [] };
          
          const { startDate, endDate } = range;

          // Category stats
          const categoryStats = categories.map(cat => {
            const categoryEvents = events.filter(e => 
              e.categoryId === cat.id && 
              e.type === eventType &&
              new Date(e.startDateTime) >= startDate &&
              new Date(e.startDateTime) <= endDate
            );

            const totalMinutes = categoryEvents.reduce((sum, event) => {
              const start = new Date(event.startDateTime);
              const end = new Date(event.endDateTime);
              return sum + (end - start) / (1000 * 60);
            }, 0);

            return {
              ...cat,
              hours: Math.round(totalMinutes / 60 * 10) / 10,
              percentage: 0
            };
          });

          const totalCategoryHours = categoryStats.reduce((sum, cat) => sum + cat.hours, 0);
          categoryStats.forEach(cat => {
            cat.percentage = totalCategoryHours > 0 ? Math.round((cat.hours / totalCategoryHours) * 100) : 0;
          });

          // Project stats (only for actual events)
          const projectStats = eventType === 'actual' ? yearlyProjects.map(project => {
            const projectEvents = events.filter(e => 
              e.projectId === project.id && 
              e.type === 'actual' &&
              new Date(e.startDateTime) >= startDate &&
              new Date(e.startDateTime) <= endDate
            );

            const totalMinutes = projectEvents.reduce((sum, event) => {
              const start = new Date(event.startDateTime);
              const end = new Date(event.endDateTime);
              return sum + (end - start) / (1000 * 60);
            }, 0);

            return {
              ...project,
              hours: Math.round(totalMinutes / 60 * 10) / 10,
              percentage: 0
            };
          }) : [];

          const totalProjectHours = projectStats.reduce((sum, proj) => sum + proj.hours, 0);
          projectStats.forEach(proj => {
            proj.percentage = totalProjectHours > 0 ? Math.round((proj.hours / totalProjectHours) * 100) : 0;
          });

          return { categoryStats, projectStats };
        };

        const plannedStats = calculateStats('planned');
        const actualStats = calculateStats('actual');
        const hasPlannedData = plannedStats.categoryStats.some(stat => stat.hours > 0);
        const hasActualData = actualStats.categoryStats.some(stat => stat.hours > 0);

        return (
          <div className="analytics-panel">
            <div className="analytics-header" style={{ marginBottom: '20px' }}>
              <h2>Time Analytics</h2>
              <div style={{ display: 'flex', gap: '8px', alignItems: 'center', flexWrap: 'wrap' }}>
                <select 
                  value={timeRange} 
                  onChange={e => {
                    setTimeRange(e.target.value);
                    if (e.target.value !== 'custom') {
                      setCustomStartDate('');
                      setCustomEndDate('');
                    }
                  }}
                  style={{ minWidth: '120px' }}
                >
                  <option value="day">Today</option>
                  <option value="week">Last 7 Days</option>
                  <option value="month">Last 30 Days</option>
                  <option value="year">Last Year</option>
                  <option value="custom">Custom Range</option>
                </select>

                {timeRange === 'custom' && (
                  <>
                    <input 
                      type="date" 
                      value={customStartDate}
                      onChange={e => setCustomStartDate(e.target.value)}
                      style={{ padding: '6px 10px', borderRadius: '6px', border: '1px solid #d4e8d9' }}
                    />
                    <span style={{ color: '#6b9b7a' }}>to</span>
                    <input 
                      type="date" 
                      value={customEndDate}
                      onChange={e => setCustomEndDate(e.target.value)}
                      style={{ padding: '6px 10px', borderRadius: '6px', border: '1px solid #d4e8d9' }}
                    />
                  </>
                )}
              </div>
            </div>

            {!hasPlannedData && !hasActualData && (
              <p style={{ color: '#6b9b7a', textAlign: 'center', padding: '20px' }}>
                No events recorded for this time period. Create some events to see analytics!
              </p>
            )}

            {(hasPlannedData || hasActualData) && (
              <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '24px' }}>
                {/* Planned Section */}
                <div>
                  <div style={{
                    padding: '12px',
                    background: 'linear-gradient(135deg, #e8f5eb 0%, #d4e8d9 100%)',
                    borderRadius: '8px',
                    marginBottom: '16px',
                    border: '2px dashed #4a7c59',
                    textAlign: 'center'
                  }}>
                    <span style={{ fontSize: '14px', fontWeight: 600, color: '#2d5a3d' }}>
                      üìã Planned Time
                    </span>
                  </div>

                  {!hasPlannedData && (
                    <p style={{ color: '#6b9b7a', textAlign: 'center', padding: '20px', fontSize: '13px' }}>
                      No planned events in this period
                    </p>
                  )}

                  {hasPlannedData && (
                    <>
                      <h4 style={{ fontSize: '13px', color: '#2d5a3d', marginBottom: '12px', fontWeight: 600 }}>
                        By Category
                      </h4>
                      <div className="category-stats">
                        {plannedStats.categoryStats.filter(s => s.hours > 0).map(stat => (
                          <div key={stat.id} className="stat-item">
                            <div className="stat-header">
                              <div className="stat-color" style={{ 
                                backgroundColor: stat.color,
                                borderStyle: 'dashed',
                                borderWidth: '2px'
                              }}></div>
                              <span className="stat-name">{stat.name}</span>
                              <span className="stat-hours">{stat.hours}h</span>
                            </div>
                            <div className="stat-bar">
                              <div 
                                className="stat-fill" 
                                style={{ 
                                  width: `${stat.percentage}%`,
                                  background: `linear-gradient(135deg, ${stat.color}30 0%, ${stat.color}50 100%)`
                                }}
                              ></div>
                            </div>
                            <div className="stat-percentage">{stat.percentage}%</div>
                          </div>
                        ))}
                      </div>
                    </>
                  )}
                </div>

                {/* Actual Section */}
                <div>
                  <div style={{
                    padding: '12px',
                    background: 'linear-gradient(135deg, #f0f9f4 0%, #e0f0e8 100%)',
                    borderRadius: '8px',
                    marginBottom: '16px',
                    border: '2px solid #6b9b7a',
                    textAlign: 'center'
                  }}>
                    <span style={{ fontSize: '14px', fontWeight: 600, color: '#4a7c59' }}>
                      ‚úÖ Actual Time
                    </span>
                  </div>

                  {!hasActualData && (
                    <p style={{ color: '#6b9b7a', textAlign: 'center', padding: '20px', fontSize: '13px' }}>
                      No actual events in this period
                    </p>
                  )}

                  {hasActualData && (
                    <>
                      <h4 style={{ fontSize: '13px', color: '#2d5a3d', marginBottom: '12px', fontWeight: 600 }}>
                        By Category
                      </h4>
                      <div className="category-stats">
                        {actualStats.categoryStats.filter(s => s.hours > 0).map(stat => (
                          <div key={stat.id} className="stat-item">
                            <div className="stat-header">
                              <div className="stat-color" style={{ backgroundColor: stat.color }}></div>
                              <span className="stat-name">{stat.name}</span>
                              <span className="stat-hours">{stat.hours}h</span>
                            </div>
                            <div className="stat-bar">
                              <div 
                                className="stat-fill" 
                                style={{ 
                                  width: `${stat.percentage}%`,
                                  background: `linear-gradient(135deg, ${stat.color}B0 0%, ${stat.color}D0 100%)`
                                }}
                              ></div>
                            </div>
                            <div className="stat-percentage">{stat.percentage}%</div>
                          </div>
                        ))}
                      </div>

                      {yearlyProjects.length > 0 && showProjectStats && (
                        <>
                          <h4 style={{ 
                            fontSize: '13px', 
                            color: '#2d5a3d', 
                            marginTop: '24px',
                            marginBottom: '12px', 
                            fontWeight: 600,
                            display: 'flex',
                            alignItems: 'center',
                            gap: '6px'
                          }}>
                            üéØ By Project
                          </h4>
                          <div className="category-stats">
                            {actualStats.projectStats.filter(s => s.hours > 0).map(stat => (
                              <div key={stat.id} className="stat-item">
                                <div className="stat-header">
                                  <div className="stat-color" style={{ backgroundColor: '#f39c12' }}></div>
                                  <span className="stat-name">{stat.name}</span>
                                  <span className="stat-hours">{stat.hours}h</span>
                                </div>
                                <div className="stat-bar">
                                  <div 
                                    className="stat-fill" 
                                    style={{ 
                                      width: `${stat.percentage}%`,
                                      background: 'linear-gradient(135deg, #f39c12B0 0%, #f39c12D0 100%)'
                                    }}
                                  ></div>
                                </div>
                                <div className="stat-percentage">{stat.percentage}%</div>
                              </div>
                            ))}
                          </div>
                        </>
                      )}
                    </>
                  )}
                </div>
              </div>
            )}

            <button className="btn-secondary" onClick={() => setShowAnalytics(false)} style={{ width: '100%', marginTop: '20px' }}>Close</button>
          </div>
        );
      };

      const DailyView = () => {
        const [isSelecting, setIsSelecting] = useState(false);
        const [selectionStart, setSelectionStart] = useState(null);
        const [selectionEnd, setSelectionEnd] = useState(null);

        const hours = Array.from({ length: 24 }, (_, i) => i);
        const timeSlots = hours.flatMap(hour => [
          { hour, minute: 0, label: `${hour.toString().padStart(2, '0')}:00` },
          { hour, minute: 30, label: `${hour.toString().padStart(2, '0')}:30` }
        ]);

        const year = currentDate.getFullYear();
        const month = currentDate.getMonth();
        const day = currentDate.getDate();

        const getEventsForDay = () => {
          return events.filter(e => {
            const eventDate = new Date(e.startDateTime);
            return eventDate.getDate() === day && 
                   eventDate.getMonth() === month && 
                   eventDate.getFullYear() === year;
          }).sort((a, b) => new Date(a.startDateTime) - new Date(b.startDateTime));
        };

        const handleMouseDown = (slot) => {
          setIsSelecting(true);
          setSelectionStart(slot);
          setSelectionEnd(slot);
        };

        const handleMouseEnter = (slot) => {
          if (isSelecting) {
            setSelectionEnd(slot);
          }
        };

        const handleMouseUp = () => {
          if (isSelecting && selectionStart && selectionEnd) {
            const start = selectionStart.hour * 60 + selectionStart.minute;
            const end = selectionEnd.hour * 60 + selectionEnd.minute;
            
            const actualStart = Math.min(start, end);
            const actualEnd = Math.max(start, end) + 30;

            const startHour = Math.floor(actualStart / 60);
            const startMin = actualStart % 60;
            const endHour = Math.floor(actualEnd / 60);
            const endMin = actualEnd % 60;

            const eventData = {
              title: '',
              startDate: formatDate(currentDate),
              startTime: `${startHour.toString().padStart(2, '0')}:${startMin.toString().padStart(2, '0')}`,
              endDate: formatDate(currentDate),
              endTime: `${endHour.toString().padStart(2, '0')}:${endMin.toString().padStart(2, '0')}`,
              categoryId: categories[0]?.id || '',
              type: 'planned',
              description: '',
              location: '',
              projectId: ''
            };

            // Open full event modal with prefilled time
            setPrefilledEventData(eventData);
            setShowEventModal(true);
          }
          setIsSelecting(false);
          setSelectionStart(null);
          setSelectionEnd(null);
        };

        const isSlotSelected = (slot) => {
          if (!selectionStart || !selectionEnd) return false;
          const slotTime = slot.hour * 60 + slot.minute;
          const startTime = selectionStart.hour * 60 + selectionStart.minute;
          const endTime = selectionEnd.hour * 60 + selectionEnd.minute;
          const min = Math.min(startTime, endTime);
          const max = Math.max(startTime, endTime);
          return slotTime >= min && slotTime <= max;
        };

        const getEventPosition = (event) => {
          const start = new Date(event.startDateTime);
          const end = new Date(event.endDateTime);
          const startMinutes = start.getHours() * 60 + start.getMinutes();
          const duration = (end - start) / (1000 * 60);
          
          return {
            top: `${(startMinutes / 30) * 40}px`,
            height: `${(duration / 30) * 40}px`
          };
        };

        const dayEvents = getEventsForDay();

        return (
          <div className="daily-view-container">
            {/* Header labels for Planned vs Actual */}
            <div style={{
              display: 'flex',
              marginBottom: '12px',
              paddingLeft: '60px',
              gap: '8px'
            }}>
              <div style={{
                flex: 1,
                textAlign: 'center',
                padding: '8px',
                background: 'linear-gradient(135deg, #e8f5eb 0%, #d4e8d9 100%)',
                borderRadius: '8px',
                fontSize: '13px',
                fontWeight: 600,
                color: '#2d5a3d',
                border: '2px dashed #4a7c59'
              }}>
                üìã Planned
              </div>
              <div style={{
                flex: 1,
                textAlign: 'center',
                padding: '8px',
                background: 'linear-gradient(135deg, #f0f9f4 0%, #e0f0e8 100%)',
                borderRadius: '8px',
                fontSize: '13px',
                fontWeight: 600,
                color: '#4a7c59',
                border: '2px solid #6b9b7a'
              }}>
                ‚úÖ Actual
              </div>
            </div>
            
            <div className="time-grid" onMouseUp={handleMouseUp} onMouseLeave={handleMouseUp}>
              <div className="time-labels">
                {timeSlots.map((slot, index) => (
                  <div key={index} className="time-label">
                    {slot.minute === 0 ? slot.label : ''}
                  </div>
                ))}
              </div>
              <div className="time-slots">
                {timeSlots.map((slot, index) => (
                  <div
                    key={index}
                    className={`time-slot ${isSlotSelected(slot) ? 'selected' : ''}`}
                    onMouseDown={() => handleMouseDown(slot)}
                    onMouseEnter={() => handleMouseEnter(slot)}
                  >
                    {slot.minute === 0 && <div className="hour-line"></div>}
                  </div>
                ))}
                <div className="events-overlay">
                  {/* Center divider line between planned (left) and actual (right) */}
                  <div style={{
                    position: 'absolute',
                    left: '50%',
                    top: 0,
                    bottom: 0,
                    width: '2px',
                    background: 'linear-gradient(to bottom, transparent, rgba(45, 90, 61, 0.1) 5%, rgba(45, 90, 61, 0.1) 95%, transparent)',
                    pointerEvents: 'none',
                    zIndex: 0
                  }}></div>
                  
                  {dayEvents.map(event => {
                    const category = categories.find(c => c.id === event.categoryId);
                    const position = getEventPosition(event);
                    const isPlanned = event.type === 'planned' && !event.completed;
                    
                    // Create gradient based on event type and category color
                    const baseColor = category?.color || '#4a7c59';
                    const background = event.type === 'planned' 
                      ? `linear-gradient(135deg, ${baseColor}20 0%, ${baseColor}40 100%)`  // Light gradient for planned
                      : `linear-gradient(135deg, ${baseColor}B0 0%, ${baseColor}D0 100%)`; // Dark gradient for actual
                    
                    return (
                      <div
                        key={event.id}
                        className={`daily-event ${event.type} ${event.completed ? 'completed' : ''}`}
                        style={{
                          ...position,
                          borderLeftColor: baseColor,
                          background: background
                        }}
                        onClick={() => {
                          if (isPlanned) {
                            setSelectedEventForCompletion(event);
                            setShowCompletionModal(true);
                          }
                        }}
                        title={isPlanned ? 'Click to mark as complete or edit' : ''}
                      >
                        <div className="event-time">
                          {new Date(event.startDateTime).toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' })}
                        </div>
                        <div className="event-title">
                          {event.title}
                          {event.completionStatus === 'completed_on_time' && ' ‚úÖ'}
                          {event.completionStatus === 'completed_late' && ' ‚ö†Ô∏è'}
                          {event.completionStatus === 'incomplete' && ' ‚ùå'}
                        </div>
                        {event.location && <div className="event-location">üìç {event.location}</div>}
                      </div>
                    );
                  })}
                </div>
              </div>
            </div>
          </div>
        );
      };

      const DailyTodoListView = () => {
        const year = currentDate.getFullYear();
        const month = currentDate.getMonth();
        const day = currentDate.getDate();

        const getEventsForDay = () => {
          return events.filter(e => {
            const eventDate = new Date(e.startDateTime);
            return eventDate.getDate() === day && 
                   eventDate.getMonth() === month && 
                   eventDate.getFullYear() === year;
          }).sort((a, b) => new Date(a.startDateTime) - new Date(b.startDateTime));
        };

        const dayEvents = getEventsForDay();
        const plannedEvents = dayEvents.filter(e => e.type === 'planned');
        const completedOnTime = plannedEvents.filter(e => e.completionStatus === 'completed_on_time');
        const completedLate = plannedEvents.filter(e => e.completionStatus === 'completed_late');
        const incomplete = plannedEvents.filter(e => e.completionStatus === 'incomplete');
        const pending = plannedEvents.filter(e => !e.completed);

        // Get late reasons summary
        const lateReasons = events.filter(e => e.completionStatus === 'completed_late' && e.lateReason).map(e => ({
          title: e.title,
          reason: e.lateReason,
          date: new Date(e.startDateTime)
        })).sort((a, b) => b.date - a.date).slice(0, 5);

        return (
          <div style={{ display: 'flex', flexDirection: 'column', gap: '24px' }}>
            {/* Late Reasons Summary */}
            {lateReasons.length > 0 && (
              <div className="sync-section" style={{ padding: '20px' }}>
                <h3 style={{ marginBottom: '16px', color: '#2d5a3d', fontSize: '16px' }}>
                  ‚ö†Ô∏è Recent Delay Reasons
                </h3>
                <div style={{ display: 'flex', flexDirection: 'column', gap: '12px' }}>
                  {lateReasons.map((item, index) => (
                    <div key={index} style={{ 
                      padding: '12px', 
                      background: '#fff3e0', 
                      borderRadius: '8px',
                      borderLeft: '4px solid #f57c00'
                    }}>
                      <div style={{ fontWeight: 600, color: '#2d5a3d', fontSize: '14px', marginBottom: '4px' }}>
                        {item.title}
                      </div>
                      <div style={{ fontSize: '13px', color: '#6b9b7a', marginBottom: '6px' }}>
                        {item.date.toLocaleDateString()}
                      </div>
                      <div style={{ fontSize: '13px', color: '#f57c00' }}>
                        "{item.reason}"
                      </div>
                    </div>
                  ))}
                </div>
              </div>
            )}

            {/* Pending Tasks */}
            {pending.length > 0 && (
              <div className="sync-section" style={{ padding: '20px' }}>
                <h3 style={{ marginBottom: '16px', color: '#2d5a3d', fontSize: '16px' }}>
                  üìã Pending Tasks ({pending.length})
                </h3>
                <div style={{ display: 'flex', flexDirection: 'column', gap: '8px' }}>
                  {pending.map(event => {
                    const category = categories.find(c => c.id === event.categoryId);
                    return (
                      <div 
                        key={event.id} 
                        style={{ 
                          padding: '12px', 
                          background: 'white', 
                          borderRadius: '8px',
                          borderLeft: `4px solid ${category?.color}`,
                          cursor: 'pointer',
                          transition: 'all 0.2s'
                        }}
                        onClick={() => {
                          setSelectedEventForCompletion(event);
                          setShowCompletionModal(true);
                        }}
                        onMouseEnter={e => e.currentTarget.style.background = '#f5f7f5'}
                        onMouseLeave={e => e.currentTarget.style.background = 'white'}
                      >
                        <div style={{ fontWeight: 600, color: '#2d5a3d', marginBottom: '4px' }}>
                          {event.title}
                        </div>
                        <div style={{ fontSize: '13px', color: '#6b9b7a' }}>
                          {new Date(event.startDateTime).toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' })} - {new Date(event.endDateTime).toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' })}
                        </div>
                      </div>
                    );
                  })}
                </div>
              </div>
            )}

            {/* Completed On Time */}
            {completedOnTime.length > 0 && (
              <div className="sync-section" style={{ padding: '20px' }}>
                <h3 style={{ marginBottom: '16px', color: '#2d5a3d', fontSize: '16px' }}>
                  ‚úÖ Completed On Time ({completedOnTime.length})
                </h3>
                <div style={{ display: 'flex', flexDirection: 'column', gap: '8px' }}>
                  {completedOnTime.map(event => {
                    const category = categories.find(c => c.id === event.categoryId);
                    return (
                      <div 
                        key={event.id} 
                        style={{ 
                          padding: '12px', 
                          background: '#e8f5e9', 
                          borderRadius: '8px',
                          borderLeft: `4px solid ${category?.color}`
                        }}
                      >
                        <div style={{ fontWeight: 600, color: '#2d5a3d', marginBottom: '4px' }}>
                          {event.title}
                        </div>
                        <div style={{ fontSize: '13px', color: '#6b9b7a' }}>
                          {new Date(event.startDateTime).toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' })} - {new Date(event.endDateTime).toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' })}
                        </div>
                      </div>
                    );
                  })}
                </div>
              </div>
            )}

            {/* Completed Late */}
            {completedLate.length > 0 && (
              <div className="sync-section" style={{ padding: '20px' }}>
                <h3 style={{ marginBottom: '16px', color: '#2d5a3d', fontSize: '16px' }}>
                  ‚ö†Ô∏è Completed Late ({completedLate.length})
                </h3>
                <div style={{ display: 'flex', flexDirection: 'column', gap: '8px' }}>
                  {completedLate.map(event => {
                    const category = categories.find(c => c.id === event.categoryId);
                    return (
                      <div 
                        key={event.id} 
                        style={{ 
                          padding: '12px', 
                          background: '#fff3e0', 
                          borderRadius: '8px',
                          borderLeft: `4px solid ${category?.color}`
                        }}
                      >
                        <div style={{ fontWeight: 600, color: '#2d5a3d', marginBottom: '4px' }}>
                          {event.title}
                        </div>
                        <div style={{ fontSize: '13px', color: '#6b9b7a', marginBottom: '4px' }}>
                          Planned: {new Date(event.startDateTime).toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' })} - {new Date(event.endDateTime).toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' })}
                        </div>
                        {event.lateReason && (
                          <div style={{ fontSize: '12px', color: '#f57c00', fontStyle: 'italic' }}>
                            Reason: {event.lateReason}
                          </div>
                        )}
                      </div>
                    );
                  })}
                </div>
              </div>
            )}

            {/* Incomplete */}
            {incomplete.length > 0 && (
              <div className="sync-section" style={{ padding: '20px' }}>
                <h3 style={{ marginBottom: '16px', color: '#2d5a3d', fontSize: '16px' }}>
                  ‚ùå Not Completed ({incomplete.length})
                </h3>
                <div style={{ display: 'flex', flexDirection: 'column', gap: '8px' }}>
                  {incomplete.map(event => {
                    const category = categories.find(c => c.id === event.categoryId);
                    return (
                      <div 
                        key={event.id} 
                        style={{ 
                          padding: '12px', 
                          background: '#ffebee', 
                          borderRadius: '8px',
                          borderLeft: `4px solid ${category?.color}`
                        }}
                      >
                        <div style={{ fontWeight: 600, color: '#2d5a3d', marginBottom: '4px' }}>
                          {event.title}
                        </div>
                        <div style={{ fontSize: '13px', color: '#6b9b7a' }}>
                          {new Date(event.startDateTime).toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' })} - {new Date(event.endDateTime).toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' })}
                        </div>
                        {event.incompleteReason && (
                          <div style={{ fontSize: '12px', color: '#c62828', fontStyle: 'italic', marginTop: '4px' }}>
                            Reason: {event.incompleteReason.replace(/_/g, ' ')}
                          </div>
                        )}
                      </div>
                    );
                  })}
                </div>
              </div>
            )}

            {plannedEvents.length === 0 && (
              <div className="placeholder-view">
                <p style={{ color: '#6b9b7a' }}>
                  No planned events for this day
                </p>
              </div>
            )}
          </div>
        );
      };

      const WeeklyView = () => {
        const getWeekDates = () => {
          const curr = new Date(currentDate);
          const first = curr.getDate() - curr.getDay() + 1; // Monday
          const dates = [];
          
          for (let i = 0; i < 7; i++) {
            const date = new Date(curr.setDate(first + i));
            dates.push(new Date(date));
          }
          return dates;
        };

        const weekDates = getWeekDates();

        const getEventsForDate = (date, type) => {
          return events.filter(e => {
            const eventDate = new Date(e.startDateTime);
            return eventDate.toDateString() === date.toDateString() && e.type === type;
          }).sort((a, b) => new Date(a.startDateTime) - new Date(b.startDateTime));
        };

        const handleDayClick = (date) => {
          setCurrentDate(date);
          setView('daily');
        };

        return (
          <div className="weekly-calendar">
            <div style={{ 
              background: 'white',
              borderRadius: '12px',
              padding: '24px',
              boxShadow: '0 2px 8px rgba(0, 0, 0, 0.05)'
            }}>
              {/* Planned Section */}
              <div style={{ marginBottom: '32px' }}>
                <div style={{
                  padding: '12px 16px',
                  background: 'linear-gradient(135deg, #e8f5eb 0%, #d4e8d9 100%)',
                  borderRadius: '8px',
                  marginBottom: '16px',
                  border: '2px dashed #4a7c59',
                  display: 'flex',
                  alignItems: 'center',
                  justifyContent: 'center',
                  gap: '8px'
                }}>
                  <span style={{ fontSize: '16px', fontWeight: 600, color: '#2d5a3d' }}>
                    üìã Planned Events
                  </span>
                </div>

                <div style={{ 
                  display: 'grid',
                  gridTemplateColumns: 'repeat(7, 1fr)',
                  gap: '8px',
                  marginBottom: '12px'
                }}>
                  {['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'].map(day => (
                    <div key={day} className="calendar-day-header">{day}</div>
                  ))}
                </div>

                <div style={{
                  display: 'grid',
                  gridTemplateColumns: 'repeat(7, 1fr)',
                  gap: '8px'
                }}>
                  {weekDates.map((date, index) => {
                    const dayEvents = getEventsForDate(date, 'planned');
                    const isToday = date.toDateString() === new Date().toDateString();

                    return (
                      <div
                        key={index}
                        className={`calendar-day ${isToday ? 'today' : ''}`}
                        style={{ minHeight: '120px', cursor: 'pointer' }}
                        onClick={() => handleDayClick(date)}
                      >
                        <div className="day-number">{date.getDate()}</div>
                        <div className="day-events">
                          {dayEvents.slice(0, 3).map(event => {
                            const category = categories.find(c => c.id === event.categoryId);
                            const baseColor = category?.color || '#4a7c59';
                            return (
                              <div
                                key={event.id}
                                className="event-item planned"
                                style={{ 
                                  borderLeftColor: baseColor,
                                  background: `linear-gradient(135deg, ${baseColor}20 0%, ${baseColor}40 100%)`,
                                  borderStyle: 'dashed'
                                }}
                                title={`${event.title} - planned`}
                              >
                                <div style={{ fontSize: '10px', marginBottom: '2px', opacity: 0.8 }}>
                                  {new Date(event.startDateTime).toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' })}
                                </div>
                                <div style={{ 
                                  overflow: 'hidden', 
                                  textOverflow: 'ellipsis',
                                  textDecoration: event.completed ? 'line-through' : 'none'
                                }}>
                                  {event.title}
                                  {event.completionStatus === 'completed_on_time' && ' ‚úÖ'}
                                  {event.completionStatus === 'completed_late' && ' ‚ö†Ô∏è'}
                                  {event.completionStatus === 'incomplete' && ' ‚ùå'}
                                </div>
                              </div>
                            );
                          })}
                          {dayEvents.length > 3 && (
                            <div className="more-events">+{dayEvents.length - 3} more</div>
                          )}
                        </div>
                      </div>
                    );
                  })}
                </div>
              </div>

              {/* Actual Section */}
              <div>
                <div style={{
                  padding: '12px 16px',
                  background: 'linear-gradient(135deg, #f0f9f4 0%, #e0f0e8 100%)',
                  borderRadius: '8px',
                  marginBottom: '16px',
                  border: '2px solid #6b9b7a',
                  display: 'flex',
                  alignItems: 'center',
                  justifyContent: 'center',
                  gap: '8px'
                }}>
                  <span style={{ fontSize: '16px', fontWeight: 600, color: '#4a7c59' }}>
                    ‚úÖ Actual Events
                  </span>
                </div>

                <div style={{ 
                  display: 'grid',
                  gridTemplateColumns: 'repeat(7, 1fr)',
                  gap: '8px',
                  marginBottom: '12px'
                }}>
                  {['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'].map(day => (
                    <div key={day} className="calendar-day-header">{day}</div>
                  ))}
                </div>

                <div style={{
                  display: 'grid',
                  gridTemplateColumns: 'repeat(7, 1fr)',
                  gap: '8px'
                }}>
                  {weekDates.map((date, index) => {
                    const dayEvents = getEventsForDate(date, 'actual');
                    const isToday = date.toDateString() === new Date().toDateString();

                    return (
                      <div
                        key={index}
                        className={`calendar-day ${isToday ? 'today' : ''}`}
                        style={{ minHeight: '120px', cursor: 'pointer' }}
                        onClick={() => handleDayClick(date)}
                      >
                        <div className="day-number">{date.getDate()}</div>
                        <div className="day-events">
                          {dayEvents.slice(0, 3).map(event => {
                            const category = categories.find(c => c.id === event.categoryId);
                            const baseColor = category?.color || '#4a7c59';
                            return (
                              <div
                                key={event.id}
                                className="event-item actual"
                                style={{ 
                                  borderLeftColor: baseColor,
                                  background: `linear-gradient(135deg, ${baseColor}B0 0%, ${baseColor}D0 100%)`,
                                  borderStyle: 'solid'
                                }}
                                title={`${event.title} - actual`}
                              >
                                <div style={{ fontSize: '10px', marginBottom: '2px', opacity: 0.8 }}>
                                  {new Date(event.startDateTime).toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' })}
                                </div>
                                <div style={{ overflow: 'hidden', textOverflow: 'ellipsis' }}>
                                  {event.title}
                                  {event.completionStatus === 'completed_on_time' && ' ‚úÖ'}
                                  {event.completionStatus === 'completed_late' && ' ‚ö†Ô∏è'}
                                  {event.completionStatus === 'incomplete' && ' ‚ùå'}
                                </div>
                              </div>
                            );
                          })}
                          {dayEvents.length > 3 && (
                            <div className="more-events">+{dayEvents.length - 3} more</div>
                          )}
                        </div>
                      </div>
                    );
                  })}
                </div>
              </div>
            </div>
          </div>
        );
      };

      const MonthlyView = () => {
        const year = currentDate.getFullYear();
        const month = currentDate.getMonth();
        const firstDay = new Date(year, month, 1);
        const lastDay = new Date(year, month + 1, 0);
        const startingDayOfWeek = firstDay.getDay();
        const daysInMonth = lastDay.getDate();

        const days = [];
        for (let i = 0; i < startingDayOfWeek; i++) {
          days.push(null);
        }
        for (let i = 1; i <= daysInMonth; i++) {
          days.push(i);
        }

        const getEventsForDay = (day) => {
          if (!day) return [];
          const date = new Date(year, month, day);
          return events.filter(e => {
            const eventDate = new Date(e.startDateTime);
            return eventDate.getDate() === day && 
                   eventDate.getMonth() === month && 
                   eventDate.getFullYear() === year;
          });
        };

        return (
          <div className="calendar-grid">
            <div className="calendar-header">
              {['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'].map(day => (
                <div key={day} className="calendar-day-header">{day}</div>
              ))}
            </div>
            <div className="calendar-body">
              {days.map((day, index) => {
                const dayEvents = getEventsForDay(day);
                const isToday = day && 
                  day === new Date().getDate() && 
                  month === new Date().getMonth() && 
                  year === new Date().getFullYear();

                return (
                  <div 
                    key={index} 
                    className={`calendar-day ${!day ? 'empty' : ''} ${isToday ? 'today' : ''}`}
                    onClick={() => {
                      if (day) {
                        const newDate = new Date(year, month, day);
                        setCurrentDate(newDate);
                        setView('daily');
                      }
                    }}
                  >
                    {day && (
                      <>
                        <div className="day-number">{day}</div>
                        <div className="day-events">
                          {dayEvents.slice(0, 3).map(event => {
                            const category = categories.find(c => c.id === event.categoryId);
                            return (
                              <div 
                                key={event.id} 
                                className={`event-item ${event.type}`}
                                style={{ borderLeftColor: category?.color }}
                                title={`${event.title} - ${event.type}`}
                              >
                                {event.title}
                              </div>
                            );
                          })}
                          {dayEvents.length > 3 && (
                            <div className="more-events">+{dayEvents.length - 3} more</div>
                          )}
                        </div>
                      </>
                    )}
                  </div>
                );
              })}
            </div>
          </div>
        );
      };

      const navigateCalendar = (direction) => {
        const newDate = new Date(currentDate);
        switch(view) {
          case 'daily':
            newDate.setDate(newDate.getDate() + direction);
            break;
          case 'weekly':
            newDate.setDate(newDate.getDate() + (direction * 7));
            break;
          case 'monthly':
            newDate.setMonth(newDate.getMonth() + direction);
            break;
          case 'yearly':
            newDate.setFullYear(newDate.getFullYear() + direction);
            break;
        }
        setCurrentDate(newDate);
      };

      return (
        <div>
          <div className="countdown-bar">
            {yearlyProjects.length === 0 && (
              <div className="countdown-item">
                <span>No yearly projects. Click settings to add up to 3 projects ‚Üí</span>
              </div>
            )}
            {yearlyProjects.map(project => {
              const daysLeft = getDaysUntil(project.deadline);
              return (
                <div key={project.id} className="countdown-item">
                  <Target />
                  <span>{daysLeft} Days until {project.name} DDL</span>
                </div>
              );
            })}
            <button className="countdown-settings" onClick={() => setShowProjectModal(true)}>
              üéØ
            </button>
          </div>

          <header className="app-header">
            <div className="header-left">
              <h1 
                onClick={() => setView('weekly')} 
                style={{ cursor: 'pointer', transition: 'color 0.2s' }}
                onMouseEnter={e => e.target.style.color = '#4a7c59'}
                onMouseLeave={e => e.target.style.color = '#2d5a3d'}
                title="Back to Weekly View"
              >
                TimeWise
              </h1>
              <div className="view-switcher">
                <button 
                  className={view === 'daily' ? 'active' : ''}
                  onClick={() => setView('daily')}
                >
                  Day
                </button>
                <button 
                  className={view === 'weekly' ? 'active' : ''}
                  onClick={() => setView('weekly')}
                >
                  Week
                </button>
                <button 
                  className={view === 'monthly' ? 'active' : ''}
                  onClick={() => setView('monthly')}
                >
                  Month
                </button>
                <button 
                  className={view === 'yearly' ? 'active' : ''}
                  onClick={() => setView('yearly')}
                >
                  Year
                </button>
              </div>
            </div>

            <div className="header-right">
              <button 
                className="btn-icon" 
                onClick={() => setShowExportModal(true)} 
                title="Export to Google Sheets"
              >
                üìã
              </button>
              <button 
                className="btn-icon" 
                onClick={() => setShowSyncModal(true)} 
                title="Google Calendar Sync"
                style={{ position: 'relative' }}
              >
                üîó
                {googleConnected && (
                  <span style={{ 
                    position: 'absolute', 
                    top: '6px', 
                    right: '6px', 
                    width: '8px', 
                    height: '8px', 
                    background: '#4caf50', 
                    borderRadius: '50%',
                    border: '2px solid white'
                  }}></span>
                )}
              </button>
              <button 
                className="btn-icon" 
                onClick={() => {
                  if (view !== 'weekly') setView('weekly');
                }} 
                title="Calendar View"
              >
                üìÖ
              </button>
              <button 
                className="btn-icon" 
                onClick={() => setShowAnalytics(true)} 
                title="Analytics"
              >
                üìä
              </button>
              <button className="btn-icon" onClick={() => setShowCategoryModal(true)} title="Manage Categories">
                üìì
              </button>
              <button className="btn-icon" title="Notifications">
                <Bell />
              </button>
              <button className="btn-primary" onClick={() => setShowEventModal(true)}>
                <Plus /> New Event
              </button>
            </div>
          </header>

          <div className="calendar-nav">
            <button onClick={() => navigateCalendar(-1)}>
              <ChevronLeft />
            </button>
            <h2>
              {view === 'yearly' && currentDate.getFullYear()}
              {view === 'monthly' && currentDate.toLocaleDateString('en-US', { month: 'long', year: 'numeric' })}
              {view === 'weekly' && `Week of ${currentDate.toLocaleDateString()}`}
              {view === 'daily' && currentDate.toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric', year: 'numeric' })}
            </h2>
            <button onClick={() => navigateCalendar(1)}>
              <ChevronRight />
            </button>
            <button className="btn-today" onClick={() => setCurrentDate(new Date())}>Today</button>
            
            {view === 'daily' && (
              <div className="daily-toggle">
                <button 
                  className={dailyViewMode === 'calendar' ? 'active' : ''}
                  onClick={() => setDailyViewMode('calendar')}
                >
                  <Grid /> Calendar
                </button>
                <button 
                  className={dailyViewMode === 'todolist' ? 'active' : ''}
                  onClick={() => setDailyViewMode('todolist')}
                >
                  <List /> Todo List
                </button>
              </div>
            )}
          </div>

          <main className="main-content">
            {showAnalytics && <Analytics />}
            
            {!showAnalytics && view === 'monthly' && <MonthlyView />}
            
            {!showAnalytics && view === 'weekly' && <WeeklyView />}
            
            {!showAnalytics && view === 'daily' && dailyViewMode === 'calendar' && <DailyView />}
            
            {!showAnalytics && view === 'daily' && dailyViewMode === 'todolist' && <DailyTodoListView />}
            
            {!showAnalytics && view === 'yearly' && (
              <div className="placeholder-view">
                <h3 style={{ color: '#4a7c59', marginBottom: '16px' }}>
                  Yearly View
                </h3>
                <p style={{ color: '#6b9b7a' }}>
                  Coming soon! For now, use the Monthly view to manage your events.
                </p>
              </div>
            )}
          </main>

          {showEventModal && <EventModal />}
          {showCategoryModal && <CategoryModal />}
          {showProjectModal && <ProjectModal />}
          {showSyncModal && <GoogleSyncModal />}
          {showCompletionModal && <CompletionModal />}
          {showExportModal && <ExportModal />}
          {showGoogleSetupModal && <GoogleSetupModal />}
        </div>
      );
    };

    ReactDOM.render(<App />, document.getElementById('root'));
  </script>
</body>
</html>
