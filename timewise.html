<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TimeWise - Time Management App</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'DM Sans', -apple-system, BlinkMacSystemFont, sans-serif;
      background: linear-gradient(135deg, #f5f7f5 0%, #e8f0e8 100%);
      min-height: 100vh;
      color: #2d5a3d;
    }

    #root {
      min-height: 100vh;
    }

    .countdown-bar {
      background: linear-gradient(90deg, #2d5a3d 0%, #4a7c59 100%);
      color: white;
      padding: 12px 24px;
      display: flex;
      gap: 32px;
      align-items: center;
      box-shadow: 0 2px 8px rgba(45, 90, 61, 0.15);
    }

    .countdown-item {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 14px;
      font-weight: 500;
    }

    .countdown-settings {
      margin-left: auto;
      background: rgba(255, 255, 255, 0.2);
      border: none;
      color: white;
      padding: 6px 10px;
      border-radius: 6px;
      cursor: pointer;
      display: flex;
      align-items: center;
      transition: all 0.2s;
    }

    .countdown-settings:hover {
      background: rgba(255, 255, 255, 0.3);
    }

    .app-header {
      background: white;
      padding: 20px 24px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 32px;
    }

    h1 {
      font-size: 28px;
      font-weight: 700;
      color: #2d5a3d;
      letter-spacing: -0.5px;
    }

    .view-switcher {
      display: flex;
      gap: 4px;
      background: #f5f7f5;
      padding: 4px;
      border-radius: 8px;
    }

    .view-switcher button {
      padding: 8px 16px;
      border: none;
      background: transparent;
      color: #6b9b7a;
      font-weight: 500;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .view-switcher button.active {
      background: white;
      color: #2d5a3d;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }

    .header-right {
      display: flex;
      gap: 12px;
      align-items: center;
    }

    .btn-icon {
      background: white;
      border: 1px solid #e0e7e0;
      padding: 10px;
      border-radius: 8px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #4a7c59;
      transition: all 0.2s;
    }

    .btn-icon:hover {
      background: #f5f7f5;
      border-color: #6b9b7a;
    }

    .btn-primary {
      background: #4a7c59;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: all 0.2s;
    }

    .btn-primary:hover {
      background: #3d6749;
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(74, 124, 89, 0.3);
    }

    .btn-secondary {
      background: white;
      color: #4a7c59;
      border: 1px solid #4a7c59;
      padding: 10px 20px;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn-secondary:hover {
      background: #f5f7f5;
    }

    .calendar-nav {
      background: white;
      padding: 16px 24px;
      display: flex;
      align-items: center;
      gap: 16px;
      border-bottom: 1px solid #e0e7e0;
      flex-wrap: wrap;
    }

    .calendar-nav button {
      background: white;
      border: 1px solid #e0e7e0;
      padding: 8px 12px;
      border-radius: 6px;
      cursor: pointer;
      display: flex;
      align-items: center;
      color: #4a7c59;
      transition: all 0.2s;
    }

    .calendar-nav button:hover {
      background: #f5f7f5;
      border-color: #6b9b7a;
    }

    .calendar-nav h2 {
      font-size: 20px;
      font-weight: 600;
      color: #2d5a3d;
    }

    .btn-today {
      margin-left: auto;
      padding: 8px 16px;
      font-weight: 600;
    }

    .daily-toggle {
      display: flex;
      gap: 4px;
      background: #f5f7f5;
      padding: 4px;
      border-radius: 6px;
    }

    .daily-toggle button {
      padding: 6px 12px;
      border: none;
      background: transparent;
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 14px;
    }

    .daily-toggle button.active {
      background: white;
      box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
    }

    .main-content {
      padding: 24px;
      max-width: 1400px;
      margin: 0 auto;
    }

    .calendar-grid {
      background: white;
      border-radius: 12px;
      padding: 24px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    }

    .calendar-header {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 8px;
      margin-bottom: 16px;
    }

    .calendar-day-header {
      text-align: center;
      font-weight: 600;
      color: #6b9b7a;
      padding: 12px;
      font-size: 14px;
    }

    .calendar-body {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 8px;
    }

    .calendar-day {
      min-height: 120px;
      border: 1px solid #e0e7e0;
      border-radius: 8px;
      padding: 8px;
      background: #fafbfa;
      transition: all 0.2s;
    }

    .calendar-day:hover:not(.empty) {
      background: #f5f7f5;
      border-color: #6b9b7a;
      cursor: pointer;
    }

    .calendar-day.empty {
      background: transparent;
      border: none;
    }

    .calendar-day.today {
      background: #e8f5eb;
      border-color: #4a7c59;
    }

    .day-number {
      font-weight: 600;
      color: #2d5a3d;
      margin-bottom: 8px;
    }

    .day-events {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .event-item {
      font-size: 12px;
      padding: 6px 8px;
      background: white;
      border-left: 3px solid #4a7c59;
      border-radius: 4px;
      overflow: hidden;
      text-overflow: ellipsis;
      margin-bottom: 4px;
    }

    .event-item.planned {
      border-style: dashed;
    }

    .event-item.actual {
      border-style: solid;
    }

    .more-events {
      font-size: 11px;
      color: #6b9b7a;
      text-align: center;
      padding: 4px;
    }

    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(45, 90, 61, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      backdrop-filter: blur(4px);
    }

    .modal {
      background: white;
      padding: 32px;
      border-radius: 16px;
      max-width: 500px;
      width: 90%;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 20px 60px rgba(45, 90, 61, 0.3);
    }

    .modal h2 {
      margin-bottom: 24px;
      color: #2d5a3d;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: #4a7c59;
      font-size: 14px;
    }

    .form-group input,
    .form-group select,
    .form-group textarea {
      width: 100%;
      padding: 10px 12px;
      border: 1px solid #e0e7e0;
      border-radius: 8px;
      font-size: 14px;
      font-family: inherit;
      transition: all 0.2s;
    }

    .form-group input:focus,
    .form-group select:focus,
    .form-group textarea:focus {
      outline: none;
      border-color: #4a7c59;
      box-shadow: 0 0 0 3px rgba(74, 124, 89, 0.1);
    }

    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }

    .event-type-toggle {
      display: flex;
      gap: 8px;
    }

    .event-type-toggle button {
      flex: 1;
      padding: 10px;
      border: 1px solid #e0e7e0;
      background: white;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      color: #6b9b7a;
      transition: all 0.2s;
    }

    .event-type-toggle button.active {
      background: #4a7c59;
      color: white;
      border-color: #4a7c59;
    }

    .modal-actions {
      display: flex;
      gap: 12px;
      justify-content: flex-end;
      margin-top: 24px;
    }

    .category-list,
    .project-list {
      margin-bottom: 24px;
    }

    .category-item,
    .project-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px;
      background: #f5f7f5;
      border-radius: 8px;
      margin-bottom: 8px;
    }

    .category-color {
      width: 24px;
      height: 24px;
      border-radius: 6px;
      flex-shrink: 0;
    }

    .project-deadline {
      font-size: 12px;
      color: #6b9b7a;
    }

    .btn-delete {
      margin-left: auto;
      background: #ff6b6b;
      color: white;
      border: none;
      width: 28px;
      height: 28px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
      flex-shrink: 0;
    }

    .btn-delete:hover {
      background: #ff5252;
    }

    .analytics-panel {
      background: white;
      padding: 32px;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    }

    .analytics-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 32px;
    }

    .analytics-header select {
      padding: 8px 12px;
      border: 1px solid #e0e7e0;
      border-radius: 6px;
      font-size: 14px;
    }

    .category-stats {
      display: flex;
      flex-direction: column;
      gap: 24px;
      margin-bottom: 32px;
    }

    .stat-item {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .stat-header {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .stat-color {
      width: 20px;
      height: 20px;
      border-radius: 4px;
      flex-shrink: 0;
    }

    .stat-name {
      font-weight: 600;
      color: #2d5a3d;
    }

    .stat-hours {
      margin-left: auto;
      font-weight: 600;
      color: #4a7c59;
    }

    .stat-bar {
      height: 12px;
      background: #f5f7f5;
      border-radius: 6px;
      overflow: hidden;
    }

    .stat-fill {
      height: 100%;
      transition: width 0.3s ease;
    }

    .stat-percentage {
      font-size: 12px;
      color: #6b9b7a;
      text-align: right;
    }

    .placeholder-view {
      background: white;
      padding: 60px 24px;
      border-radius: 12px;
      text-align: center;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    }

    .daily-view-container {
      background: white;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
      overflow: hidden;
    }

    .time-grid {
      display: flex;
      position: relative;
      user-select: none;
    }

    .time-labels {
      width: 80px;
      flex-shrink: 0;
      border-right: 1px solid #e0e7e0;
    }

    .time-label {
      height: 40px;
      display: flex;
      align-items: flex-start;
      justify-content: flex-end;
      padding-right: 12px;
      padding-top: 4px;
      font-size: 12px;
      color: #6b9b7a;
      font-weight: 500;
    }

    .time-slots {
      flex: 1;
      position: relative;
    }

    .time-slot {
      height: 40px;
      border-bottom: 1px solid #f0f4f0;
      cursor: pointer;
      position: relative;
      transition: background 0.15s;
    }

    .time-slot:hover {
      background: #f5f7f5;
    }

    .time-slot.selected {
      background: #d4e8d9;
    }

    .hour-line {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 1px;
      background: #e0e7e0;
    }

    .events-overlay {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      pointer-events: none;
    }

    .daily-event {
      position: absolute;
      border-left: 4px solid #4a7c59;
      border-radius: 6px;
      padding: 8px 12px;
      pointer-events: auto;
      cursor: pointer;
      overflow: hidden;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      transition: all 0.2s;
    }

    .daily-event.planned {
      left: 8px;
      right: 50%;
      margin-right: 4px;
      opacity: 1;
      border-style: dashed;
    }

    .daily-event.actual {
      left: 50%;
      right: 8px;
      margin-left: 4px;
      opacity: 1;
      border-style: solid;
    }

    .daily-event:hover {
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
      transform: translateY(-1px);
    }

    .daily-event.completed {
      opacity: 1;
    }

    .daily-event.completed .event-title {
      text-decoration: line-through;
    }

    .daily-event.planned:not(.completed) {
      cursor: pointer;
    }

    .daily-event.planned:not(.completed):hover {
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
      transform: translateX(4px);
    }

    .event-type-toggle button {
      background: white;
      color: #6b9b7a;
    }

    .event-type-toggle button.active {
      background: #4a7c59;
      color: white;
    }

    .weekly-view {
      background: transparent;
    }

    .event-time {
      font-size: 11px;
      font-weight: 600;
      color: #2d5a3d;
      margin-bottom: 2px;
    }

    .event-title {
      font-size: 13px;
      font-weight: 600;
      color: #2d5a3d;
      margin-bottom: 2px;
    }

    .event-location {
      font-size: 11px;
      color: #6b9b7a;
    }

    .sync-section {
      background: white;
      padding: 24px;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
      margin-bottom: 24px;
    }

    .sync-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }

    .sync-status {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 16px;
      background: #f5f7f5;
      border-radius: 6px;
      font-size: 14px;
    }

    .sync-status.connected {
      background: #e8f5eb;
      color: #2d5a3d;
    }

    .sync-status.disconnected {
      background: #fff3e0;
      color: #f57c00;
    }

    .btn-google {
      background: white;
      color: #4285f4;
      border: 1px solid #4285f4;
      padding: 10px 20px;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: all 0.2s;
    }

    .btn-google:hover {
      background: #4285f4;
      color: white;
    }

    @media (max-width: 768px) {
      .app-header {
        flex-direction: column;
        gap: 16px;
      }

      .header-left {
        flex-direction: column;
        align-items: flex-start;
        gap: 16px;
        width: 100%;
      }

      .header-right {
        width: 100%;
        justify-content: space-between;
      }

      .calendar-nav {
        gap: 8px;
      }

      .calendar-nav h2 {
        width: 100%;
        font-size: 16px;
      }

      .calendar-day-header {
        font-size: 12px;
        padding: 8px 4px;
      }

      .calendar-day {
        min-height: 80px;
        padding: 4px;
      }

      .form-row {
        grid-template-columns: 1fr;
      }

      .btn-today {
        margin-left: 0;
      }
    }

    /* Button Active/Pressed States */
    button {
      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      user-select: none;
    }

    button:active {
      transform: scale(0.97);
    }

    .btn-primary:active {
      background: linear-gradient(135deg, #3d6b4a 0%, #2d5a3d 100%);
      box-shadow: inset 0 3px 6px rgba(0,0,0,0.2);
    }

    .btn-secondary:active {
      background: #e0f0e8;
      border-color: #4a7c59;
      box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
    }

    .btn-icon:active {
      background: rgba(107, 155, 122, 0.3);
      box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
    }

    .view-switcher button:active {
      transform: scale(0.96);
    }

    .calendar-nav button:active {
      background: rgba(107, 155, 122, 0.2);
    }

    /* Timeline Animations */
    @keyframes pulse {
      0%, 100% {
        opacity: 1;
        transform: translate(-50%, -50%) scale(1);
      }
      50% {
        opacity: 0.6;
        transform: translate(-50%, -50%) scale(1.3);
      }
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes shimmer {
      0% {
        background-position: -1000px 0;
      }
      100% {
        background-position: 1000px 0;
      }
    }

    /* Button Active/Pressed States */
    button {
      user-select: none;
    }

    button:active {
      transform: scale(0.97);
    }

    .btn-primary:active {
      background: linear-gradient(135deg, #3d6b4a 0%, #2d5a3d 100%);
      box-shadow: inset 0 3px 6px rgba(0,0,0,0.2);
    }

    .btn-secondary:active {
      background: #e0f0e8;
      border-color: #4a7c59;
      box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
    }

    .btn-icon:active {
      background: rgba(107, 155, 122, 0.3);
      box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
    }

    .view-switcher button:active {
      transform: scale(0.96);
    }

    .calendar-nav button:active {
      background: rgba(107, 155, 122, 0.2);
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    // Simple icon components
    const ChevronLeft = () => <span>‚Üê</span>;
    const ChevronRight = () => <span>‚Üí</span>;
    const Plus = () => <span>+</span>;
    const Settings = () => <span>‚öôÔ∏è</span>;
    const BarChart3 = () => <span>üìä</span>;
    const Bell = () => <span>üîî</span>;
    const Target = () => <span>üéØ</span>;
    const Grid = () => <span>üìÖ</span>;
    const List = () => <span>üìã</span>;

    // Utility functions
    const formatDate = (date) => {
      return date.toISOString().split('T')[0];
    };

    const formatTime = (date) => {
      return date.toTimeString().slice(0, 5);
    };

    const App = () => {
      const [currentDate, setCurrentDate] = useState(new Date());
      const [view, setView] = useState('timeline');
      const [dailyViewMode, setDailyViewMode] = useState('calendar');
      const [events, setEvents] = useState([]);
      const [viewRefreshKey, setViewRefreshKey] = useState(0);
      const [categories, setCategories] = useState([
        { id: '1', name: 'Sleep', color: '#8e44ad' },
        { id: '2', name: 'Reading', color: '#3498db' },
        { id: '3', name: 'Working', color: '#e74c3c' },
        { id: '4', name: 'Sports', color: '#f39c12' }
      ]);
      const [yearlyProjects, setYearlyProjects] = useState([
        { id: '1', name: 'Q4 Financial Report', deadline: new Date('2025-03-31') },
        { id: '2', name: 'Yoga Certification', deadline: new Date('2025-06-15') }
      ]);
      const [showEventModal, setShowEventModal] = useState(false);
      const [showCategoryModal, setShowCategoryModal] = useState(false);
      const [showProjectModal, setShowProjectModal] = useState(false);
      const [showAnalytics, setShowAnalytics] = useState(false);
      const [showSyncModal, setShowSyncModal] = useState(false);
      const [showCompletionModal, setShowCompletionModal] = useState(false);
      const [showExportModal, setShowExportModal] = useState(false);
      const [showGoogleSetupModal, setShowGoogleSetupModal] = useState(false);
      const [selectedEventForCompletion, setSelectedEventForCompletion] = useState(null);
      const [prefilledEventData, setPrefilledEventData] = useState(null);
      const [googleConnected, setGoogleConnected] = useState(false);
      const [syncStatus, setSyncStatus] = useState('disconnected');
      const [googleSheetUrl, setGoogleSheetUrl] = useState('');
      const [googleClientId, setGoogleClientId] = useState('');
      const [googleAccessToken, setGoogleAccessToken] = useState('');
      
      // Weekly Journal & Growth Tracking
      const [journalDocUrl, setJournalDocUrl] = useState('');
      const [weeklyGoals, setWeeklyGoals] = useState({}); // { 'YYYY-WW': { goal: '', highlight: '', lowlight: '' } }
      const [showJournalModal, setShowJournalModal] = useState(false);
      const [showWeeklyReflectionModal, setShowWeeklyReflectionModal] = useState(false);

      // Load data from localStorage
      useEffect(() => {
        const savedEvents = localStorage.getItem('timewise_events');
        const savedCategories = localStorage.getItem('timewise_categories');
        const savedProjects = localStorage.getItem('timewise_projects');
        const savedGoogleConnection = localStorage.getItem('google_connected');
        const savedSheetUrl = localStorage.getItem('google_sheet_url');
        const savedClientId = localStorage.getItem('google_client_id');
        const savedAccessToken = localStorage.getItem('google_access_token');
        const savedTokenExpiry = localStorage.getItem('google_token_expiry');
        const savedJournalUrl = localStorage.getItem('journal_doc_url');
        const savedWeeklyGoals = localStorage.getItem('weekly_goals');
        
        if (savedEvents) setEvents(JSON.parse(savedEvents));
        if (savedCategories) setCategories(JSON.parse(savedCategories));
        if (savedProjects) {
          const projects = JSON.parse(savedProjects);
          setYearlyProjects(projects.map(p => ({ ...p, deadline: new Date(p.deadline) })));
        }
        if (savedSheetUrl) {
          setGoogleSheetUrl(savedSheetUrl);
        }
        if (savedClientId) {
          setGoogleClientId(savedClientId);
        }
        if (savedJournalUrl) {
          setJournalDocUrl(savedJournalUrl);
        }
        if (savedWeeklyGoals) {
          setWeeklyGoals(JSON.parse(savedWeeklyGoals));
        }
        
        // Check if token is still valid
        if (savedGoogleConnection === 'true' && savedAccessToken && savedTokenExpiry) {
          const expiry = parseInt(savedTokenExpiry);
          if (Date.now() < expiry) {
            setGoogleConnected(true);
            setGoogleAccessToken(savedAccessToken);
            setSyncStatus('connected');
          } else {
            // Token expired, clear connection
            setGoogleConnected(false);
            setSyncStatus('disconnected');
            localStorage.removeItem('google_connected');
            localStorage.removeItem('google_access_token');
            localStorage.removeItem('google_token_expiry');
          }
        }
      }, []);

      // Save to localStorage
      useEffect(() => {
        localStorage.setItem('timewise_events', JSON.stringify(events));
      }, [events]);

      useEffect(() => {
        localStorage.setItem('timewise_categories', JSON.stringify(categories));
      }, [categories]);

      useEffect(() => {
        localStorage.setItem('timewise_projects', JSON.stringify(yearlyProjects));
      }, [yearlyProjects]);

      useEffect(() => {
        localStorage.setItem('journal_doc_url', journalDocUrl);
      }, [journalDocUrl]);

      useEffect(() => {
        localStorage.setItem('weekly_goals', JSON.stringify(weeklyGoals));
      }, [weeklyGoals]);

      const getDaysUntil = (deadline) => {
        const today = new Date();
        today.setHours(0, 0, 0, 0);
        const target = new Date(deadline);
        target.setHours(0, 0, 0);
        const diffTime = target - today;
        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
        return diffDays;
      };

      // Helper function to get week key (YYYY-WW format)
      const getWeekKey = (date) => {
        const d = new Date(date);
        const year = d.getFullYear();
        const firstDayOfYear = new Date(year, 0, 1);
        const pastDaysOfYear = (d - firstDayOfYear) / 86400000;
        const weekNumber = Math.ceil((pastDaysOfYear + firstDayOfYear.getDay() + 1) / 7);
        return `${year}-W${String(weekNumber).padStart(2, '0')}`;
      };

      // Get current week's data
      const getCurrentWeekData = () => {
        const weekKey = getWeekKey(currentDate);
        return weeklyGoals[weekKey] || { goal: '', highlight: '', lowlight: '' };
      };

      // Calculate tracking streak (consecutive days with actual events)
      const getTrackingStreak = () => {
        const sortedDates = [...new Set(
          events
            .filter(e => e.type === 'actual')
            .map(e => new Date(e.startDateTime).toDateString())
        )].sort((a, b) => new Date(b) - new Date(a));
        
        if (sortedDates.length === 0) return 0;
        
        let streak = 0;
        let checkDate = new Date();
        checkDate.setHours(0, 0, 0, 0);
        
        for (const dateStr of sortedDates) {
          const date = new Date(dateStr);
          const diffDays = Math.round((checkDate - date) / (1000 * 60 * 60 * 24));
          
          if (diffDays === streak) {
            streak++;
            checkDate.setDate(checkDate.getDate() - 1);
          } else {
            break;
          }
        }
        
        return streak;
      };

      // Calculate week comparison (current week vs last week)
      const getWeekComparison = () => {
        const now = new Date();
        const thisWeekStart = new Date(now);
        thisWeekStart.setDate(now.getDate() - now.getDay());
        thisWeekStart.setHours(0, 0, 0, 0);
        
        const lastWeekStart = new Date(thisWeekStart);
        lastWeekStart.setDate(lastWeekStart.getDate() - 7);
        
        const thisWeekEvents = events.filter(e => 
          new Date(e.startDateTime) >= thisWeekStart && e.type === 'actual'
        );
        
        const lastWeekEvents = events.filter(e => {
          const date = new Date(e.startDateTime);
          return date >= lastWeekStart && date < thisWeekStart && e.type === 'actual';
        });
        
        const thisWeekHours = thisWeekEvents.reduce((sum, e) => {
          const duration = (new Date(e.endDateTime) - new Date(e.startDateTime)) / (1000 * 60 * 60);
          return sum + duration;
        }, 0);
        
        const lastWeekHours = lastWeekEvents.reduce((sum, e) => {
          const duration = (new Date(e.endDateTime) - new Date(e.startDateTime)) / (1000 * 60 * 60);
          return sum + duration;
        }, 0);
        
        const change = lastWeekHours > 0 
          ? Math.round(((thisWeekHours - lastWeekHours) / lastWeekHours) * 100)
          : 0;
        
        return {
          thisWeek: Math.round(thisWeekHours * 10) / 10,
          lastWeek: Math.round(lastWeekHours * 10) / 10,
          change,
          improved: change > 0
        };
      };

      // Get motivational quote based on completion rate
      const getMotivationalQuote = (rate) => {
        const excellent = [
          "üåü Amazing work! You're crushing your goals!",
          "üöÄ Incredible progress! Keep this momentum going!",
          "üí™ Outstanding! You're on fire today!"
        ];
        const good = [
          "‚ú® Great job! You're making solid progress!",
          "üëç Well done! You're on the right track!",
          "üéØ Nice work! Keep pushing forward!"
        ];
        const needsImprovement = [
          "üí™ Every step counts! You've got this!",
          "üå± Progress takes time. Stay consistent!",
          "üéØ Focus on one task at a time. You can do it!"
        ];
        
        const quotes = rate >= 80 ? excellent : rate >= 60 ? good : needsImprovement;
        return quotes[Math.floor(Math.random() * quotes.length)];
      };

      const EventModal = () => {
        const initialData = prefilledEventData || {
          title: '',
          startDate: formatDate(new Date()),
          startTime: '09:00',
          endDate: formatDate(new Date()),
          endTime: '10:00',
          categoryId: categories[0]?.id || '',
          type: 'planned',
          description: '',
          location: '',
          projectId: '',
          recurrence: 'once' // once, weekly, monthly, weekdays, weekends
        };

        const [eventData, setEventData] = useState(initialData);

        const createRecurringEvents = (baseEvent) => {
          const newEvents = [];
          const startDate = new Date(baseEvent.startDateTime);
          const endDate = new Date(baseEvent.endDateTime);
          const duration = endDate - startDate;
          
          // Get year end from the start date's year
          const yearEnd = new Date(startDate.getFullYear(), 11, 31, 23, 59, 59);

          if (baseEvent.recurrence === 'once' || !baseEvent.recurrence) {
            // Single event - fix bug by creating just one event
            newEvents.push({
              id: Date.now().toString(),
              ...baseEvent
            });
            return newEvents;
          }

          let currentDate = new Date(startDate);
          let eventCount = 0;
          const maxEvents = 1000; // Safety limit

          switch(baseEvent.recurrence) {
            case 'weekly':
              while (currentDate <= yearEnd && eventCount < maxEvents) {
                const newStart = new Date(currentDate);
                const newEnd = new Date(newStart.getTime() + duration);
                
                if (newStart <= yearEnd) {
                  newEvents.push({
                    id: `${Date.now()}-${eventCount}`,
                    ...baseEvent,
                    startDateTime: newStart,
                    endDateTime: newEnd,
                    startDate: formatDate(newStart),
                    endDate: formatDate(newEnd)
                  });
                }
                
                currentDate.setDate(currentDate.getDate() + 7);
                eventCount++;
              }
              break;

            case 'monthly':
              while (currentDate <= yearEnd && eventCount < maxEvents) {
                const newStart = new Date(currentDate);
                const newEnd = new Date(newStart.getTime() + duration);
                
                if (newStart <= yearEnd) {
                  newEvents.push({
                    id: `${Date.now()}-${eventCount}`,
                    ...baseEvent,
                    startDateTime: newStart,
                    endDateTime: newEnd,
                    startDate: formatDate(newStart),
                    endDate: formatDate(newEnd)
                  });
                }
                
                currentDate.setMonth(currentDate.getMonth() + 1);
                eventCount++;
              }
              break;

            case 'weekdays':
              // Find all weekdays (Mon-Fri) from start to year end
              currentDate = new Date(startDate);
              while (currentDate <= yearEnd && eventCount < maxEvents) {
                const dayOfWeek = currentDate.getDay();
                if (dayOfWeek >= 1 && dayOfWeek <= 5) { // Monday to Friday
                  const newStart = new Date(currentDate);
                  newStart.setHours(startDate.getHours(), startDate.getMinutes(), 0, 0);
                  const newEnd = new Date(newStart.getTime() + duration);
                  
                  newEvents.push({
                    id: `${Date.now()}-${eventCount}`,
                    ...baseEvent,
                    startDateTime: newStart,
                    endDateTime: newEnd,
                    startDate: formatDate(newStart),
                    endDate: formatDate(newEnd)
                  });
                }
                currentDate.setDate(currentDate.getDate() + 1);
                eventCount++;
              }
              break;

            case 'weekends':
              // Find all weekend days (Sat-Sun) from start to year end
              currentDate = new Date(startDate);
              while (currentDate <= yearEnd && eventCount < maxEvents) {
                const dayOfWeek = currentDate.getDay();
                if (dayOfWeek === 0 || dayOfWeek === 6) { // Sunday or Saturday
                  const newStart = new Date(currentDate);
                  newStart.setHours(startDate.getHours(), startDate.getMinutes(), 0, 0);
                  const newEnd = new Date(newStart.getTime() + duration);
                  
                  newEvents.push({
                    id: `${Date.now()}-${eventCount}`,
                    ...baseEvent,
                    startDateTime: newStart,
                    endDateTime: newEnd,
                    startDate: formatDate(newStart),
                    endDate: formatDate(newEnd)
                  });
                }
                currentDate.setDate(currentDate.getDate() + 1);
                eventCount++;
              }
              break;
          }

          return newEvents;
        };

        const handleSave = () => {
          if (!eventData.title.trim()) {
            alert('Please enter an event title');
            return;
          }
          
          const eventToSave = {
            ...eventData,
            startDateTime: new Date(`${eventData.startDate}T${eventData.startTime}`),
            endDateTime: new Date(`${eventData.endDate}T${eventData.endTime}`)
          };

          // Check if we're editing an existing event
          if (window.__editingEventId) {
            // Update existing event
            const updatedEvents = events.map(e => 
              e.id === window.__editingEventId ? { ...e, ...eventToSave } : e
            );
            setEvents(updatedEvents);
            window.__editingEventId = null;
          } else {
            // Create new event(s) with recurrence
            const newEvents = createRecurringEvents(eventToSave);
            setEvents([...events, ...newEvents]);
            
            if (eventData.recurrence !== 'once') {
              alert(`Created ${newEvents.length} recurring events!`);
            }
          }
          
          // Force view refresh
          setTimeout(() => {
            setViewRefreshKey(prev => prev + 1);
            setShowEventModal(false);
            setPrefilledEventData(null);
          }, 100);
        };

        const handleDelete = () => {
          if (window.__editingEventId) {
            if (confirm('Are you sure you want to delete this event?')) {
              setEvents(events.filter(e => e.id !== window.__editingEventId));
              window.__editingEventId = null;
              
              // Force view refresh
              setTimeout(() => {
                setViewRefreshKey(prev => prev + 1);
                setShowEventModal(false);
                setPrefilledEventData(null);
              }, 100);
            }
          }
        };

        return (
          <div className="modal-overlay" onClick={() => {
            setShowEventModal(false);
            setPrefilledEventData(null);
            window.__editingEventId = null;
          }}>
            <div className="modal" onClick={e => e.stopPropagation()}>
              <h2>{window.__editingEventId ? 'Edit Event' : 'Create Event'}</h2>
              
              <div className="form-group">
                <label>Event Type</label>
                <div className="event-type-toggle">
                  <button 
                    className={eventData.type === 'planned' ? 'active' : ''}
                    onClick={() => setEventData({...eventData, type: 'planned'})}
                  >
                    Planned
                  </button>
                  <button 
                    className={eventData.type === 'actual' ? 'active' : ''}
                    onClick={() => setEventData({...eventData, type: 'actual'})}
                  >
                    Actual
                  </button>
                </div>
              </div>

              <div className="form-group">
                <label>Title *</label>
                <input 
                  type="text" 
                  value={eventData.title}
                  onChange={e => setEventData({...eventData, title: e.target.value})}
                  placeholder="Meeting with Luigi"
                />
              </div>

              <div className="form-row">
                <div className="form-group">
                  <label>Start Date</label>
                  <input 
                    type="date" 
                    value={eventData.startDate}
                    onChange={e => setEventData({...eventData, startDate: e.target.value})}
                  />
                </div>
                <div className="form-group">
                  <label>Start Time</label>
                  <input 
                    type="time" 
                    value={eventData.startTime}
                    onChange={e => setEventData({...eventData, startTime: e.target.value})}
                  />
                </div>
              </div>

              <div className="form-row">
                <div className="form-group">
                  <label>End Date</label>
                  <input 
                    type="date" 
                    value={eventData.endDate}
                    onChange={e => setEventData({...eventData, endDate: e.target.value})}
                  />
                </div>
                <div className="form-group">
                  <label>End Time</label>
                  <input 
                    type="time" 
                    value={eventData.endTime}
                    onChange={e => setEventData({...eventData, endTime: e.target.value})}
                  />
                </div>
              </div>

              <div className="form-group">
                <label>Category</label>
                <select 
                  value={eventData.categoryId}
                  onChange={e => setEventData({...eventData, categoryId: e.target.value})}
                >
                  {categories.map(cat => (
                    <option key={cat.id} value={cat.id}>{cat.name}</option>
                  ))}
                </select>
              </div>

              {eventData.type === 'planned' && (
                <div className="form-group">
                  <label>Recurrence</label>
                  <select 
                    value={eventData.recurrence || 'once'}
                    onChange={e => setEventData({...eventData, recurrence: e.target.value})}
                  >
                    <option value="once">Once (Single Event)</option>
                    <option value="weekly">Weekly (until year end)</option>
                    <option value="monthly">Monthly (until year end)</option>
                    <option value="weekdays">Weekdays (until year end)</option>
                    <option value="weekends">Weekends (until year end)</option>
                  </select>
                  <p style={{ fontSize: '12px', color: '#6b9b7a', marginTop: '4px' }}>
                    {eventData.recurrence === 'once' ? 
                      'Single event only' : 
                      'Create recurring events from event date until Dec 31 of that year'
                    }
                  </p>
                </div>
              )}

              <div className="form-group">
                <label>Related Yearly Project (optional)</label>
                <select 
                  value={eventData.projectId || ''}
                  onChange={e => setEventData({...eventData, projectId: e.target.value})}
                >
                  <option value="">None</option>
                  {yearlyProjects.map(proj => (
                    <option key={proj.id} value={proj.id}>{proj.name}</option>
                  ))}
                </select>
                <p style={{ fontSize: '12px', color: '#6b9b7a', marginTop: '4px' }}>
                  Link this event to a yearly project to track time spent
                </p>
              </div>

              <div className="form-group">
                <label>Location (optional)</label>
                <input 
                  type="text" 
                  value={eventData.location}
                  onChange={e => setEventData({...eventData, location: e.target.value})}
                  placeholder="Office, Home, etc."
                />
              </div>

              <div className="form-group">
                <label>Description (optional)</label>
                <textarea 
                  value={eventData.description}
                  onChange={e => setEventData({...eventData, description: e.target.value})}
                  rows="3"
                />
              </div>

              <div className="modal-actions" style={{ 
                display: 'flex', 
                gap: '8px', 
                justifyContent: window.__editingEventId ? 'space-between' : 'flex-end' 
              }}>
                {window.__editingEventId && (
                  <button 
                    className="btn-secondary"
                    onClick={handleDelete}
                    style={{ 
                      background: '#f44336',
                      color: 'white',
                      borderColor: '#f44336'
                    }}
                    onMouseEnter={e => e.target.style.background = '#d32f2f'}
                    onMouseLeave={e => e.target.style.background = '#f44336'}
                  >
                    Delete
                  </button>
                )}
                <div style={{ display: 'flex', gap: '8px' }}>
                  <button className="btn-secondary" onClick={() => {
                    setShowEventModal(false);
                    setPrefilledEventData(null);
                    window.__editingEventId = null;
                  }}>Cancel</button>
                  <button className="btn-primary" onClick={handleSave}>Save Event</button>
                </div>
              </div>
            </div>
          </div>
        );
      };

      const CategoryModal = () => {
        const [newCategory, setNewCategory] = useState({ name: '', color: '#6b9b7a' });
        const [editingCategory, setEditingCategory] = useState(null);

        const addCategory = () => {
          if (newCategory.name.trim()) {
            setCategories([...categories, { 
              id: Date.now().toString(), 
              ...newCategory 
            }]);
            setNewCategory({ name: '', color: '#6b9b7a' });
          }
        };

        const startEdit = (category) => {
          setEditingCategory({
            id: category.id,
            name: category.name,
            color: category.color
          });
        };

        const saveEdit = () => {
          if (editingCategory && editingCategory.name.trim()) {
            setCategories(categories.map(cat =>
              cat.id === editingCategory.id
                ? { ...cat, name: editingCategory.name, color: editingCategory.color }
                : cat
            ));
            setEditingCategory(null);
          }
        };

        const cancelEdit = () => {
          setEditingCategory(null);
        };

        const deleteCategory = (id) => {
          if (categories.length <= 1) {
            alert('You must have at least one category');
            return;
          }
          setCategories(categories.filter(cat => cat.id !== id));
        };

        return (
          <div className="modal-overlay" onClick={() => setShowCategoryModal(false)}>
            <div className="modal" onClick={e => e.stopPropagation()}>
              <h2>Manage Categories</h2>
              
              <div className="category-list">
                {categories.map(cat => (
                  <div key={cat.id} className="category-item">
                    {editingCategory && editingCategory.id === cat.id ? (
                      // Edit mode
                      <div style={{ flex: 1, display: 'flex', gap: '8px', alignItems: 'center' }}>
                        <input 
                          type="color" 
                          value={editingCategory.color}
                          onChange={e => setEditingCategory({...editingCategory, color: e.target.value})}
                          style={{ width: '50px', height: '40px', border: 'none', cursor: 'pointer' }}
                        />
                        <input 
                          type="text" 
                          value={editingCategory.name}
                          onChange={e => setEditingCategory({...editingCategory, name: e.target.value})}
                          style={{ flex: 1, padding: '8px', borderRadius: '6px', border: '1px solid #d4e8d9' }}
                        />
                        <button onClick={saveEdit} className="btn-primary" style={{ padding: '6px 12px' }}>
                          ‚úì
                        </button>
                        <button onClick={cancelEdit} className="btn-secondary" style={{ padding: '6px 12px' }}>
                          ‚úó
                        </button>
                      </div>
                    ) : (
                      // View mode
                      <>
                        <div className="category-color" style={{ backgroundColor: cat.color }}></div>
                        <span style={{ flex: 1 }}>{cat.name}</span>
                        <button 
                          onClick={() => startEdit(cat)} 
                          className="btn-secondary"
                          style={{ padding: '6px 12px', fontSize: '13px', marginRight: '8px' }}
                          title="Edit category"
                        >
                          ‚úèÔ∏è
                        </button>
                        <button onClick={() => deleteCategory(cat.id)} className="btn-delete">√ó</button>
                      </>
                    )}
                  </div>
                ))}
              </div>

              <div className="form-group">
                <label>Add New Category</label>
                <div className="form-row">
                  <input 
                    type="text" 
                    value={newCategory.name}
                    onChange={e => setNewCategory({...newCategory, name: e.target.value})}
                    placeholder="Category name"
                  />
                  <input 
                    type="color" 
                    value={newCategory.color}
                    onChange={e => setNewCategory({...newCategory, color: e.target.value})}
                    style={{ width: '60px' }}
                  />
                </div>
                <button className="btn-primary" onClick={addCategory} style={{ marginTop: '8px', width: '100%' }}>Add Category</button>
              </div>

              <div className="modal-actions">
                <button className="btn-primary" onClick={() => setShowCategoryModal(false)}>Done</button>
              </div>
            </div>
          </div>
        );
      };

      const ProjectModal = () => {
        const [newProject, setNewProject] = useState({ 
          name: '', 
          deadline: formatDate(new Date()),
          plannedHours: 100
        });
        const [editingProject, setEditingProject] = useState(null);

        const addProject = () => {
          if (newProject.name.trim() && yearlyProjects.length < 3) {
            setYearlyProjects([...yearlyProjects, {
              id: Date.now().toString(),
              name: newProject.name,
              deadline: new Date(newProject.deadline),
              plannedHours: parseFloat(newProject.plannedHours) || 0
            }]);
            setNewProject({ name: '', deadline: formatDate(new Date()), plannedHours: 100 });
          }
        };

        const startEdit = (project) => {
          setEditingProject({
            id: project.id,
            name: project.name,
            deadline: formatDate(project.deadline),
            plannedHours: project.plannedHours || 0
          });
        };

        const saveEdit = () => {
          if (editingProject && editingProject.name.trim()) {
            setYearlyProjects(yearlyProjects.map(p => 
              p.id === editingProject.id 
                ? { 
                    ...p, 
                    name: editingProject.name, 
                    deadline: new Date(editingProject.deadline),
                    plannedHours: parseFloat(editingProject.plannedHours) || 0
                  }
                : p
            ));
            setEditingProject(null);
          }
        };

        const cancelEdit = () => {
          setEditingProject(null);
        };

        const deleteProject = (id) => {
          setYearlyProjects(yearlyProjects.filter(p => p.id !== id));
        };

        return (
          <div className="modal-overlay" onClick={() => setShowProjectModal(false)}>
            <div className="modal" onClick={e => e.stopPropagation()}>
              <h2>
                Yearly Projects (Max 3)
                <span 
                  style={{ 
                    marginLeft: '8px',
                    fontSize: '18px',
                    cursor: 'help',
                    display: 'inline-block',
                    position: 'relative'
                  }}
                  title="Less is more, please prioritize your yearly target and limit the number of yearly targets to only 3"
                >
                  ‚ÑπÔ∏è
                </span>
              </h2>
              
              <div className="project-list">
                {yearlyProjects.map(proj => (
                  <div key={proj.id} className="project-item">
                    {editingProject && editingProject.id === proj.id ? (
                      // Edit mode
                      <div style={{ flex: 1, display: 'flex', flexDirection: 'column', gap: '8px' }}>
                        <input 
                          type="text" 
                          value={editingProject.name}
                          onChange={e => setEditingProject({...editingProject, name: e.target.value})}
                          placeholder="Project name"
                          style={{ padding: '8px', borderRadius: '6px', border: '1px solid #d4e8d9' }}
                        />
                        <input 
                          type="date" 
                          value={editingProject.deadline}
                          onChange={e => setEditingProject({...editingProject, deadline: e.target.value})}
                          style={{ padding: '8px', borderRadius: '6px', border: '1px solid #d4e8d9' }}
                        />
                        <div>
                          <label style={{ fontSize: '12px', color: '#6b9b7a', display: 'block', marginBottom: '4px' }}>
                            Planned Hours (for Year View tracking)
                          </label>
                          <input 
                            type="number" 
                            value={editingProject.plannedHours}
                            onChange={e => setEditingProject({...editingProject, plannedHours: e.target.value})}
                            placeholder="e.g. 100"
                            min="0"
                            step="10"
                            style={{ padding: '8px', borderRadius: '6px', border: '1px solid #d4e8d9', width: '100%' }}
                          />
                        </div>
                        <div style={{ display: 'flex', gap: '8px' }}>
                          <button onClick={saveEdit} className="btn-primary" style={{ flex: 1 }}>
                            ‚úì Save
                          </button>
                          <button onClick={cancelEdit} className="btn-secondary" style={{ flex: 1 }}>
                            ‚úó Cancel
                          </button>
                        </div>
                      </div>
                    ) : (
                      // View mode
                      <>
                        <div style={{ flex: 1 }}>
                          <strong>{proj.name}</strong>
                          <div className="project-deadline">
                            Deadline: {proj.deadline.toLocaleDateString()} ({getDaysUntil(proj.deadline)} days)
                          </div>
                        </div>
                        <button 
                          onClick={() => startEdit(proj)} 
                          className="btn-secondary"
                          style={{ 
                            padding: '6px 12px',
                            fontSize: '13px',
                            marginRight: '8px'
                          }}
                          title="Edit project"
                        >
                          ‚úèÔ∏è
                        </button>
                        <button 
                          onClick={() => deleteProject(proj.id)} 
                          className="btn-delete"
                          title="Delete project"
                        >
                          √ó
                        </button>
                      </>
                    )}
                  </div>
                ))}
              </div>

              {yearlyProjects.length < 3 && (
                <div className="form-group">
                  <label>Add New Project</label>
                  <input 
                    type="text" 
                    value={newProject.name}
                    onChange={e => setNewProject({...newProject, name: e.target.value})}
                    placeholder="Project name"
                    style={{ marginBottom: '8px' }}
                  />
                  <input 
                    type="date" 
                    value={newProject.deadline}
                    onChange={e => setNewProject({...newProject, deadline: e.target.value})}
                    style={{ marginBottom: '8px' }}
                  />
                  <div style={{ marginBottom: '8px' }}>
                    <label style={{ fontSize: '12px', color: '#6b9b7a', display: 'block', marginBottom: '4px' }}>
                      Planned Hours (for Year View tracking)
                    </label>
                    <input 
                      type="number" 
                      value={newProject.plannedHours}
                      onChange={e => setNewProject({...newProject, plannedHours: e.target.value})}
                      placeholder="e.g. 100 hours"
                      min="0"
                      step="10"
                      style={{ width: '100%', padding: '8px', borderRadius: '6px', border: '1px solid #d4e8d9' }}
                    />
                  </div>
                  <button className="btn-primary" onClick={addProject} style={{ width: '100%' }}>Add Project</button>
                </div>
              )}

              {yearlyProjects.length >= 3 && (
                <div style={{ 
                  padding: '12px', 
                  background: '#fff9e6', 
                  borderRadius: '8px',
                  border: '1px solid #f39c12',
                  marginTop: '12px'
                }}>
                  <p style={{ color: '#d68910', fontSize: '13px', textAlign: 'center', margin: 0 }}>
                    üí° Less is more, please prioritize your yearly target and limit the number of yearly targets to only 3
                  </p>
                </div>
              )}

              <div className="modal-actions">
                <button className="btn-primary" onClick={() => setShowProjectModal(false)}>Done</button>
              </div>
            </div>
          </div>
        );
      };

      const ExportModal = () => {
        const [sheetUrl, setSheetUrl] = useState(googleSheetUrl);
        const [exportType, setExportType] = useState('planned'); // planned, actual, or both
        const [startHour, setStartHour] = useState(7);
        const [endHour, setEndHour] = useState(22);
        const [intervalMinutes, setIntervalMinutes] = useState(30);

        const calculateProjectTime = (projectId) => {
          const projectEvents = events.filter(e => 
            e.projectId === projectId && 
            e.type === 'actual'
          );

          const totalMinutes = projectEvents.reduce((sum, event) => {
            const start = new Date(event.startDateTime);
            const end = new Date(event.endDateTime);
            return sum + (end - start) / (1000 * 60);
          }, 0);

          return Math.round(totalMinutes / 60 * 10) / 10; // hours with 1 decimal
        };

        const generateWeeklyCalendar = (type) => {
          const getWeekDates = () => {
            const curr = new Date(currentDate);
            const first = curr.getDate() - curr.getDay() + 1;
            const dates = [];
            
            for (let i = 0; i < 7; i++) {
              const date = new Date(curr.setDate(first + i));
              dates.push(new Date(date));
            }
            return dates;
          };

          const weekDates = getWeekDates();
          
          // Generate time slots based on user settings
          const timeSlots = [];
          const totalMinutes = (endHour - startHour) * 60;
          const slotsCount = Math.floor(totalMinutes / intervalMinutes) + 1;
          
          for (let i = 0; i < slotsCount; i++) {
            const minutes = startHour * 60 + i * intervalMinutes;
            const hour = Math.floor(minutes / 60);
            const minute = minutes % 60;
            if (hour <= endHour) {
              timeSlots.push({
                hour,
                minute,
                label: `${hour.toString().padStart(2, '0')}:${minute.toString().padStart(2, '0')}`
              });
            }
          }

          let csv = 'Time,Monday,Tuesday,Wednesday,Thursday,Friday,Saturday,Sunday,,Project Info,Days Until Deadline,Hours Invested\n';

          // Create a map of events by day and time
          const eventMap = new Map();
          
          weekDates.forEach((date, dayIndex) => {
            const dayEvents = events.filter(e => {
              const eventDate = new Date(e.startDateTime);
              return eventDate.toDateString() === date.toDateString() && e.type === type;
            });

            dayEvents.forEach(event => {
              const startTime = new Date(event.startDateTime);
              const endTime = new Date(event.endDateTime);
              const category = categories.find(c => c.id === event.categoryId);
              
              const startMinutes = startTime.getHours() * 60 + startTime.getMinutes();
              const endMinutes = endTime.getHours() * 60 + endTime.getMinutes();
              
              // Mark all slots this event covers
              timeSlots.forEach((slot, slotIndex) => {
                const slotMinutes = slot.hour * 60 + slot.minute;
                if (slotMinutes >= startMinutes && slotMinutes < endMinutes) {
                  const key = `${dayIndex}-${slotIndex}`;
                  if (!eventMap.has(key)) {
                    eventMap.set(key, {
                      title: event.title,
                      category: category?.name || 'Unknown',
                      color: category?.color || '#6b9b7a',
                      isFirst: slotMinutes === startMinutes || 
                               (slotIndex === 0) ||
                               !eventMap.has(`${dayIndex}-${slotIndex - 1}`)
                    });
                  }
                }
              });
            });
          });

          timeSlots.forEach((slot, slotIndex) => {
            const row = [slot.label];

            weekDates.forEach((date, dayIndex) => {
              const key = `${dayIndex}-${slotIndex}`;
              const eventData = eventMap.get(key);
              
              if (eventData) {
                // Only show title in first slot of event, others show continuation
                if (eventData.isFirst) {
                  row.push(`"${eventData.title} [${eventData.category}]"`);
                } else {
                  row.push(`"‚Üì ${eventData.category}"`);
                }
              } else {
                row.push('');
              }
            });

            // Add project info in right columns
            row.push(''); // Empty separator column
            
            if (slotIndex < yearlyProjects.length) {
              const project = yearlyProjects[slotIndex];
              const daysLeft = getDaysUntil(project.deadline);
              const hoursInvested = calculateProjectTime(project.id);
              
              row.push(`"${project.name}"`);
              row.push(daysLeft.toString());
              row.push(hoursInvested.toString());
            } else {
              row.push('');
              row.push('');
              row.push('');
            }

            csv += row.join(',') + '\n';
          });

          return csv;
        };

        const handleExport = () => {
          let csv = '';
          let filename = '';

          if (exportType === 'both') {
            csv = '=== PLANNED EVENTS ===\n' + generateWeeklyCalendar('planned') + '\n\n';
            csv += '=== ACTUAL EVENTS ===\n' + generateWeeklyCalendar('actual');
            filename = `weekly-calendar-both-${formatDate(currentDate)}.csv`;
          } else {
            csv = generateWeeklyCalendar(exportType);
            filename = `weekly-calendar-${exportType}-${formatDate(currentDate)}.csv`;
          }

          const blob = new Blob([csv], { type: 'text/csv' });
          const url = window.URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = filename;
          a.click();
          window.URL.revokeObjectURL(url);
          
          const typeLabel = exportType === 'both' ? 'Planned & Actual' : exportType.charAt(0).toUpperCase() + exportType.slice(1);
          alert(`Weekly calendar exported as CSV!\n\nExported: ${typeLabel} Events\n\nTime Range: ${startHour}:00 - ${endHour}:00\nInterval: ${intervalMinutes} minutes\n\nIncludes:\n‚úì Event blocks with categories\n‚úì Yearly project countdown\n‚úì Hours invested per project\n\nTip: Open in Excel and use "Text to Columns" to format properly.`);
        };

        const handleSaveSheetUrl = () => {
          setGoogleSheetUrl(sheetUrl);
          localStorage.setItem('google_sheet_url', sheetUrl);
          alert('Google Sheet URL saved!\n\nIn a full implementation, TimeWise would:\n1. Use Google Sheets API to write data directly\n2. Authenticate with OAuth\n3. Update the sheet automatically');
        };

        return (
          <div className="modal-overlay" onClick={() => setShowExportModal(false)}>
            <div className="modal" onClick={e => e.stopPropagation()}>
              <h2>Export to Excel/CSV</h2>
              
              {/* Export Type Selection */}
              <div className="form-group">
                <label>What would you like to export?</label>
                <div style={{ display: 'flex', flexDirection: 'column', gap: '8px', marginTop: '8px' }}>
                  <button 
                    className={`event-type-toggle ${exportType === 'planned' ? 'active' : ''}`}
                    onClick={() => setExportType('planned')}
                    style={{ width: '100%', padding: '12px', textAlign: 'left' }}
                  >
                    üìã <strong>Planned Events Only</strong>
                    <div style={{ fontSize: '12px', marginTop: '4px', opacity: 0.8 }}>
                      Export your planned schedule
                    </div>
                  </button>
                  <button 
                    className={`event-type-toggle ${exportType === 'actual' ? 'active' : ''}`}
                    onClick={() => setExportType('actual')}
                    style={{ width: '100%', padding: '12px', textAlign: 'left' }}
                  >
                    ‚úÖ <strong>Actual Events Only</strong>
                    <div style={{ fontSize: '12px', marginTop: '4px', opacity: 0.8 }}>
                      Export what actually happened
                    </div>
                  </button>
                  <button 
                    className={`event-type-toggle ${exportType === 'both' ? 'active' : ''}`}
                    onClick={() => setExportType('both')}
                    style={{ width: '100%', padding: '12px', textAlign: 'left' }}
                  >
                    üìä <strong>Both (Planned & Actual)</strong>
                    <div style={{ fontSize: '12px', marginTop: '4px', opacity: 0.8 }}>
                      Export both in separate sections
                    </div>
                  </button>
                </div>
              </div>

              {/* Time Range Settings */}
              <div className="form-group" style={{ 
                background: '#e8f5eb', 
                padding: '16px', 
                borderRadius: '8px',
                marginBottom: '16px'
              }}>
                <label style={{ fontSize: '14px', fontWeight: 600, color: '#2d5a3d', marginBottom: '12px', display: 'block' }}>
                  ‚è∞ Customize Time Range
                </label>
                
                <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr 1fr', gap: '12px' }}>
                  <div>
                    <label style={{ fontSize: '12px', color: '#6b9b7a', display: 'block', marginBottom: '4px' }}>
                      Start Hour
                    </label>
                    <select 
                      value={startHour}
                      onChange={e => setStartHour(parseInt(e.target.value))}
                      style={{ width: '100%', padding: '8px', borderRadius: '6px', border: '1px solid #d4e8d9' }}
                    >
                      {Array.from({ length: 24 }, (_, i) => (
                        <option key={i} value={i}>{i.toString().padStart(2, '0')}:00</option>
                      ))}
                    </select>
                  </div>

                  <div>
                    <label style={{ fontSize: '12px', color: '#6b9b7a', display: 'block', marginBottom: '4px' }}>
                      End Hour
                    </label>
                    <select 
                      value={endHour}
                      onChange={e => setEndHour(parseInt(e.target.value))}
                      style={{ width: '100%', padding: '8px', borderRadius: '6px', border: '1px solid #d4e8d9' }}
                    >
                      {Array.from({ length: 24 }, (_, i) => (
                        <option key={i} value={i}>{i.toString().padStart(2, '0')}:00</option>
                      ))}
                    </select>
                  </div>

                  <div>
                    <label style={{ fontSize: '12px', color: '#6b9b7a', display: 'block', marginBottom: '4px' }}>
                      Interval (min)
                    </label>
                    <select 
                      value={intervalMinutes}
                      onChange={e => setIntervalMinutes(parseInt(e.target.value))}
                      style={{ width: '100%', padding: '8px', borderRadius: '6px', border: '1px solid #d4e8d9' }}
                    >
                      <option value={15}>15 min</option>
                      <option value={30}>30 min</option>
                      <option value={60}>1 hour</option>
                    </select>
                  </div>
                </div>

                <p style={{ fontSize: '11px', color: '#6b9b7a', marginTop: '8px', marginBottom: 0 }}>
                  üí° Events will span multiple rows based on their duration
                </p>
              </div>

              <div className="form-group">
                <label>Google Sheet URL (Optional)</label>
                <input 
                  type="text" 
                  value={sheetUrl}
                  onChange={e => setSheetUrl(e.target.value)}
                  placeholder="https://docs.google.com/spreadsheets/d/..."
                />
                <p style={{ fontSize: '12px', color: '#6b9b7a', marginTop: '6px' }}>
                  Save your Google Sheet URL for quick exports
                </p>
              </div>

              {sheetUrl && (
                <button 
                  className="btn-secondary" 
                  onClick={handleSaveSheetUrl}
                  style={{ width: '100%', marginBottom: '12px' }}
                >
                  üíæ Save Sheet URL
                </button>
              )}

              <div style={{ 
                background: '#f5f7f5', 
                padding: '16px', 
                borderRadius: '8px',
                marginBottom: '20px'
              }}>
                <h4 style={{ fontSize: '14px', color: '#2d5a3d', marginBottom: '12px' }}>
                  Weekly Calendar Format
                </h4>
                <ul style={{ fontSize: '13px', color: '#6b9b7a', paddingLeft: '20px', margin: 0 }}>
                  <li>Monday to Sunday (left to right)</li>
                  <li>Time from 5:00 to 23:00 (skip night hours)</li>
                  {exportType === 'planned' && <li>Shows planned events with categories</li>}
                  {exportType === 'actual' && <li>Shows actual events with categories</li>}
                  {exportType === 'both' && <li>Two sections: Planned events followed by Actual events</li>}
                  <li>Right side: Yearly project info</li>
                  <li>Includes days until deadline</li>
                  <li>Shows hours invested (from actual events)</li>
                </ul>
              </div>

              {yearlyProjects.length > 0 && (
                <div style={{ 
                  background: '#e8f5eb', 
                  padding: '16px', 
                  borderRadius: '8px',
                  marginBottom: '20px'
                }}>
                  <h4 style={{ fontSize: '14px', color: '#2d5a3d', marginBottom: '12px' }}>
                    üìä Project Summary Preview
                  </h4>
                  {yearlyProjects.map(project => {
                    const daysLeft = getDaysUntil(project.deadline);
                    const hoursInvested = calculateProjectTime(project.id);
                    return (
                      <div key={project.id} style={{ 
                        fontSize: '13px', 
                        color: '#2d5a3d',
                        marginBottom: '8px',
                        paddingBottom: '8px',
                        borderBottom: '1px solid #d4e8d9'
                      }}>
                        <strong>{project.name}</strong>
                        <div style={{ fontSize: '12px', color: '#6b9b7a', marginTop: '4px' }}>
                          {daysLeft} days left ‚Ä¢ {hoursInvested} hours invested
                        </div>
                      </div>
                    );
                  })}
                </div>
              )}

              <div className="modal-actions">
                <button className="btn-secondary" onClick={() => setShowExportModal(false)}>
                  Cancel
                </button>
                <button className="btn-primary" onClick={handleExport}>
                  üì• Export CSV
                </button>
              </div>
            </div>
          </div>
        );
      };

      const CompletionModal = () => {
        const [completionType, setCompletionType] = useState('on_time'); // on_time, late, incomplete
        const [lateTime, setLateTime] = useState('');
        const [lateReason, setLateReason] = useState('');
        const [incompleteReason, setIncompleteReason] = useState('');
        const [actualEventTitle, setActualEventTitle] = useState('');
        const [actualStartTime, setActualStartTime] = useState('');
        const [actualEndTime, setActualEndTime] = useState('');

        if (!selectedEventForCompletion) return null;

        const event = selectedEventForCompletion;
        const category = categories.find(c => c.id === event.categoryId);

        const handleComplete = () => {
          const actualEvent = {
            id: Date.now().toString(),
            categoryId: event.categoryId,
            type: 'actual',
            description: event.description,
            location: event.location,
            relatedPlannedEvent: event.id
          };

          if (completionType === 'on_time') {
            actualEvent.title = event.title;
            actualEvent.startDateTime = event.startDateTime;
            actualEvent.endDateTime = event.endDateTime;
            actualEvent.startDate = formatDate(new Date(event.startDateTime));
            actualEvent.startTime = formatTime(new Date(event.startDateTime));
            actualEvent.endDate = formatDate(new Date(event.endDateTime));
            actualEvent.endTime = formatTime(new Date(event.endDateTime));
            actualEvent.completionStatus = 'completed_on_time';
          } else if (completionType === 'late') {
            if (!lateTime || !lateReason) {
              alert('Please enter late completion time and reason');
              return;
            }
            const lateEndDateTime = new Date(event.startDateTime);
            const [hours, minutes] = lateTime.split(':');
            lateEndDateTime.setHours(parseInt(hours), parseInt(minutes));
            
            actualEvent.title = event.title;
            actualEvent.startDateTime = event.startDateTime;
            actualEvent.endDateTime = lateEndDateTime;
            actualEvent.startDate = formatDate(new Date(event.startDateTime));
            actualEvent.startTime = formatTime(new Date(event.startDateTime));
            actualEvent.endDate = formatDate(lateEndDateTime);
            actualEvent.endTime = formatTime(lateEndDateTime);
            actualEvent.completionStatus = 'completed_late';
            actualEvent.lateReason = lateReason;
          } else {
            if (!incompleteReason || !actualEventTitle || !actualStartTime || !actualEndTime) {
              alert('Please fill in all required fields');
              return;
            }
            const startDate = formatDate(new Date(event.startDateTime));
            actualEvent.title = actualEventTitle;
            actualEvent.startDateTime = new Date(`${startDate}T${actualStartTime}`);
            actualEvent.endDateTime = new Date(`${startDate}T${actualEndTime}`);
            actualEvent.startDate = startDate;
            actualEvent.startTime = actualStartTime;
            actualEvent.endDate = startDate;
            actualEvent.endTime = actualEndTime;
            actualEvent.completionStatus = 'incomplete';
            actualEvent.incompleteReason = incompleteReason;
          }

          const updatedEvent = {
            ...event,
            completed: true,
            completionStatus: actualEvent.completionStatus,
            actualEventId: actualEvent.id
          };

          setEvents([...events.filter(e => e.id !== event.id), updatedEvent, actualEvent]);
          setShowCompletionModal(false);
          setSelectedEventForCompletion(null);
        };

        return (
          <div className="modal-overlay" onClick={() => setShowCompletionModal(false)}>
            <div className="modal" onClick={e => e.stopPropagation()}>
              <h2>Event Options</h2>
              
              <div style={{ 
                padding: '12px', 
                background: '#f5f7f5', 
                borderRadius: '8px', 
                marginBottom: '20px',
                borderLeft: `4px solid ${category?.color}`
              }}>
                <div style={{ fontWeight: 600, color: '#2d5a3d', marginBottom: '4px' }}>
                  {event.title}
                </div>
                <div style={{ fontSize: '13px', color: '#6b9b7a' }}>
                  {new Date(event.startDateTime).toLocaleString()} - {new Date(event.endDateTime).toLocaleTimeString()}
                </div>
              </div>

              <div className="form-group">
                <label>What would you like to do?</label>
                <div style={{ display: 'flex', flexDirection: 'column', gap: '8px' }}>
                  <button 
                    className="btn-primary"
                    onClick={() => {
                      setSelectedEventForCompletion(null);
                      setShowCompletionModal(false);
                      setPrefilledEventData({
                        title: event.title,
                        startDate: formatDate(new Date(event.startDateTime)),
                        startTime: formatTime(new Date(event.startDateTime)),
                        endDate: formatDate(new Date(event.endDateTime)),
                        endTime: formatTime(new Date(event.endDateTime)),
                        categoryId: event.categoryId,
                        type: 'planned',
                        description: event.description || '',
                        location: event.location || '',
                        projectId: event.projectId || ''
                      });
                      // Store the original event ID for updating
                      window.__editingEventId = event.id;
                      setShowEventModal(true);
                    }}
                    style={{ width: '100%', padding: '12px', textAlign: 'left', marginBottom: '12px' }}
                  >
                    ‚úèÔ∏è <strong>Edit Event</strong>
                    <div style={{ fontSize: '12px', marginTop: '4px', opacity: 0.8 }}>
                      Modify event details
                    </div>
                  </button>
                  <div style={{ borderTop: '1px solid #e0e7e0', margin: '8px 0', paddingTop: '12px' }}>
                    <div style={{ fontSize: '13px', color: '#6b9b7a', marginBottom: '8px' }}>
                      Or mark as complete:
                    </div>
                  </div>
                  <button 
                    className={`event-type-toggle ${completionType === 'on_time' ? 'active' : ''}`}
                    onClick={() => setCompletionType('on_time')}
                    style={{ width: '100%', padding: '12px', textAlign: 'left' }}
                  >
                    ‚úÖ <strong>Completed On Time</strong>
                    <div style={{ fontSize: '12px', marginTop: '4px', opacity: 0.8 }}>
                      Finished as planned
                    </div>
                  </button>
                  <button 
                    className={`event-type-toggle ${completionType === 'late' ? 'active' : ''}`}
                    onClick={() => setCompletionType('late')}
                    style={{ width: '100%', padding: '12px', textAlign: 'left' }}
                  >
                    ‚ö†Ô∏è <strong>Completed Late</strong>
                    <div style={{ fontSize: '12px', marginTop: '4px', opacity: 0.8 }}>
                      Took longer than expected
                    </div>
                  </button>
                  <button 
                    className={`event-type-toggle ${completionType === 'incomplete' ? 'active' : ''}`}
                    onClick={() => setCompletionType('incomplete')}
                    style={{ width: '100%', padding: '12px', textAlign: 'left' }}
                  >
                    ‚ùå <strong>Not Completed</strong>
                    <div style={{ fontSize: '12px', marginTop: '4px', opacity: 0.8 }}>
                      Did something else instead
                    </div>
                  </button>
                </div>
              </div>

              {completionType === 'late' && (
                <>
                  <div className="form-group">
                    <label>Actual End Time *</label>
                    <input 
                      type="time" 
                      value={lateTime}
                      onChange={e => setLateTime(e.target.value)}
                    />
                  </div>
                  <div className="form-group">
                    <label>Reason for Delay *</label>
                    <textarea 
                      value={lateReason}
                      onChange={e => setLateReason(e.target.value)}
                      rows="3"
                      placeholder="Why did this take longer than planned?"
                    />
                  </div>
                </>
              )}

              {completionType === 'incomplete' && (
                <>
                  <div className="form-group">
                    <label>Reason Not Completed *</label>
                    <select 
                      value={incompleteReason}
                      onChange={e => setIncompleteReason(e.target.value)}
                    >
                      <option value="">Select reason...</option>
                      <option value="lack_of_time">Lack of Time</option>
                      <option value="unexpected_interruption">Unexpected Interruption</option>
                      <option value="changed_priority">Changed Priority</option>
                      <option value="lack_of_motivation">Lack of Motivation</option>
                      <option value="technical_issue">Technical Issue</option>
                      <option value="other">Other</option>
                    </select>
                  </div>
                  <div className="form-group">
                    <label>What did you actually do? *</label>
                    <input 
                      type="text" 
                      value={actualEventTitle}
                      onChange={e => setActualEventTitle(e.target.value)}
                      placeholder="Actual activity during this time"
                    />
                  </div>
                  <div className="form-row">
                    <div className="form-group">
                      <label>Actual Start Time *</label>
                      <input 
                        type="time" 
                        value={actualStartTime}
                        onChange={e => setActualStartTime(e.target.value)}
                      />
                    </div>
                    <div className="form-group">
                      <label>Actual End Time *</label>
                      <input 
                        type="time" 
                        value={actualEndTime}
                        onChange={e => setActualEndTime(e.target.value)}
                      />
                    </div>
                  </div>
                </>
              )}

              <div className="modal-actions">
                <button className="btn-secondary" onClick={() => setShowCompletionModal(false)}>Cancel</button>
                <button className="btn-primary" onClick={handleComplete}>Confirm</button>
              </div>
            </div>
          </div>
        );
      };

      // Journal Modal - Weekly Journal Setup
      const JournalModal = () => {
        const [docUrl, setDocUrl] = useState(journalDocUrl);
        
        const handleSave = () => {
          setJournalDocUrl(docUrl);
          setShowJournalModal(false);
          if (docUrl) {
            alert('‚úÖ Journal link saved!\n\nClick "Open Journal" to start writing.');
          }
        };
        
        const handleOpen = () => {
          if (docUrl) {
            window.open(docUrl, '_blank');
          } else {
            alert('Please set your Google Docs link first.');
          }
        };
        
        return (
          <div className="modal-overlay" onClick={() => setShowJournalModal(false)}>
            <div className="modal" onClick={e => e.stopPropagation()} style={{ maxWidth: '500px' }}>
              <h2 style={{ marginBottom: '20px', color: '#2d5a3d' }}>
                üìî Weekly Journal Setup
              </h2>
              
              <div style={{ marginBottom: '20px' }}>
                <p style={{ fontSize: '14px', color: '#6b9b7a', marginBottom: '16px', lineHeight: '1.6' }}>
                  Connect your Google Docs for weekly reflections. We recommend creating a dedicated document for your journey.
                </p>
                
                <div style={{ 
                  background: '#f0f9f4', 
                  padding: '16px', 
                  borderRadius: '8px',
                  marginBottom: '16px',
                  border: '1px solid #e0f0e8'
                }}>
                  <p style={{ fontSize: '13px', color: '#2d5a3d', marginBottom: '8px', fontWeight: '600' }}>
                    üí° Quick Setup:
                  </p>
                  <ol style={{ fontSize: '12px', color: '#4a7c59', paddingLeft: '20px', margin: 0 }}>
                    <li>Create a new Google Doc</li>
                    <li>Name it "Weekly Reflections 2025"</li>
                    <li>Copy the document URL</li>
                    <li>Paste it below</li>
                  </ol>
                </div>
                
                <label style={{ 
                  display: 'block', 
                  marginBottom: '8px', 
                  fontWeight: '600', 
                  color: '#2d5a3d',
                  fontSize: '14px'
                }}>
                  Google Docs URL
                </label>
                <input
                  type="url"
                  value={docUrl}
                  onChange={(e) => setDocUrl(e.target.value)}
                  placeholder="https://docs.google.com/document/d/..."
                  style={{
                    width: '100%',
                    padding: '10px',
                    border: '2px solid #e0f0e8',
                    borderRadius: '6px',
                    fontSize: '14px',
                    fontFamily: 'monospace'
                  }}
                />
              </div>
              
              <div className="modal-actions" style={{ display: 'flex', gap: '8px' }}>
                {docUrl && (
                  <button 
                    className="btn-secondary" 
                    onClick={handleOpen}
                    style={{ flex: 1 }}
                  >
                    üîó Open Journal
                  </button>
                )}
                <button 
                  className="btn-primary" 
                  onClick={handleSave}
                  style={{ flex: 1 }}
                >
                  üíæ Save
                </button>
                <button 
                  className="btn-secondary" 
                  onClick={() => setShowJournalModal(false)}
                >
                  Cancel
                </button>
              </div>
            </div>
          </div>
        );
      };

      // Weekly Reflection Modal
      const WeeklyReflectionModal = () => {
        const weekKey = getWeekKey(currentDate);
        const currentData = weeklyGoals[weekKey] || { goal: '', highlight: '', lowlight: '' };
        const [weekData, setWeekData] = useState(currentData);
        
        const handleSave = () => {
          setWeeklyGoals({
            ...weeklyGoals,
            [weekKey]: weekData
          });
          setShowWeeklyReflectionModal(false);
          alert('‚úÖ Weekly reflection saved!');
        };
        
        return (
          <div className="modal-overlay" onClick={() => setShowWeeklyReflectionModal(false)}>
            <div className="modal" onClick={e => e.stopPropagation()} style={{ maxWidth: '600px' }}>
              <h2 style={{ marginBottom: '8px', color: '#2d5a3d' }}>
                ‚ú® Weekly Reflection
              </h2>
              <p style={{ fontSize: '13px', color: '#6b9b7a', marginBottom: '20px' }}>
                Week of {currentDate.toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' })}
              </p>
              
              {/* Weekly Goal */}
              <div style={{ marginBottom: '20px' }}>
                <label style={{ 
                  display: 'flex',
                  alignItems: 'center',
                  gap: '8px',
                  marginBottom: '8px', 
                  fontWeight: '600', 
                  color: '#2d5a3d',
                  fontSize: '15px'
                }}>
                  <span>üéØ</span>
                  <span>Weekly Goal</span>
                </label>
                <input
                  type="text"
                  value={weekData.goal}
                  onChange={(e) => setWeekData({ ...weekData, goal: e.target.value })}
                  placeholder="What do you want to achieve this week?"
                  style={{
                    width: '100%',
                    padding: '12px',
                    border: '2px solid #e0f0e8',
                    borderRadius: '8px',
                    fontSize: '14px'
                  }}
                />
                <p style={{ fontSize: '11px', color: '#6b9b7a', marginTop: '4px' }}>
                  Make it specific and actionable
                </p>
              </div>
              
              {/* Highlight */}
              <div style={{ marginBottom: '20px' }}>
                <label style={{ 
                  display: 'flex',
                  alignItems: 'center',
                  gap: '8px',
                  marginBottom: '8px', 
                  fontWeight: '600', 
                  color: '#2d5a3d',
                  fontSize: '15px'
                }}>
                  <span>‚≠ê</span>
                  <span>Week Highlight</span>
                </label>
                <textarea
                  value={weekData.highlight}
                  onChange={(e) => setWeekData({ ...weekData, highlight: e.target.value })}
                  placeholder="What went well? What are you proud of?"
                  rows={3}
                  style={{
                    width: '100%',
                    padding: '12px',
                    border: '2px solid #e0f0e8',
                    borderRadius: '8px',
                    fontSize: '14px',
                    resize: 'vertical',
                    fontFamily: 'inherit'
                  }}
                />
              </div>
              
              {/* Lowlight */}
              <div style={{ marginBottom: '20px' }}>
                <label style={{ 
                  display: 'flex',
                  alignItems: 'center',
                  gap: '8px',
                  marginBottom: '8px', 
                  fontWeight: '600', 
                  color: '#2d5a3d',
                  fontSize: '15px'
                }}>
                  <span>üìâ</span>
                  <span>Week Challenge</span>
                </label>
                <textarea
                  value={weekData.lowlight}
                  onChange={(e) => setWeekData({ ...weekData, lowlight: e.target.value })}
                  placeholder="What challenges did you face? What can you learn?"
                  rows={3}
                  style={{
                    width: '100%',
                    padding: '12px',
                    border: '2px solid #e0f0e8',
                    borderRadius: '8px',
                    fontSize: '14px',
                    resize: 'vertical',
                    fontFamily: 'inherit'
                  }}
                />
              </div>
              
              <div style={{
                background: '#fff3e0',
                padding: '12px',
                borderRadius: '8px',
                marginBottom: '20px',
                border: '1px solid #ffe0b2'
              }}>
                <p style={{ fontSize: '12px', color: '#e65100', margin: 0 }}>
                  üí° <strong>Tip:</strong> Reflect honestly. Both wins and challenges help you grow.
                </p>
              </div>
              
              <div className="modal-actions">
                <button className="btn-primary" onClick={handleSave}>
                  üíæ Save Reflection
                </button>
                <button className="btn-secondary" onClick={() => setShowWeeklyReflectionModal(false)}>
                  Cancel
                </button>
              </div>
            </div>
          </div>
        );
      };

      const GoogleSetupModal = () => {
        const [clientId, setClientId] = useState(googleClientId);

        const handleSave = () => {
          if (!clientId.trim()) {
            alert('Please enter a valid Google OAuth Client ID');
            return;
          }
          setGoogleClientId(clientId.trim());
          localStorage.setItem('google_client_id', clientId.trim());
          setShowGoogleSetupModal(false);
          alert('Google OAuth Client ID saved!\n\nYou can now connect to Google Calendar.');
        };

        return (
          <div className="modal-overlay" onClick={() => setShowGoogleSetupModal(false)}>
            <div className="modal" onClick={e => e.stopPropagation()}>
              <h2>Google Calendar Setup</h2>
              
              <div style={{ 
                background: '#fff3e0', 
                padding: '16px', 
                borderRadius: '8px',
                marginBottom: '20px',
                fontSize: '13px',
                color: '#f57c00'
              }}>
                ‚ö†Ô∏è <strong>One-time setup required</strong>
                <p style={{ marginTop: '8px', lineHeight: '1.5' }}>
                  To enable real Google Calendar sync, you need to create a Google Cloud Project and get OAuth credentials.
                </p>
              </div>

              <div style={{ 
                background: '#f5f7f5', 
                padding: '16px', 
                borderRadius: '8px',
                marginBottom: '20px'
              }}>
                <h4 style={{ fontSize: '14px', color: '#2d5a3d', marginBottom: '12px' }}>
                  How to get your OAuth Client ID:
                </h4>
                <ol style={{ fontSize: '13px', color: '#6b9b7a', paddingLeft: '20px', margin: 0, lineHeight: '1.8' }}>
                  <li>Go to <a href="https://console.cloud.google.com" target="_blank" style={{ color: '#4285f4' }}>Google Cloud Console</a></li>
                  <li>Create a new project or select existing one</li>
                  <li>Enable "Google Calendar API"</li>
                  <li>Go to "Credentials" ‚Üí "Create Credentials" ‚Üí "OAuth client ID"</li>
                  <li>Application type: "Web application"</li>
                  <li>Add authorized JavaScript origins: <code style={{ background: '#e0e7e0', padding: '2px 6px', borderRadius: '3px' }}>file://</code> or your domain</li>
                  <li>Add authorized redirect URIs: <code style={{ background: '#e0e7e0', padding: '2px 6px', borderRadius: '3px' }}>file:///</code> or your domain</li>
                  <li>Copy the Client ID</li>
                </ol>
              </div>

              <div className="form-group">
                <label>Google OAuth Client ID</label>
                <input 
                  type="text" 
                  value={clientId}
                  onChange={e => setClientId(e.target.value)}
                  placeholder="123456789-abcdefg.apps.googleusercontent.com"
                />
                <p style={{ fontSize: '12px', color: '#6b9b7a', marginTop: '6px' }}>
                  Your Client ID will be stored locally in this browser
                </p>
              </div>

              <div className="modal-actions">
                <button className="btn-secondary" onClick={() => setShowGoogleSetupModal(false)}>
                  Cancel
                </button>
                <button className="btn-primary" onClick={handleSave}>
                  Save Client ID
                </button>
              </div>
            </div>
          </div>
        );
      };

      const GoogleSyncModal = () => {
        const handleConnectGoogle = async () => {
          if (!googleClientId) {
            if (confirm('Google OAuth Client ID not configured. Set it up now?')) {
              setShowSyncModal(false);
              setShowGoogleSetupModal(true);
            }
            return;
          }

          setSyncStatus('connecting');

          try {
            // Initialize Google Identity Services
            const client = window.google.accounts.oauth2.initTokenClient({
              client_id: googleClientId,
              scope: 'https://www.googleapis.com/auth/calendar https://www.googleapis.com/auth/calendar.events',
              callback: async (response) => {
                if (response.access_token) {
                  setGoogleAccessToken(response.access_token);
                  localStorage.setItem('google_access_token', response.access_token);
                  localStorage.setItem('google_token_expiry', Date.now() + (response.expires_in * 1000));
                  setGoogleConnected(true);
                  setSyncStatus('connected');
                  localStorage.setItem('google_connected', 'true');
                  alert('Successfully connected to Google Calendar!');
                } else {
                  setSyncStatus('disconnected');
                  alert('Failed to connect to Google Calendar');
                }
              },
            });

            client.requestAccessToken();
          } catch (error) {
            console.error('Google OAuth error:', error);
            setSyncStatus('disconnected');
            alert('Error connecting to Google Calendar. Please check your Client ID and try again.');
          }
        };

        const handleSignOut = async () => {
          if (!confirm('Sign out from Google Calendar?\n\nThis will:\n- Revoke access to your Google Calendar\n- Clear your connection\n- Keep your local events')) {
            return;
          }

          try {
            // Revoke the access token
            if (googleAccessToken) {
              await fetch(`https://oauth2.googleapis.com/revoke?token=${googleAccessToken}`, {
                method: 'POST',
                headers: {
                  'Content-type': 'application/x-www-form-urlencoded'
                }
              });
            }
          } catch (error) {
            console.error('Error revoking token:', error);
          }

          // Clear all Google-related data
          setGoogleConnected(false);
          setGoogleAccessToken('');
          setSyncStatus('disconnected');
          localStorage.removeItem('google_connected');
          localStorage.removeItem('google_access_token');
          localStorage.removeItem('google_token_expiry');
          
          alert('Successfully signed out from Google Calendar.\n\nYou can now connect with a different account or reconfigure your setup.');
        };

        const handleResetOAuth = () => {
          if (!confirm('Reset Google OAuth setup?\n\nThis will:\n- Remove your saved Client ID\n- Sign you out\n- Allow you to reconfigure from scratch\n\nYour local events will NOT be deleted.')) {
            return;
          }

          // Clear everything
          setGoogleConnected(false);
          setGoogleAccessToken('');
          setGoogleClientId('');
          setSyncStatus('disconnected');
          localStorage.removeItem('google_connected');
          localStorage.removeItem('google_access_token');
          localStorage.removeItem('google_token_expiry');
          localStorage.removeItem('google_client_id');
          
          alert('Google OAuth setup has been reset.\n\nClick "Set Up Google OAuth" to reconfigure.');
        };

        const syncToGoogle = async () => {
          if (!googleAccessToken) {
            alert('Not connected to Google Calendar');
            return;
          }

          setSyncStatus('syncing');

          try {
            // First, fetch existing events from Google Calendar to check for duplicates
            const timeMin = new Date();
            timeMin.setMonth(timeMin.getMonth() - 1);
            const timeMax = new Date();
            timeMax.setMonth(timeMax.getMonth() + 3);

            const fetchResponse = await fetch(
              `https://www.googleapis.com/calendar/v3/calendars/primary/events?` +
              `timeMin=${timeMin.toISOString()}&` +
              `timeMax=${timeMax.toISOString()}&` +
              `singleEvents=true&` +
              `orderBy=startTime`,
              {
                headers: {
                  'Authorization': `Bearer ${googleAccessToken}`
                }
              }
            );

            const existingData = await fetchResponse.json();
            const existingGoogleEvents = existingData.items || [];

            // Get all planned events
            const plannedEvents = events.filter(e => e.type === 'planned');
            let synced = 0;
            let skipped = 0;

            for (const event of plannedEvents) {
              // Check if event already exists in Google Calendar
              const eventTitle = event.title;
              const eventStartTime = new Date(event.startDateTime).getTime();
              
              const alreadyExists = existingGoogleEvents.some(gEvent => {
                if (!gEvent.start.dateTime) return false; // Skip all-day events
                const gEventTitle = gEvent.summary || '';
                const gEventStartTime = new Date(gEvent.start.dateTime).getTime();
                
                // Match by title and start time (within 1 minute tolerance)
                return gEventTitle === eventTitle && 
                       Math.abs(gEventStartTime - eventStartTime) < 60000;
              });

              if (alreadyExists) {
                skipped++;
                continue; // Skip this event, it already exists
              }

              // Event doesn't exist, create it
              const category = categories.find(c => c.id === event.categoryId);
              
              const googleEvent = {
                summary: `${event.title}${event.completionStatus ? ' [' + event.completionStatus + ']' : ''}`,
                description: event.description || '',
                location: event.location || '',
                start: {
                  dateTime: new Date(event.startDateTime).toISOString(),
                  timeZone: Intl.DateTimeFormat().resolvedOptions().timeZone
                },
                end: {
                  dateTime: new Date(event.endDateTime).toISOString(),
                  timeZone: Intl.DateTimeFormat().resolvedOptions().timeZone
                },
                colorId: getCategoryColorId(category?.color)
              };

              const response = await fetch('https://www.googleapis.com/calendar/v3/calendars/primary/events', {
                method: 'POST',
                headers: {
                  'Authorization': `Bearer ${googleAccessToken}`,
                  'Content-Type': 'application/json'
                },
                body: JSON.stringify(googleEvent)
              });

              if (response.ok) {
                synced++;
              }
            }

            setSyncStatus('connected');
            alert(`Sync to Google complete!\n\n‚úÖ Synced ${synced} new events\n‚è≠Ô∏è Skipped ${skipped} existing events\nüìä Total: ${plannedEvents.length} events`);
          } catch (error) {
            console.error('Sync error:', error);
            setSyncStatus('connected');
            alert('Error syncing to Google Calendar. Please try again.');
          }
        };

        const syncFromGoogle = async () => {
          if (!googleAccessToken) {
            alert('Not connected to Google Calendar');
            return;
          }

          setSyncStatus('syncing');

          try {
            // Fetch events from Google Calendar
            const timeMin = new Date();
            timeMin.setMonth(timeMin.getMonth() - 1); // Get events from last month
            const timeMax = new Date();
            timeMax.setMonth(timeMax.getMonth() + 3); // Get events up to 3 months ahead

            const response = await fetch(
              `https://www.googleapis.com/calendar/v3/calendars/primary/events?` +
              `timeMin=${timeMin.toISOString()}&` +
              `timeMax=${timeMax.toISOString()}&` +
              `singleEvents=true&` +
              `orderBy=startTime`,
              {
                headers: {
                  'Authorization': `Bearer ${googleAccessToken}`
                }
              }
            );

            if (!response.ok) {
              throw new Error('Failed to fetch events from Google Calendar');
            }

            const data = await response.json();
            const googleEvents = data.items || [];
            
            let imported = 0;
            const newEvents = [];

            for (const gEvent of googleEvents) {
              // Skip all-day events
              if (!gEvent.start.dateTime) continue;

              // Check if event already exists in TimeWise
              const existingEvent = events.find(e => 
                e.title === gEvent.summary &&
                new Date(e.startDateTime).getTime() === new Date(gEvent.start.dateTime).getTime()
              );

              if (existingEvent) continue; // Skip duplicates

              // Create new event in TimeWise
              const newEvent = {
                id: Date.now().toString() + Math.random().toString(36).substr(2, 9),
                title: gEvent.summary || 'Untitled Event',
                startDateTime: new Date(gEvent.start.dateTime),
                endDateTime: new Date(gEvent.end.dateTime),
                startDate: formatDate(new Date(gEvent.start.dateTime)),
                startTime: formatTime(new Date(gEvent.start.dateTime)),
                endDate: formatDate(new Date(gEvent.end.dateTime)),
                endTime: formatTime(new Date(gEvent.end.dateTime)),
                categoryId: categories[0]?.id || '',
                type: 'planned',
                description: gEvent.description || '',
                location: gEvent.location || '',
                projectId: '',
                googleEventId: gEvent.id // Store Google event ID for future updates
              };

              newEvents.push(newEvent);
              imported++;
            }

            if (newEvents.length > 0) {
              setEvents([...events, ...newEvents]);
            }

            setSyncStatus('connected');
            alert(`Sync from Google complete!\n\nImported ${imported} new events from Google Calendar.`);
          } catch (error) {
            console.error('Sync from Google error:', error);
            setSyncStatus('connected');
            alert('Error syncing from Google Calendar. Please try again.');
          }
        };

        const syncBothWays = async () => {
          if (!googleAccessToken) {
            alert('Not connected to Google Calendar');
            return;
          }

          if (!confirm('Two-way sync will:\n1. Push all TimeWise events to Google Calendar\n2. Import all Google Calendar events to TimeWise\n\nContinue?')) {
            return;
          }

          setSyncStatus('syncing');

          // First sync to Google
          await syncToGoogle();
          
          // Wait a moment
          await new Promise(resolve => setTimeout(resolve, 1000));
          
          // Then sync from Google
          await syncFromGoogle();

          setSyncStatus('connected');
          alert('Two-way sync complete! ‚úÖ');
        };

        const syncFromGoogleMaster = async () => {
          if (!googleAccessToken) {
            alert('Not connected to Google Calendar');
            return;
          }

          const confirmMessage = 
            '‚ö†Ô∏è Google Calendar Master Sync\n\n' +
            'This will:\n' +
            '1. Keep all PAST events (before today) ‚úÖ\n' +
            '2. DELETE all FUTURE Planned events in TimeWise ‚ö†Ô∏è\n' +
            '3. Import next 1 year from Google Calendar\n' +
            '4. Make TimeWise match Google exactly\n\n' +
            'Google Calendar will be the single source of truth.\n\n' +
            'Continue?';

          if (!confirm(confirmMessage)) {
            return;
          }

          setSyncStatus('syncing');

          try {
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            // Step 1: Delete all future Planned events in TimeWise (keep history)
            const eventsToKeep = events.filter(e => {
              // Keep all Actual events (they are historical data)
              if (e.type === 'actual') return true;
              
              // Keep Planned events that are in the past
              const eventDate = new Date(e.startDateTime);
              if (eventDate < today) return true;
              
              // Delete future Planned events
              return false;
            });

            const deletedCount = events.length - eventsToKeep.length;
            
            // Step 2: Fetch events from Google Calendar (next 1 year)
            const timeMin = new Date();
            const timeMax = new Date();
            timeMax.setFullYear(timeMax.getFullYear() + 1); // Next 1 year

            const response = await fetch(
              `https://www.googleapis.com/calendar/v3/calendars/primary/events?` +
              `timeMin=${timeMin.toISOString()}&` +
              `timeMax=${timeMax.toISOString()}&` +
              `singleEvents=true&` +
              `orderBy=startTime`,
              {
                headers: {
                  'Authorization': `Bearer ${googleAccessToken}`
                }
              }
            );

            if (!response.ok) {
              throw new Error('Failed to fetch events from Google Calendar');
            }

            const data = await response.json();
            const googleEvents = data.items || [];
            
            // Step 3: Import all events from Google
            const newEvents = [];

            for (const gEvent of googleEvents) {
              // Skip all-day events
              if (!gEvent.start.dateTime) continue;

              // Create new event in TimeWise
              const newEvent = {
                id: Date.now().toString() + Math.random().toString(36).substr(2, 9),
                title: gEvent.summary || 'Untitled Event',
                startDateTime: new Date(gEvent.start.dateTime),
                endDateTime: new Date(gEvent.end.dateTime),
                startDate: formatDate(new Date(gEvent.start.dateTime)),
                startTime: formatTime(new Date(gEvent.start.dateTime)),
                endDate: formatDate(new Date(gEvent.end.dateTime)),
                endTime: formatTime(new Date(gEvent.end.dateTime)),
                categoryId: categories[0]?.id || '',
                type: 'planned',
                description: gEvent.description || '',
                location: gEvent.location || '',
                projectId: '',
                googleEventId: gEvent.id
              };

              newEvents.push(newEvent);
            }

            // Step 4: Update events state with kept history + new Google events
            const finalEvents = [...eventsToKeep, ...newEvents];
            setEvents(finalEvents);

            setSyncStatus('connected');
            
            alert(
              `Google Master Sync Complete! ‚úÖ\n\n` +
              `üìä Summary:\n` +
              `‚Ä¢ Kept ${eventsToKeep.filter(e => e.type === 'actual').length} past Actual events\n` +
              `‚Ä¢ Kept ${eventsToKeep.filter(e => e.type === 'planned').length} past Planned events\n` +
              `‚Ä¢ Deleted ${deletedCount} future Planned events\n` +
              `‚Ä¢ Imported ${newEvents.length} events from Google\n` +
              `‚Ä¢ Total events now: ${finalEvents.length}\n\n` +
              `TimeWise now matches Google Calendar exactly! üéØ`
            );
          } catch (error) {
            console.error('Google Master Sync error:', error);
            setSyncStatus('connected');
            alert('Error during Google Master Sync. Please try again.');
          }
        };

        const clearGoogleCalendar = async () => {
          if (!googleAccessToken) {
            alert('Not connected to Google Calendar');
            return;
          }

          // First confirmation
          if (!confirm(
            '‚ö†Ô∏è WARNING: CLEAR GOOGLE CALENDAR\n\n' +
            'This will PERMANENTLY DELETE ALL events from your Google Calendar.\n\n' +
            '‚Ä¢ This action CANNOT be undone\n' +
            '‚Ä¢ All events will be lost forever\n' +
            '‚Ä¢ Your TimeWise data will NOT be affected\n\n' +
            'Are you absolutely sure you want to continue?'
          )) {
            return;
          }

          // Second confirmation with typing
          const confirmation = prompt(
            '‚ö†Ô∏è FINAL CONFIRMATION\n\n' +
            'This is your last chance to cancel.\n\n' +
            'Type "DELETE ALL" (in capitals) to confirm deletion of all Google Calendar events:'
          );
          
          if (confirmation !== 'DELETE ALL') {
            alert('‚ùå Cancelled\n\nNo events were deleted. Your calendar is safe.');
            return;
          }

          setSyncStatus('syncing');

          try {
            // Fetch all events (max 2500)
            const response = await fetch(
              'https://www.googleapis.com/calendar/v3/calendars/primary/events?maxResults=2500&singleEvents=true',
              {
                headers: {
                  'Authorization': `Bearer ${googleAccessToken}`
                }
              }
            );

            if (!response.ok) {
              throw new Error('Failed to fetch Google Calendar events');
            }

            const data = await response.json();
            const events = data.items || [];
            
            if (events.length === 0) {
              setSyncStatus('connected');
              alert('‚úÖ Google Calendar is already empty!\n\nNo events to delete.');
              return;
            }

            let deleted = 0;
            let failed = 0;

            // Delete each event
            for (const event of events) {
              try {
                const deleteResponse = await fetch(
                  `https://www.googleapis.com/calendar/v3/calendars/primary/events/${event.id}`,
                  {
                    method: 'DELETE',
                    headers: {
                      'Authorization': `Bearer ${googleAccessToken}`
                    }
                  }
                );

                if (deleteResponse.ok || deleteResponse.status === 410) {
                  // 410 = already deleted, count as success
                  deleted++;
                } else {
                  failed++;
                }
              } catch (err) {
                console.error('Failed to delete event:', event.id, err);
                failed++;
              }
            }

            setSyncStatus('connected');
            
            alert(
              '‚úÖ Google Calendar Cleared!\n\n' +
              `üìä Summary:\n` +
              `‚Ä¢ Deleted: ${deleted} events\n` +
              `‚Ä¢ Failed: ${failed} events\n` +
              `‚Ä¢ Total processed: ${events.length} events\n\n` +
              `Your Google Calendar is now empty.`
            );
          } catch (error) {
            console.error('Clear Calendar error:', error);
            setSyncStatus('connected');
            alert(
              '‚ùå Error clearing Google Calendar\n\n' +
              'Please try again or check your connection.'
            );
          }
        };

        const getCategoryColorId = (hexColor) => {
          // Map hex colors to Google Calendar color IDs (1-11)
          const colorMap = {
            '#8e44ad': '3', // purple
            '#3498db': '9', // blue
            '#e74c3c': '11', // red
            '#f39c12': '6', // orange
            '#27ae60': '10', // green
          };
          return colorMap[hexColor] || '1';
        };

        return (
          <div className="modal-overlay" onClick={() => setShowSyncModal(false)}>
            <div className="modal" onClick={e => e.stopPropagation()}>
              <h2>Google Calendar Sync</h2>
              
              <div className="sync-section" style={{ padding: '16px', marginBottom: '16px' }}>
                <div className="sync-header">
                  <h3 style={{ margin: 0, fontSize: '16px' }}>Connection Status</h3>
                  <div className={`sync-status ${googleConnected ? 'connected' : 'disconnected'}`}>
                    {googleConnected ? 'üü¢ Connected' : 'üî¥ Not Connected'}
                  </div>
                </div>
                {googleConnected && (
                  <div style={{ fontSize: '12px', color: '#6b9b7a', marginTop: '8px' }}>
                    Connected with Google account
                  </div>
                )}
              </div>

              {!googleClientId && (
                <div style={{ 
                  background: '#fff3e0', 
                  padding: '16px', 
                  borderRadius: '8px',
                  marginBottom: '20px'
                }}>
                  <p style={{ fontSize: '14px', color: '#f57c00', marginBottom: '12px' }}>
                    ‚ö†Ô∏è Google OAuth Client ID not configured
                  </p>
                  <button 
                    className="btn-primary" 
                    onClick={() => {
                      setShowSyncModal(false);
                      setShowGoogleSetupModal(true);
                    }}
                    style={{ width: '100%', justifyContent: 'center' }}
                  >
                    Set Up Google OAuth
                  </button>
                </div>
              )}

              {googleClientId && !googleConnected && (
                <div style={{ marginBottom: '20px' }}>
                  <p style={{ color: '#6b9b7a', marginBottom: '16px', fontSize: '14px' }}>
                    Connect TimeWise to your Google Calendar to:
                  </p>
                  <ul style={{ color: '#6b9b7a', fontSize: '14px', paddingLeft: '20px', marginBottom: '20px' }}>
                    <li>Sync events to Google Calendar</li>
                    <li>Apply category colors</li>
                    <li>Mark completion status</li>
                    <li>Access across all devices</li>
                  </ul>
                  <button className="btn-google" onClick={handleConnectGoogle} style={{ width: '100%', justifyContent: 'center', marginBottom: '12px' }}>
                    <span>üîó</span>
                    Connect Google Calendar
                  </button>
                  <button 
                    className="btn-secondary" 
                    onClick={handleResetOAuth}
                    style={{ width: '100%', justifyContent: 'center', fontSize: '13px' }}
                  >
                    üîÑ Reset OAuth Setup
                  </button>
                </div>
              )}

              {googleConnected && (
                <div>
                  <div style={{ marginBottom: '20px' }}>
                    <h4 style={{ marginBottom: '12px', color: '#2d5a3d', fontSize: '14px' }}>Sync Options</h4>
                    <div style={{ background: '#e8f5eb', padding: '12px', borderRadius: '8px', marginBottom: '12px', fontSize: '13px', color: '#2d5a3d' }}>
                      <strong>Two-way sync available!</strong><br/>
                      ‚Ä¢ Push TimeWise ‚Üí Google Calendar<br/>
                      ‚Ä¢ Pull Google Calendar ‚Üí TimeWise<br/>
                      ‚Ä¢ Or do both at once
                    </div>
                  </div>

                  <div style={{ display: 'flex', flexDirection: 'column', gap: '8px', marginBottom: '16px' }}>
                    <button 
                      className="btn-primary" 
                      onClick={syncBothWays}
                      style={{ width: '100%', justifyContent: 'center' }}
                      disabled={syncStatus === 'syncing'}
                    >
                      {syncStatus === 'syncing' ? '‚è≥ Syncing...' : 'üîÑ Two-Way Sync'}
                    </button>
                    <button 
                      className="btn-secondary" 
                      onClick={syncToGoogle}
                      style={{ width: '100%', justifyContent: 'center' }}
                      disabled={syncStatus === 'syncing'}
                    >
                      ‚¨ÜÔ∏è Push to Google
                    </button>
                    <button 
                      className="btn-secondary" 
                      onClick={syncFromGoogle}
                      style={{ width: '100%', justifyContent: 'center' }}
                      disabled={syncStatus === 'syncing'}
                    >
                      ‚¨áÔ∏è Pull from Google
                    </button>
                    <button 
                      onClick={syncFromGoogleMaster}
                      style={{ 
                        width: '100%', 
                        justifyContent: 'center',
                        padding: '10px 20px',
                        background: 'linear-gradient(135deg, #4a7c59 0%, #3d6b4a 100%)',
                        color: 'white',
                        border: '2px solid #2d5a3d',
                        borderRadius: '6px',
                        cursor: syncStatus === 'syncing' ? 'not-allowed' : 'pointer',
                        fontSize: '14px',
                        fontWeight: '600',
                        transition: 'all 0.2s',
                        opacity: syncStatus === 'syncing' ? 0.6 : 1
                      }}
                      disabled={syncStatus === 'syncing'}
                      onMouseEnter={e => {
                        if (syncStatus !== 'syncing') {
                          e.target.style.background = 'linear-gradient(135deg, #3d6b4a 0%, #2d5a3d 100%)';
                          e.target.style.transform = 'translateY(-1px)';
                          e.target.style.boxShadow = '0 4px 8px rgba(74, 124, 89, 0.3)';
                        }
                      }}
                      onMouseLeave={e => {
                        e.target.style.background = 'linear-gradient(135deg, #4a7c59 0%, #3d6b4a 100%)';
                        e.target.style.transform = 'translateY(0)';
                        e.target.style.boxShadow = 'none';
                      }}
                    >
                      üéØ Google Master Sync
                    </button>
                  </div>

                  <div style={{
                    background: '#e8f5eb',
                    padding: '12px',
                    borderRadius: '8px',
                    marginBottom: '16px',
                    border: '2px solid #4a7c59'
                  }}>
                    <div style={{ 
                      fontSize: '13px', 
                      color: '#2d5a3d',
                      fontWeight: '600',
                      marginBottom: '8px',
                      display: 'flex',
                      alignItems: 'center',
                      gap: '6px'
                    }}>
                      <span>üéØ</span>
                      <span>Google Master Sync</span>
                    </div>
                    <div style={{ fontSize: '12px', color: '#4a7c59', lineHeight: '1.5' }}>
                      Use this when you want Google Calendar to be the single source of truth:
                      <ul style={{ margin: '8px 0', paddingLeft: '20px' }}>
                        <li>Keeps all past events ‚úÖ</li>
                        <li>Deletes future Planned events ‚ö†Ô∏è</li>
                        <li>Imports next 1 year from Google</li>
                        <li>Makes TimeWise match Google exactly</li>
                      </ul>
                      Perfect for resolving conflicts or starting fresh!
                    </div>
                  </div>

                  <div style={{ 
                    paddingTop: '16px', 
                    borderTop: '1px solid #e0e7e0',
                    display: 'flex',
                    flexDirection: 'column',
                    gap: '8px'
                  }}>
                    <button 
                      className="btn-secondary" 
                      onClick={handleSignOut}
                      style={{ width: '100%', justifyContent: 'center' }}
                    >
                      üö™ Sign Out
                    </button>
                    <button 
                      onClick={handleResetOAuth}
                      style={{ 
                        width: '100%', 
                        justifyContent: 'center',
                        background: 'transparent',
                        border: '1px solid #e0e7e0',
                        padding: '8px 16px',
                        borderRadius: '6px',
                        color: '#6b9b7a',
                        fontSize: '13px',
                        cursor: 'pointer',
                        transition: 'all 0.2s'
                      }}
                      onMouseEnter={e => e.target.style.background = '#f5f7f5'}
                      onMouseLeave={e => e.target.style.background = 'transparent'}
                    >
                      üîÑ Reset OAuth Setup
                    </button>
                  </div>
                </div>
              )}

              {/* Danger Zone - Clear Calendar */}
              {googleConnected && (
                <div style={{
                  marginTop: '24px',
                  paddingTop: '20px',
                  borderTop: '3px solid #ffebee'
                }}>
                  <div style={{
                    background: 'linear-gradient(135deg, #ffebee 0%, #ffcdd2 100%)',
                    padding: '16px',
                    borderRadius: '12px',
                    marginBottom: '12px',
                    border: '2px solid #f44336'
                  }}>
                    <div style={{
                      display: 'flex',
                      alignItems: 'center',
                      gap: '8px',
                      marginBottom: '8px'
                    }}>
                      <span style={{ fontSize: '20px' }}>‚ö†Ô∏è</span>
                      <h4 style={{ 
                        margin: 0, 
                        color: '#d32f2f',
                        fontSize: '15px',
                        fontWeight: '700'
                      }}>
                        Danger Zone
                      </h4>
                    </div>
                    <p style={{
                      fontSize: '12px',
                      color: '#c62828',
                      margin: 0,
                      lineHeight: '1.5'
                    }}>
                      The action below will permanently delete ALL events from your Google Calendar. This cannot be undone!
                    </p>
                  </div>
                  
                  <button
                    onClick={clearGoogleCalendar}
                    disabled={syncStatus === 'syncing'}
                    style={{
                      width: '100%',
                      background: 'linear-gradient(135deg, #f44336 0%, #d32f2f 100%)',
                      color: 'white',
                      border: 'none',
                      padding: '12px 20px',
                      borderRadius: '8px',
                      cursor: syncStatus === 'syncing' ? 'not-allowed' : 'pointer',
                      fontSize: '14px',
                      fontWeight: '700',
                      boxShadow: '0 4px 12px rgba(244, 67, 54, 0.3)',
                      opacity: syncStatus === 'syncing' ? 0.6 : 1,
                      transition: 'all 0.2s',
                      display: 'flex',
                      alignItems: 'center',
                      justifyContent: 'center',
                      gap: '8px'
                    }}
                    onMouseEnter={e => {
                      if (syncStatus !== 'syncing') {
                        e.target.style.transform = 'translateY(-2px)';
                        e.target.style.boxShadow = '0 6px 16px rgba(244, 67, 54, 0.4)';
                      }
                    }}
                    onMouseLeave={e => {
                      e.target.style.transform = 'translateY(0)';
                      e.target.style.boxShadow = '0 4px 12px rgba(244, 67, 54, 0.3)';
                    }}
                  >
                    <span style={{ fontSize: '18px' }}>üóëÔ∏è</span>
                    <span>Clear All Google Calendar Events</span>
                  </button>
                  
                  <p style={{
                    fontSize: '11px',
                    color: '#d32f2f',
                    marginTop: '8px',
                    textAlign: 'center',
                    fontWeight: '500'
                  }}>
                    ‚ö†Ô∏è This will require double confirmation
                  </p>
                </div>
              )}

              <div className="modal-actions">
                <button className="btn-primary" onClick={() => setShowSyncModal(false)}>Close</button>
              </div>
            </div>
          </div>
        );
      };

      const Analytics = () => {
        const [useCustomRange, setUseCustomRange] = useState(false);
        const [customStartDate, setCustomStartDate] = useState('');
        const [customEndDate, setCustomEndDate] = useState('');

        const getDateRange = () => {
          if (useCustomRange) {
            if (customStartDate && customEndDate) {
              const startDate = new Date(customStartDate);
              const endDate = new Date(customEndDate);
              endDate.setHours(23, 59, 59, 999);
              return { startDate, endDate };
            } else {
              return null;
            }
          }

          // Sync with current calendar view
          let startDate = new Date(currentDate);
          let endDate = new Date(currentDate);

          switch(view) {
            case 'daily':
              startDate.setHours(0, 0, 0, 0);
              endDate.setHours(23, 59, 59, 999);
              break;
            case 'weekly':
              // Get Monday to Sunday of current week
              const dayOfWeek = startDate.getDay();
              const diff = dayOfWeek === 0 ? -6 : 1 - dayOfWeek; // Monday
              startDate.setDate(startDate.getDate() + diff);
              startDate.setHours(0, 0, 0, 0);
              endDate = new Date(startDate);
              endDate.setDate(endDate.getDate() + 6); // Sunday
              endDate.setHours(23, 59, 59, 999);
              break;
            case 'monthly':
              startDate = new Date(currentDate.getFullYear(), currentDate.getMonth(), 1);
              endDate = new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 0);
              endDate.setHours(23, 59, 59, 999);
              break;
            case 'yearly':
              startDate = new Date(currentDate.getFullYear(), 0, 1);
              endDate = new Date(currentDate.getFullYear(), 11, 31);
              endDate.setHours(23, 59, 59, 999);
              break;
          }

          return { startDate, endDate };
        };

        const calculateStats = (eventType) => {
          const range = getDateRange();
          if (!range) return { categoryStats: [], projectStats: [] };
          
          const { startDate, endDate } = range;

          // Category stats
          const categoryStats = categories.map(cat => {
            const categoryEvents = events.filter(e => 
              e.categoryId === cat.id && 
              e.type === eventType &&
              new Date(e.startDateTime) >= startDate &&
              new Date(e.startDateTime) <= endDate
            );

            const totalMinutes = categoryEvents.reduce((sum, event) => {
              const start = new Date(event.startDateTime);
              const end = new Date(event.endDateTime);
              return sum + (end - start) / (1000 * 60);
            }, 0);

            return {
              ...cat,
              hours: Math.round(totalMinutes / 60 * 10) / 10,
              percentage: 0
            };
          });

          const totalCategoryHours = categoryStats.reduce((sum, cat) => sum + cat.hours, 0);
          categoryStats.forEach(cat => {
            cat.percentage = totalCategoryHours > 0 ? Math.round((cat.hours / totalCategoryHours) * 100) : 0;
          });

          // Project stats (only for actual events)
          const projectStats = eventType === 'actual' ? yearlyProjects.map(project => {
            const projectEvents = events.filter(e => 
              e.projectId === project.id && 
              e.type === 'actual' &&
              new Date(e.startDateTime) >= startDate &&
              new Date(e.startDateTime) <= endDate
            );

            const totalMinutes = projectEvents.reduce((sum, event) => {
              const start = new Date(event.startDateTime);
              const end = new Date(event.endDateTime);
              return sum + (end - start) / (1000 * 60);
            }, 0);

            return {
              ...project,
              hours: Math.round(totalMinutes / 60 * 10) / 10,
              percentage: 0
            };
          }) : [];

          const totalProjectHours = projectStats.reduce((sum, proj) => sum + proj.hours, 0);
          projectStats.forEach(proj => {
            proj.percentage = totalProjectHours > 0 ? Math.round((proj.hours / totalProjectHours) * 100) : 0;
          });

          return { categoryStats, projectStats };
        };

        const plannedStats = calculateStats('planned');
        const actualStats = calculateStats('actual');
        const hasPlannedData = plannedStats.categoryStats.some(stat => stat.hours > 0);
        const hasActualData = actualStats.categoryStats.some(stat => stat.hours > 0);

        const getDateRangeLabel = () => {
          const range = getDateRange();
          if (!range) return 'Select dates';
          
          if (useCustomRange) {
            return `${customStartDate} to ${customEndDate}`;
          }

          const { startDate, endDate } = range;
          
          switch(view) {
            case 'daily':
              return currentDate.toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric', year: 'numeric' });
            case 'weekly':
              return `${startDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric' })} - ${endDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })}`;
            case 'monthly':
              return currentDate.toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
            case 'yearly':
              return currentDate.getFullYear().toString();
          }
        };

        return (
          <div className="analytics-panel">
            <div className="analytics-header" style={{ marginBottom: '20px' }}>
              <h2>Time Analytics</h2>
              <div style={{ display: 'flex', gap: '8px', alignItems: 'center', flexWrap: 'wrap' }}>
                <div style={{
                  padding: '8px 12px',
                  background: useCustomRange ? '#f5f7f5' : '#e8f5eb',
                  borderRadius: '6px',
                  fontSize: '13px',
                  fontWeight: 600,
                  color: '#2d5a3d',
                  border: useCustomRange ? '1px solid #d4e8d9' : '2px solid #4a7c59',
                  display: 'flex',
                  alignItems: 'center',
                  gap: '6px'
                }}>
                  üìÖ {getDateRangeLabel()}
                </div>
                <button
                  onClick={() => setUseCustomRange(!useCustomRange)}
                  style={{
                    padding: '6px 12px',
                    background: 'white',
                    border: '1px solid #d4e8d9',
                    borderRadius: '6px',
                    fontSize: '12px',
                    color: '#4a7c59',
                    cursor: 'pointer',
                    transition: 'all 0.2s'
                  }}
                  onMouseEnter={e => e.target.style.background = '#f5f7f5'}
                  onMouseLeave={e => e.target.style.background = 'white'}
                >
                  {useCustomRange ? 'üîô Use Calendar View' : 'üìÜ Custom Range'}
                </button>
              </div>
            </div>

            {useCustomRange && (
              <div style={{ 
                marginBottom: '20px',
                padding: '16px',
                background: '#f5f7f5',
                borderRadius: '8px',
                display: 'flex',
                gap: '12px',
                alignItems: 'center',
                flexWrap: 'wrap'
              }}>
                <label style={{ fontSize: '13px', color: '#2d5a3d', fontWeight: 600 }}>
                  Date Range:
                </label>
                <input 
                  type="date" 
                  value={customStartDate}
                  onChange={e => setCustomStartDate(e.target.value)}
                  style={{ padding: '6px 10px', borderRadius: '6px', border: '1px solid #d4e8d9' }}
                />
                <span style={{ color: '#6b9b7a' }}>to</span>
                <input 
                  type="date" 
                  value={customEndDate}
                  onChange={e => setCustomEndDate(e.target.value)}
                  style={{ padding: '6px 10px', borderRadius: '6px', border: '1px solid #d4e8d9' }}
                />
              </div>
            )}

            {!hasPlannedData && !hasActualData && (
              <p style={{ color: '#6b9b7a', textAlign: 'center', padding: '20px' }}>
                No events recorded for this time period. Create some events to see analytics!
              </p>
            )}

            {(hasPlannedData || hasActualData) && (
              <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '24px' }}>
                {/* Planned Section */}
                <div>
                  <div style={{
                    padding: '12px',
                    background: 'linear-gradient(135deg, #e8f5eb 0%, #d4e8d9 100%)',
                    borderRadius: '8px',
                    marginBottom: '16px',
                    border: '2px dashed #4a7c59',
                    textAlign: 'center'
                  }}>
                    <span style={{ fontSize: '14px', fontWeight: 600, color: '#2d5a3d' }}>
                      üìã Planned Time
                    </span>
                  </div>

                  {!hasPlannedData && (
                    <p style={{ color: '#6b9b7a', textAlign: 'center', padding: '20px', fontSize: '13px' }}>
                      No planned events in this period
                    </p>
                  )}

                  {hasPlannedData && (
                    <>
                      <h4 style={{ fontSize: '13px', color: '#2d5a3d', marginBottom: '12px', fontWeight: 600 }}>
                        By Category
                      </h4>
                      <div className="category-stats">
                        {plannedStats.categoryStats.filter(s => s.hours > 0).map(stat => (
                          <div key={stat.id} className="stat-item">
                            <div className="stat-header">
                              <div className="stat-color" style={{ 
                                backgroundColor: stat.color,
                                borderStyle: 'dashed',
                                borderWidth: '2px'
                              }}></div>
                              <span className="stat-name">{stat.name}</span>
                              <span className="stat-hours">{stat.hours}h</span>
                            </div>
                            <div className="stat-bar">
                              <div 
                                className="stat-fill" 
                                style={{ 
                                  width: `${stat.percentage}%`,
                                  background: `linear-gradient(135deg, ${stat.color}30 0%, ${stat.color}50 100%)`
                                }}
                              ></div>
                            </div>
                            <div className="stat-percentage">{stat.percentage}%</div>
                          </div>
                        ))}
                      </div>
                    </>
                  )}
                </div>

                {/* Actual Section */}
                <div>
                  <div style={{
                    padding: '12px',
                    background: 'linear-gradient(135deg, #f0f9f4 0%, #e0f0e8 100%)',
                    borderRadius: '8px',
                    marginBottom: '16px',
                    border: '2px solid #6b9b7a',
                    textAlign: 'center'
                  }}>
                    <span style={{ fontSize: '14px', fontWeight: 600, color: '#4a7c59' }}>
                      ‚úÖ Actual Time
                    </span>
                  </div>

                  {!hasActualData && (
                    <p style={{ color: '#6b9b7a', textAlign: 'center', padding: '20px', fontSize: '13px' }}>
                      No actual events in this period
                    </p>
                  )}

                  {hasActualData && (
                    <>
                      <h4 style={{ fontSize: '13px', color: '#2d5a3d', marginBottom: '12px', fontWeight: 600 }}>
                        By Category
                      </h4>
                      <div className="category-stats">
                        {actualStats.categoryStats.filter(s => s.hours > 0).map(stat => (
                          <div key={stat.id} className="stat-item">
                            <div className="stat-header">
                              <div className="stat-color" style={{ backgroundColor: stat.color }}></div>
                              <span className="stat-name">{stat.name}</span>
                              <span className="stat-hours">{stat.hours}h</span>
                            </div>
                            <div className="stat-bar">
                              <div 
                                className="stat-fill" 
                                style={{ 
                                  width: `${stat.percentage}%`,
                                  background: `linear-gradient(135deg, ${stat.color}B0 0%, ${stat.color}D0 100%)`
                                }}
                              ></div>
                            </div>
                            <div className="stat-percentage">{stat.percentage}%</div>
                          </div>
                        ))}
                      </div>

                      {yearlyProjects.length > 0 && (
                        <>
                          <h4 style={{ 
                            fontSize: '13px', 
                            color: '#2d5a3d', 
                            marginTop: '24px',
                            marginBottom: '12px', 
                            fontWeight: 600,
                            display: 'flex',
                            alignItems: 'center',
                            gap: '6px'
                          }}>
                            üéØ By Project
                          </h4>
                          <div className="category-stats">
                            {actualStats.projectStats.filter(s => s.hours > 0).map(stat => (
                              <div key={stat.id} className="stat-item">
                                <div className="stat-header">
                                  <div className="stat-color" style={{ backgroundColor: '#f39c12' }}></div>
                                  <span className="stat-name">{stat.name}</span>
                                  <span className="stat-hours">{stat.hours}h</span>
                                </div>
                                <div className="stat-bar">
                                  <div 
                                    className="stat-fill" 
                                    style={{ 
                                      width: `${stat.percentage}%`,
                                      background: 'linear-gradient(135deg, #f39c12B0 0%, #f39c12D0 100%)'
                                    }}
                                  ></div>
                                </div>
                                <div className="stat-percentage">{stat.percentage}%</div>
                              </div>
                            ))}
                          </div>
                        </>
                      )}
                    </>
                  )}
                </div>
              </div>
            )}

            <button className="btn-secondary" onClick={() => setShowAnalytics(false)} style={{ width: '100%', marginTop: '20px' }}>Close</button>
          </div>
        );
      };

      // Journal Modal - Setup Google Docs link for weekly reflections
      const JournalModal = () => {
        const [docUrl, setDocUrl] = useState(journalDocUrl);
        
        const handleSave = () => {
          setJournalDocUrl(docUrl);
          setShowJournalModal(false);
          if (docUrl) {
            alert('‚úÖ Journal link saved!\n\nClick "Open Journal" to start writing.');
          }
        };
        
        const handleOpen = () => {
          if (docUrl) {
            window.open(docUrl, '_blank');
          } else {
            alert('Please set your Google Docs link first.');
          }
        };
        
        return (
          <div className="modal-overlay" onClick={() => setShowJournalModal(false)}>
            <div className="modal" onClick={e => e.stopPropagation()} style={{ maxWidth: '500px' }}>
              <h2 style={{ marginBottom: '20px', color: '#2d5a3d' }}>
                üìî Weekly Journal Setup
              </h2>
              
              <div style={{ marginBottom: '20px' }}>
                <p style={{ fontSize: '14px', color: '#6b9b7a', marginBottom: '16px', lineHeight: '1.6' }}>
                  Connect your Google Docs for weekly reflections. We recommend creating a dedicated document for your journey.
                </p>
                
                <div style={{ 
                  background: '#f0f9f4', 
                  padding: '16px', 
                  borderRadius: '8px',
                  marginBottom: '16px',
                  border: '1px solid #e0f0e8'
                }}>
                  <p style={{ fontSize: '13px', color: '#2d5a3d', marginBottom: '8px', fontWeight: '600' }}>
                    üí° Quick Setup:
                  </p>
                  <ol style={{ fontSize: '12px', color: '#4a7c59', paddingLeft: '20px', margin: 0 }}>
                    <li>Create a new Google Doc</li>
                    <li>Name it "Weekly Reflections 2025"</li>
                    <li>Copy the document URL</li>
                    <li>Paste it below</li>
                  </ol>
                </div>
                
                <label style={{ 
                  display: 'block', 
                  marginBottom: '8px', 
                  fontWeight: '600', 
                  color: '#2d5a3d',
                  fontSize: '14px'
                }}>
                  Google Docs URL
                </label>
                <input
                  type="url"
                  value={docUrl}
                  onChange={(e) => setDocUrl(e.target.value)}
                  placeholder="https://docs.google.com/document/d/..."
                  style={{
                    width: '100%',
                    padding: '10px',
                    border: '2px solid #e0f0e8',
                    borderRadius: '6px',
                    fontSize: '14px',
                    fontFamily: 'monospace'
                  }}
                />
              </div>
              
              <div className="modal-actions" style={{ display: 'flex', gap: '8px' }}>
                {docUrl && (
                  <button 
                    className="btn-secondary" 
                    onClick={handleOpen}
                    style={{ flex: 1 }}
                  >
                    üîó Open Journal
                  </button>
                )}
                <button 
                  className="btn-primary" 
                  onClick={handleSave}
                  style={{ flex: 1 }}
                >
                  üíæ Save
                </button>
                <button 
                  className="btn-secondary" 
                  onClick={() => setShowJournalModal(false)}
                >
                  Cancel
                </button>
              </div>
            </div>
          </div>
        );
      };

      // Weekly Reflection Modal - Set goals and reflect on the week
      const WeeklyReflectionModal = () => {
        const weekKey = getWeekKey(currentDate);
        const currentData = weeklyGoals[weekKey] || { goal: '', highlight: '', lowlight: '' };
        const [weekData, setWeekData] = useState(currentData);
        
        const handleSave = () => {
          setWeeklyGoals({
            ...weeklyGoals,
            [weekKey]: weekData
          });
          setShowWeeklyReflectionModal(false);
          alert('‚úÖ Weekly reflection saved!');
        };
        
        return (
          <div className="modal-overlay" onClick={() => setShowWeeklyReflectionModal(false)}>
            <div className="modal" onClick={e => e.stopPropagation()} style={{ maxWidth: '600px' }}>
              <h2 style={{ marginBottom: '8px', color: '#2d5a3d' }}>
                ‚ú® Weekly Reflection
              </h2>
              <p style={{ fontSize: '13px', color: '#6b9b7a', marginBottom: '20px' }}>
                Week of {currentDate.toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' })}
              </p>
              
              {/* Weekly Goal */}
              <div style={{ marginBottom: '20px' }}>
                <label style={{ 
                  display: 'flex',
                  alignItems: 'center',
                  gap: '8px',
                  marginBottom: '8px', 
                  fontWeight: '600', 
                  color: '#2d5a3d',
                  fontSize: '15px'
                }}>
                  <span>üéØ</span>
                  <span>Weekly Goal</span>
                </label>
                <input
                  type="text"
                  value={weekData.goal}
                  onChange={(e) => setWeekData({ ...weekData, goal: e.target.value })}
                  placeholder="What do you want to achieve this week?"
                  style={{
                    width: '100%',
                    padding: '12px',
                    border: '2px solid #e0f0e8',
                    borderRadius: '8px',
                    fontSize: '14px'
                  }}
                />
                <p style={{ fontSize: '11px', color: '#6b9b7a', marginTop: '4px' }}>
                  Make it specific and actionable
                </p>
              </div>
              
              {/* Highlight */}
              <div style={{ marginBottom: '20px' }}>
                <label style={{ 
                  display: 'flex',
                  alignItems: 'center',
                  gap: '8px',
                  marginBottom: '8px', 
                  fontWeight: '600', 
                  color: '#2d5a3d',
                  fontSize: '15px'
                }}>
                  <span>‚≠ê</span>
                  <span>Week Highlight</span>
                </label>
                <textarea
                  value={weekData.highlight}
                  onChange={(e) => setWeekData({ ...weekData, highlight: e.target.value })}
                  placeholder="What went well? What are you proud of?"
                  rows={3}
                  style={{
                    width: '100%',
                    padding: '12px',
                    border: '2px solid #e0f0e8',
                    borderRadius: '8px',
                    fontSize: '14px',
                    resize: 'vertical',
                    fontFamily: 'inherit'
                  }}
                />
              </div>
              
              {/* Lowlight */}
              <div style={{ marginBottom: '20px' }}>
                <label style={{ 
                  display: 'flex',
                  alignItems: 'center',
                  gap: '8px',
                  marginBottom: '8px', 
                  fontWeight: '600', 
                  color: '#2d5a3d',
                  fontSize: '15px'
                }}>
                  <span>üìâ</span>
                  <span>Week Challenge</span>
                </label>
                <textarea
                  value={weekData.lowlight}
                  onChange={(e) => setWeekData({ ...weekData, lowlight: e.target.value })}
                  placeholder="What challenges did you face? What can you learn?"
                  rows={3}
                  style={{
                    width: '100%',
                    padding: '12px',
                    border: '2px solid #e0f0e8',
                    borderRadius: '8px',
                    fontSize: '14px',
                    resize: 'vertical',
                    fontFamily: 'inherit'
                  }}
                />
              </div>
              
              <div style={{
                background: '#fff3e0',
                padding: '12px',
                borderRadius: '8px',
                marginBottom: '20px',
                border: '1px solid #ffe0b2'
              }}>
                <p style={{ fontSize: '12px', color: '#e65100', margin: 0 }}>
                  üí° <strong>Tip:</strong> Reflect honestly. Both wins and challenges help you grow.
                </p>
              </div>
              
              <div className="modal-actions">
                <button className="btn-primary" onClick={handleSave}>
                  üíæ Save Reflection
                </button>
                <button className="btn-secondary" onClick={() => setShowWeeklyReflectionModal(false)}>
                  Cancel
                </button>
              </div>
            </div>
          </div>
        );
      };

      const DailyView = () => {
        const [isSelecting, setIsSelecting] = useState(false);
        const [selectionStart, setSelectionStart] = useState(null);
        const [selectionEnd, setSelectionEnd] = useState(null);

        const hours = Array.from({ length: 24 }, (_, i) => i);
        const timeSlots = hours.flatMap(hour => [
          { hour, minute: 0, label: `${hour.toString().padStart(2, '0')}:00` },
          { hour, minute: 30, label: `${hour.toString().padStart(2, '0')}:30` }
        ]);

        const year = currentDate.getFullYear();
        const month = currentDate.getMonth();
        const day = currentDate.getDate();

        const getEventsForDay = () => {
          return events.filter(e => {
            const eventDate = new Date(e.startDateTime);
            return eventDate.getDate() === day && 
                   eventDate.getMonth() === month && 
                   eventDate.getFullYear() === year;
          }).sort((a, b) => new Date(a.startDateTime) - new Date(b.startDateTime));
        };

        const handleMouseDown = (slot) => {
          setIsSelecting(true);
          setSelectionStart(slot);
          setSelectionEnd(slot);
        };

        const handleMouseEnter = (slot) => {
          if (isSelecting) {
            setSelectionEnd(slot);
          }
        };

        const handleMouseUp = () => {
          if (isSelecting && selectionStart && selectionEnd) {
            const start = selectionStart.hour * 60 + selectionStart.minute;
            const end = selectionEnd.hour * 60 + selectionEnd.minute;
            
            const actualStart = Math.min(start, end);
            const actualEnd = Math.max(start, end) + 30;

            const startHour = Math.floor(actualStart / 60);
            const startMin = actualStart % 60;
            const endHour = Math.floor(actualEnd / 60);
            const endMin = actualEnd % 60;

            const eventData = {
              title: '',
              startDate: formatDate(currentDate),
              startTime: `${startHour.toString().padStart(2, '0')}:${startMin.toString().padStart(2, '0')}`,
              endDate: formatDate(currentDate),
              endTime: `${endHour.toString().padStart(2, '0')}:${endMin.toString().padStart(2, '0')}`,
              categoryId: categories[0]?.id || '',
              type: 'planned',
              description: '',
              location: '',
              projectId: ''
            };

            // Open full event modal with prefilled time
            setPrefilledEventData(eventData);
            setShowEventModal(true);
          }
          setIsSelecting(false);
          setSelectionStart(null);
          setSelectionEnd(null);
        };

        const isSlotSelected = (slot) => {
          if (!selectionStart || !selectionEnd) return false;
          const slotTime = slot.hour * 60 + slot.minute;
          const startTime = selectionStart.hour * 60 + selectionStart.minute;
          const endTime = selectionEnd.hour * 60 + selectionEnd.minute;
          const min = Math.min(startTime, endTime);
          const max = Math.max(startTime, endTime);
          return slotTime >= min && slotTime <= max;
        };

        const getEventPosition = (event) => {
          const start = new Date(event.startDateTime);
          const end = new Date(event.endDateTime);
          const startMinutes = start.getHours() * 60 + start.getMinutes();
          const duration = (end - start) / (1000 * 60);
          
          return {
            top: `${(startMinutes / 30) * 40}px`,
            height: `${(duration / 30) * 40}px`
          };
        };

        const dayEvents = getEventsForDay();

        // Calculate daily progress
        const todayEvents = events.filter(e => {
          const eventDate = new Date(e.startDateTime).toDateString();
          return eventDate === currentDate.toDateString();
        });
        const completed = todayEvents.filter(e => e.type === 'actual').length;
        const planned = todayEvents.filter(e => e.type === 'planned').length;
        const completionRate = planned > 0 ? Math.round((completed / planned) * 100) : 0;
        const todayHours = todayEvents
          .filter(e => e.type === 'actual')
          .reduce((sum, e) => {
            const duration = (new Date(e.endDateTime) - new Date(e.startDateTime)) / (1000 * 60 * 60);
            return sum + duration;
          }, 0);

        // Check day of week
        const dayOfWeek = currentDate.getDay();
        const isSunday = dayOfWeek === 0;
        const isFriday = dayOfWeek === 5;
        const weekData = getCurrentWeekData();
        const hasWeeklyReflection = weekData.goal || weekData.highlight || weekData.lowlight;

        return (
          <div className="daily-view-container">
            {/* Sunday Planning Banner */}
            {isSunday && (
              <div style={{
                background: 'linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%)',
                border: '2px solid #2196f3',
                borderRadius: '12px',
                padding: '16px',
                marginBottom: '20px',
                display: 'flex',
                alignItems: 'center',
                gap: '12px'
              }}>
                <span style={{ fontSize: '32px' }}>üìÖ</span>
                <div style={{ flex: 1 }}>
                  <div style={{ fontSize: '15px', fontWeight: '600', color: '#1565c0', marginBottom: '4px' }}>
                    Sunday Planning Time!
                  </div>
                  <div style={{ fontSize: '13px', color: '#1976d2' }}>
                    Perfect time to plan your week in Google Calendar, then sync to TimeWise.
                  </div>
                </div>
              </div>
            )}

            {/* Friday Reflection Banner */}
            {isFriday && !hasWeeklyReflection && (
              <div style={{
                background: 'linear-gradient(135deg, #f3e5f5 0%, #e1bee7 100%)',
                border: '2px solid #9c27b0',
                borderRadius: '12px',
                padding: '16px',
                marginBottom: '20px',
                display: 'flex',
                alignItems: 'center',
                gap: '12px'
              }}>
                <span style={{ fontSize: '32px' }}>‚ú®</span>
                <div style={{ flex: 1 }}>
                  <div style={{ fontSize: '15px', fontWeight: '600', color: '#6a1b9a', marginBottom: '4px' }}>
                    Friday Reflection Time!
                  </div>
                  <div style={{ fontSize: '13px', color: '#7b1fa2', marginBottom: '8px' }}>
                    Take a moment to reflect on your week's progress.
                  </div>
                  <button
                    onClick={() => setShowWeeklyReflectionModal(true)}
                    style={{
                      background: '#9c27b0',
                      color: 'white',
                      border: 'none',
                      padding: '6px 12px',
                      borderRadius: '6px',
                      fontSize: '12px',
                      fontWeight: '600',
                      cursor: 'pointer',
                      transition: 'all 0.2s'
                    }}
                    onMouseEnter={e => e.target.style.background = '#7b1fa2'}
                    onMouseLeave={e => e.target.style.background = '#9c27b0'}
                  >
                    Add Weekly Reflection ‚Üí
                  </button>
                </div>
              </div>
            )}

            {/* Daily Progress Card */}
            <div style={{
              background: 'linear-gradient(135deg, #f0f9f4 0%, #e0f0e8 100%)',
              borderRadius: '12px',
              padding: '20px',
              marginBottom: '20px',
              border: '2px solid #4a7c59'
            }}>
              <h3 style={{ 
                fontSize: '18px', 
                color: '#2d5a3d', 
                marginBottom: '16px',
                display: 'flex',
                alignItems: 'center',
                gap: '8px'
              }}>
                <span>üìà</span>
                <span>Today's Progress</span>
              </h3>
              
              <div style={{ 
                display: 'grid', 
                gridTemplateColumns: 'repeat(auto-fit, minmax(120px, 1fr))', 
                gap: '12px',
                marginBottom: '12px'
              }}>
                <div style={{ 
                  background: 'white', 
                  padding: '12px', 
                  borderRadius: '8px',
                  textAlign: 'center'
                }}>
                  <div style={{ fontSize: '24px', fontWeight: '700', color: '#4caf50' }}>
                    {completed}
                  </div>
                  <div style={{ fontSize: '12px', color: '#6b9b7a' }}>Completed</div>
                </div>
                
                <div style={{ 
                  background: 'white', 
                  padding: '12px', 
                  borderRadius: '8px',
                  textAlign: 'center'
                }}>
                  <div style={{ fontSize: '24px', fontWeight: '700', color: '#2196f3' }}>
                    {planned}
                  </div>
                  <div style={{ fontSize: '12px', color: '#6b9b7a' }}>Planned</div>
                </div>
                
                <div style={{ 
                  background: 'white', 
                  padding: '12px', 
                  borderRadius: '8px',
                  textAlign: 'center'
                }}>
                  <div style={{ fontSize: '24px', fontWeight: '700', color: '#ff9800' }}>
                    {Math.round(todayHours * 10) / 10}h
                  </div>
                  <div style={{ fontSize: '12px', color: '#6b9b7a' }}>Hours</div>
                </div>
                
                <div style={{ 
                  background: 'white', 
                  padding: '12px', 
                  borderRadius: '8px',
                  textAlign: 'center'
                }}>
                  <div style={{ fontSize: '24px', fontWeight: '700', color: planned === 0 ? '#9e9e9e' : completionRate >= 80 ? '#4caf50' : completionRate >= 60 ? '#8bc34a' : '#ff9800' }}>
                    {completionRate}%
                  </div>
                  <div style={{ fontSize: '12px', color: '#6b9b7a' }}>Success</div>
                </div>
              </div>
              
              <div style={{
                padding: '12px',
                background: 'white',
                borderRadius: '8px',
                textAlign: 'center'
              }}>
                <p style={{
                  fontSize: '14px',
                  color: '#2d5a3d',
                  fontWeight: '500',
                  margin: 0
                }}>
                  {planned === 0 
                    ? 'üéØ No tasks planned yet. Start planning your day!'
                    : getMotivationalQuote(completionRate)}
                </p>
              </div>
            </div>

            {/* Header labels for Planned vs Actual */}
            <div style={{
              display: 'flex',
              marginBottom: '12px',
              paddingLeft: '60px',
              gap: '8px'
            }}>
              <div style={{
                flex: 1,
                textAlign: 'center',
                padding: '8px',
                background: 'linear-gradient(135deg, #e8f5eb 0%, #d4e8d9 100%)',
                borderRadius: '8px',
                fontSize: '13px',
                fontWeight: 600,
                color: '#2d5a3d',
                border: '2px dashed #4a7c59'
              }}>
                üìã Planned
              </div>
              <div style={{
                flex: 1,
                textAlign: 'center',
                padding: '8px',
                background: 'linear-gradient(135deg, #f0f9f4 0%, #e0f0e8 100%)',
                borderRadius: '8px',
                fontSize: '13px',
                fontWeight: 600,
                color: '#4a7c59',
                border: '2px solid #6b9b7a'
              }}>
                ‚úÖ Actual
              </div>
            </div>
            
            <div className="time-grid" onMouseUp={handleMouseUp} onMouseLeave={handleMouseUp}>
              <div className="time-labels">
                {timeSlots.map((slot, index) => (
                  <div key={index} className="time-label">
                    {slot.minute === 0 ? slot.label : ''}
                  </div>
                ))}
              </div>
              <div className="time-slots">
                {timeSlots.map((slot, index) => (
                  <div
                    key={index}
                    className={`time-slot ${isSlotSelected(slot) ? 'selected' : ''}`}
                    onMouseDown={() => handleMouseDown(slot)}
                    onMouseEnter={() => handleMouseEnter(slot)}
                  >
                    {slot.minute === 0 && <div className="hour-line"></div>}
                  </div>
                ))}
                <div className="events-overlay">
                  {/* Center divider line between planned (left) and actual (right) */}
                  <div style={{
                    position: 'absolute',
                    left: '50%',
                    top: 0,
                    bottom: 0,
                    width: '2px',
                    background: 'linear-gradient(to bottom, transparent, rgba(45, 90, 61, 0.1) 5%, rgba(45, 90, 61, 0.1) 95%, transparent)',
                    pointerEvents: 'none',
                    zIndex: 0
                  }}></div>
                  
                  {dayEvents.map(event => {
                    const category = categories.find(c => c.id === event.categoryId);
                    const position = getEventPosition(event);
                    const isPlanned = event.type === 'planned' && !event.completed;
                    
                    // Create gradient based on event type and category color
                    const baseColor = category?.color || '#4a7c59';
                    const background = event.type === 'planned' 
                      ? `linear-gradient(135deg, ${baseColor}20 0%, ${baseColor}40 100%)`  // Light gradient for planned
                      : `linear-gradient(135deg, ${baseColor}B0 0%, ${baseColor}D0 100%)`; // Dark gradient for actual
                    
                    return (
                      <div
                        key={event.id}
                        className={`daily-event ${event.type} ${event.completed ? 'completed' : ''}`}
                        style={{
                          ...position,
                          borderLeftColor: baseColor,
                          background: background
                        }}
                        onClick={() => {
                          if (isPlanned) {
                            setSelectedEventForCompletion(event);
                            setShowCompletionModal(true);
                          }
                        }}
                        title={isPlanned ? 'Click to mark as complete or edit' : ''}
                      >
                        <div className="event-time">
                          {new Date(event.startDateTime).toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' })}
                        </div>
                        <div className="event-title">
                          {event.title}
                          {event.completionStatus === 'completed_on_time' && ' ‚úÖ'}
                          {event.completionStatus === 'completed_late' && ' ‚ö†Ô∏è'}
                          {event.completionStatus === 'incomplete' && ' ‚ùå'}
                        </div>
                        {event.location && <div className="event-location">üìç {event.location}</div>}
                      </div>
                    );
                  })}
                </div>
              </div>
            </div>
          </div>
        );
      };

      const DailyTodoListView = () => {
        const year = currentDate.getFullYear();
        const month = currentDate.getMonth();
        const day = currentDate.getDate();

        const getEventsForDay = () => {
          return events.filter(e => {
            const eventDate = new Date(e.startDateTime);
            return eventDate.getDate() === day && 
                   eventDate.getMonth() === month && 
                   eventDate.getFullYear() === year;
          }).sort((a, b) => new Date(a.startDateTime) - new Date(b.startDateTime));
        };

        const dayEvents = getEventsForDay();
        const plannedEvents = dayEvents.filter(e => e.type === 'planned');
        const completedOnTime = plannedEvents.filter(e => e.completionStatus === 'completed_on_time');
        const completedLate = plannedEvents.filter(e => e.completionStatus === 'completed_late');
        const incomplete = plannedEvents.filter(e => e.completionStatus === 'incomplete');
        const pending = plannedEvents.filter(e => !e.completed);

        // Get late reasons summary
        const lateReasons = events.filter(e => e.completionStatus === 'completed_late' && e.lateReason).map(e => ({
          title: e.title,
          reason: e.lateReason,
          date: new Date(e.startDateTime)
        })).sort((a, b) => b.date - a.date).slice(0, 5);

        return (
          <div style={{ display: 'flex', flexDirection: 'column', gap: '24px' }}>
            {/* Late Reasons Summary */}
            {lateReasons.length > 0 && (
              <div className="sync-section" style={{ padding: '20px' }}>
                <h3 style={{ marginBottom: '16px', color: '#2d5a3d', fontSize: '16px' }}>
                  ‚ö†Ô∏è Recent Delay Reasons
                </h3>
                <div style={{ display: 'flex', flexDirection: 'column', gap: '12px' }}>
                  {lateReasons.map((item, index) => (
                    <div key={index} style={{ 
                      padding: '12px', 
                      background: '#fff3e0', 
                      borderRadius: '8px',
                      borderLeft: '4px solid #f57c00'
                    }}>
                      <div style={{ fontWeight: 600, color: '#2d5a3d', fontSize: '14px', marginBottom: '4px' }}>
                        {item.title}
                      </div>
                      <div style={{ fontSize: '13px', color: '#6b9b7a', marginBottom: '6px' }}>
                        {item.date.toLocaleDateString()}
                      </div>
                      <div style={{ fontSize: '13px', color: '#f57c00' }}>
                        "{item.reason}"
                      </div>
                    </div>
                  ))}
                </div>
              </div>
            )}

            {/* Pending Tasks */}
            {pending.length > 0 && (
              <div className="sync-section" style={{ padding: '20px' }}>
                <h3 style={{ marginBottom: '16px', color: '#2d5a3d', fontSize: '16px' }}>
                  üìã Pending Tasks ({pending.length})
                </h3>
                <div style={{ display: 'flex', flexDirection: 'column', gap: '8px' }}>
                  {pending.map(event => {
                    const category = categories.find(c => c.id === event.categoryId);
                    return (
                      <div 
                        key={event.id} 
                        style={{ 
                          padding: '12px', 
                          background: 'white', 
                          borderRadius: '8px',
                          borderLeft: `4px solid ${category?.color}`,
                          cursor: 'pointer',
                          transition: 'all 0.2s'
                        }}
                        onClick={() => {
                          setSelectedEventForCompletion(event);
                          setShowCompletionModal(true);
                        }}
                        onMouseEnter={e => e.currentTarget.style.background = '#f5f7f5'}
                        onMouseLeave={e => e.currentTarget.style.background = 'white'}
                      >
                        <div style={{ fontWeight: 600, color: '#2d5a3d', marginBottom: '4px' }}>
                          {event.title}
                        </div>
                        <div style={{ fontSize: '13px', color: '#6b9b7a' }}>
                          {new Date(event.startDateTime).toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' })} - {new Date(event.endDateTime).toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' })}
                        </div>
                      </div>
                    );
                  })}
                </div>
              </div>
            )}

            {/* Completed On Time */}
            {completedOnTime.length > 0 && (
              <div className="sync-section" style={{ padding: '20px' }}>
                <h3 style={{ marginBottom: '16px', color: '#2d5a3d', fontSize: '16px' }}>
                  ‚úÖ Completed On Time ({completedOnTime.length})
                </h3>
                <div style={{ display: 'flex', flexDirection: 'column', gap: '8px' }}>
                  {completedOnTime.map(event => {
                    const category = categories.find(c => c.id === event.categoryId);
                    return (
                      <div 
                        key={event.id} 
                        style={{ 
                          padding: '12px', 
                          background: '#e8f5e9', 
                          borderRadius: '8px',
                          borderLeft: `4px solid ${category?.color}`
                        }}
                      >
                        <div style={{ fontWeight: 600, color: '#2d5a3d', marginBottom: '4px' }}>
                          {event.title}
                        </div>
                        <div style={{ fontSize: '13px', color: '#6b9b7a' }}>
                          {new Date(event.startDateTime).toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' })} - {new Date(event.endDateTime).toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' })}
                        </div>
                      </div>
                    );
                  })}
                </div>
              </div>
            )}

            {/* Completed Late */}
            {completedLate.length > 0 && (
              <div className="sync-section" style={{ padding: '20px' }}>
                <h3 style={{ marginBottom: '16px', color: '#2d5a3d', fontSize: '16px' }}>
                  ‚ö†Ô∏è Completed Late ({completedLate.length})
                </h3>
                <div style={{ display: 'flex', flexDirection: 'column', gap: '8px' }}>
                  {completedLate.map(event => {
                    const category = categories.find(c => c.id === event.categoryId);
                    return (
                      <div 
                        key={event.id} 
                        style={{ 
                          padding: '12px', 
                          background: '#fff3e0', 
                          borderRadius: '8px',
                          borderLeft: `4px solid ${category?.color}`
                        }}
                      >
                        <div style={{ fontWeight: 600, color: '#2d5a3d', marginBottom: '4px' }}>
                          {event.title}
                        </div>
                        <div style={{ fontSize: '13px', color: '#6b9b7a', marginBottom: '4px' }}>
                          Planned: {new Date(event.startDateTime).toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' })} - {new Date(event.endDateTime).toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' })}
                        </div>
                        {event.lateReason && (
                          <div style={{ fontSize: '12px', color: '#f57c00', fontStyle: 'italic' }}>
                            Reason: {event.lateReason}
                          </div>
                        )}
                      </div>
                    );
                  })}
                </div>
              </div>
            )}

            {/* Incomplete */}
            {incomplete.length > 0 && (
              <div className="sync-section" style={{ padding: '20px' }}>
                <h3 style={{ marginBottom: '16px', color: '#2d5a3d', fontSize: '16px' }}>
                  ‚ùå Not Completed ({incomplete.length})
                </h3>
                <div style={{ display: 'flex', flexDirection: 'column', gap: '8px' }}>
                  {incomplete.map(event => {
                    const category = categories.find(c => c.id === event.categoryId);
                    return (
                      <div 
                        key={event.id} 
                        style={{ 
                          padding: '12px', 
                          background: '#ffebee', 
                          borderRadius: '8px',
                          borderLeft: `4px solid ${category?.color}`
                        }}
                      >
                        <div style={{ fontWeight: 600, color: '#2d5a3d', marginBottom: '4px' }}>
                          {event.title}
                        </div>
                        <div style={{ fontSize: '13px', color: '#6b9b7a' }}>
                          {new Date(event.startDateTime).toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' })} - {new Date(event.endDateTime).toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' })}
                        </div>
                        {event.incompleteReason && (
                          <div style={{ fontSize: '12px', color: '#c62828', fontStyle: 'italic', marginTop: '4px' }}>
                            Reason: {event.incompleteReason.replace(/_/g, ' ')}
                          </div>
                        )}
                      </div>
                    );
                  })}
                </div>
              </div>
            )}

            {plannedEvents.length === 0 && (
              <div className="placeholder-view">
                <p style={{ color: '#6b9b7a' }}>
                  No planned events for this day
                </p>
              </div>
            )}
          </div>
        );
      };

      const WeeklyView = () => {
        const getWeekDates = () => {
          const curr = new Date(currentDate);
          const first = curr.getDate() - curr.getDay() + 1; // Monday
          const dates = [];
          
          for (let i = 0; i < 7; i++) {
            const date = new Date(curr.setDate(first + i));
            dates.push(new Date(date));
          }
          return dates;
        };

        const weekDates = getWeekDates();

        const getEventsForDate = (date, type) => {
          return events.filter(e => {
            const eventDate = new Date(e.startDateTime);
            return eventDate.toDateString() === date.toDateString() && e.type === type;
          }).sort((a, b) => new Date(a.startDateTime) - new Date(b.startDateTime));
        };

        const handleDayClick = (date) => {
          setCurrentDate(date);
          setView('daily');
        };

        // Get weekly data and comparison
        const weekData = getCurrentWeekData();
        const hasReflection = weekData.goal || weekData.highlight || weekData.lowlight;
        const comparison = getWeekComparison();

        return (
          <div className="weekly-calendar">
            {/* Weekly Reflection Panel */}
            <div style={{
              background: 'linear-gradient(135deg, #f0f9f4 0%, #e0f0e8 100%)',
              borderRadius: '16px',
              padding: '24px',
              marginBottom: '24px',
              border: '2px solid #4a7c59',
              boxShadow: '0 4px 15px rgba(74, 124, 89, 0.1)'
            }}>
              <div style={{
                display: 'flex',
                alignItems: 'center',
                justifyContent: 'space-between',
                marginBottom: hasReflection ? '20px' : '0'
              }}>
                <h3 style={{
                  fontSize: '20px',
                  color: '#2d5a3d',
                  margin: 0,
                  display: 'flex',
                  alignItems: 'center',
                  gap: '10px'
                }}>
                  <span>‚ú®</span>
                  <span>This Week's Focus</span>
                </h3>
                <button
                  onClick={() => setShowWeeklyReflectionModal(true)}
                  style={{
                    background: 'white',
                    color: '#4a7c59',
                    border: '2px solid #4a7c59',
                    padding: '8px 16px',
                    borderRadius: '8px',
                    cursor: 'pointer',
                    fontSize: '13px',
                    fontWeight: '600',
                    display: 'flex',
                    alignItems: 'center',
                    gap: '6px',
                    transition: 'all 0.2s'
                  }}
                  onMouseEnter={e => {
                    e.target.style.background = '#4a7c59';
                    e.target.style.color = 'white';
                  }}
                  onMouseLeave={e => {
                    e.target.style.background = 'white';
                    e.target.style.color = '#4a7c59';
                  }}
                >
                  <span>{hasReflection ? '‚úèÔ∏è' : '‚ûï'}</span>
                  <span>{hasReflection ? 'Edit' : 'Add'} Reflection</span>
                </button>
              </div>
              
              {hasReflection ? (
                <div style={{
                  display: 'grid',
                  gridTemplateColumns: 'repeat(auto-fit, minmax(250px, 1fr))',
                  gap: '16px'
                }}>
                  {weekData.goal && (
                    <div style={{
                      background: 'white',
                      padding: '16px',
                      borderRadius: '12px',
                      border: '2px solid #e8f5eb',
                      boxShadow: '0 2px 8px rgba(0,0,0,0.05)'
                    }}>
                      <div style={{ fontSize: '24px', marginBottom: '8px' }}>üéØ</div>
                      <div style={{
                        fontSize: '11px',
                        color: '#6b9b7a',
                        fontWeight: '600',
                        textTransform: 'uppercase',
                        letterSpacing: '0.5px',
                        marginBottom: '8px'
                      }}>
                        Weekly Goal
                      </div>
                      <div style={{
                        fontSize: '14px',
                        color: '#2d5a3d',
                        fontWeight: '500',
                        lineHeight: '1.5'
                      }}>
                        {weekData.goal}
                      </div>
                    </div>
                  )}
                  
                  {weekData.highlight && (
                    <div style={{
                      background: 'white',
                      padding: '16px',
                      borderRadius: '12px',
                      border: '2px solid #e8f5eb',
                      boxShadow: '0 2px 8px rgba(0,0,0,0.05)'
                    }}>
                      <div style={{ fontSize: '24px', marginBottom: '8px' }}>‚≠ê</div>
                      <div style={{
                        fontSize: '11px',
                        color: '#6b9b7a',
                        fontWeight: '600',
                        textTransform: 'uppercase',
                        letterSpacing: '0.5px',
                        marginBottom: '8px'
                      }}>
                        Highlight
                      </div>
                      <div style={{
                        fontSize: '14px',
                        color: '#2d5a3d',
                        fontWeight: '500',
                        lineHeight: '1.5'
                      }}>
                        {weekData.highlight}
                      </div>
                    </div>
                  )}
                  
                  {weekData.lowlight && (
                    <div style={{
                      background: 'white',
                      padding: '16px',
                      borderRadius: '12px',
                      border: '2px solid #e8f5eb',
                      boxShadow: '0 2px 8px rgba(0,0,0,0.05)'
                    }}>
                      <div style={{ fontSize: '24px', marginBottom: '8px' }}>üìâ</div>
                      <div style={{
                        fontSize: '11px',
                        color: '#6b9b7a',
                        fontWeight: '600',
                        textTransform: 'uppercase',
                        letterSpacing: '0.5px',
                        marginBottom: '8px'
                      }}>
                        Challenge
                      </div>
                      <div style={{
                        fontSize: '14px',
                        color: '#2d5a3d',
                        fontWeight: '500',
                        lineHeight: '1.5'
                      }}>
                        {weekData.lowlight}
                      </div>
                    </div>
                  )}
                </div>
              ) : (
                <div style={{ textAlign: 'center', padding: '20px 0' }}>
                  <p style={{ fontSize: '14px', color: '#6b9b7a', margin: 0 }}>
                    Click "Add Reflection" to set your weekly goal and track your progress
                  </p>
                </div>
              )}
            </div>

            {/* Week Comparison Card */}
            <div style={{
              background: 'white',
              borderRadius: '12px',
              padding: '20px',
              marginBottom: '24px',
              border: '2px solid #e8f5eb',
              boxShadow: '0 4px 15px rgba(0,0,0,0.05)'
            }}>
              <h4 style={{ 
                fontSize: '16px', 
                color: '#2d5a3d', 
                marginBottom: '16px',
                display: 'flex',
                alignItems: 'center',
                gap: '8px'
              }}>
                <span>üìä</span>
                <span>Week Comparison</span>
              </h4>
              
              <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(120px, 1fr))', gap: '12px' }}>
                <div style={{ textAlign: 'center', padding: '12px', background: '#f0f9f4', borderRadius: '8px' }}>
                  <div style={{ fontSize: '20px', fontWeight: '700', color: '#2196f3' }}>
                    {comparison.thisWeek}h
                  </div>
                  <div style={{ fontSize: '12px', color: '#6b9b7a', marginTop: '4px' }}>This Week</div>
                </div>
                
                <div style={{ textAlign: 'center', padding: '12px', background: '#f5f5f5', borderRadius: '8px' }}>
                  <div style={{ fontSize: '20px', fontWeight: '700', color: '#9e9e9e' }}>
                    {comparison.lastWeek}h
                  </div>
                  <div style={{ fontSize: '12px', color: '#6b9b7a', marginTop: '4px' }}>Last Week</div>
                </div>
                
                <div style={{ textAlign: 'center', padding: '12px', background: comparison.improved ? '#e8f5e9' : '#fff3e0', borderRadius: '8px' }}>
                  <div style={{ 
                    fontSize: '20px', 
                    fontWeight: '700', 
                    color: comparison.improved ? '#4caf50' : '#ff9800'
                  }}>
                    {comparison.improved ? '‚Üó' : '‚Üò'} {Math.abs(comparison.change)}%
                  </div>
                  <div style={{ fontSize: '12px', color: '#6b9b7a', marginTop: '4px' }}>Change</div>
                </div>
              </div>
              
              {comparison.improved && comparison.change > 0 && (
                <div style={{
                  marginTop: '12px',
                  padding: '10px',
                  background: '#e8f5e9',
                  borderRadius: '6px',
                  textAlign: 'center',
                  border: '1px solid #4caf50'
                }}>
                  <p style={{ fontSize: '13px', color: '#2e7d32', margin: 0, fontWeight: '500' }}>
                    üéâ Great progress! You're {Math.abs(comparison.change)}% more productive this week!
                  </p>
                </div>
              )}
            </div>

            <div style={{ 
              background: 'white',
              borderRadius: '12px',
              padding: '24px',
              boxShadow: '0 2px 8px rgba(0, 0, 0, 0.05)'
            }}>
              {/* Planned Section */}
              <div style={{ marginBottom: '32px' }}>
                <div style={{
                  padding: '12px 16px',
                  background: 'linear-gradient(135deg, #e8f5eb 0%, #d4e8d9 100%)',
                  borderRadius: '8px',
                  marginBottom: '16px',
                  border: '2px dashed #4a7c59',
                  display: 'flex',
                  alignItems: 'center',
                  justifyContent: 'center',
                  gap: '8px'
                }}>
                  <span style={{ fontSize: '16px', fontWeight: 600, color: '#2d5a3d' }}>
                    üìã Planned Events
                  </span>
                </div>

                <div style={{ 
                  display: 'grid',
                  gridTemplateColumns: 'repeat(7, 1fr)',
                  gap: '8px',
                  marginBottom: '12px'
                }}>
                  {['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'].map(day => (
                    <div key={day} className="calendar-day-header">{day}</div>
                  ))}
                </div>

                <div style={{
                  display: 'grid',
                  gridTemplateColumns: 'repeat(7, 1fr)',
                  gap: '8px'
                }}>
                  {weekDates.map((date, index) => {
                    const dayEvents = getEventsForDate(date, 'planned');
                    const isToday = date.toDateString() === new Date().toDateString();

                    return (
                      <div
                        key={index}
                        className={`calendar-day ${isToday ? 'today' : ''}`}
                        style={{ minHeight: '120px', cursor: 'pointer' }}
                        onClick={() => handleDayClick(date)}
                      >
                        <div className="day-number">{date.getDate()}</div>
                        <div className="day-events">
                          {dayEvents.slice(0, 3).map(event => {
                            const category = categories.find(c => c.id === event.categoryId);
                            const baseColor = category?.color || '#4a7c59';
                            return (
                              <div
                                key={event.id}
                                className="event-item planned"
                                style={{ 
                                  borderLeftColor: baseColor,
                                  background: `linear-gradient(135deg, ${baseColor}20 0%, ${baseColor}40 100%)`,
                                  borderStyle: 'dashed'
                                }}
                                title={`${event.title} - planned`}
                              >
                                <div style={{ fontSize: '10px', marginBottom: '2px', opacity: 0.8 }}>
                                  {new Date(event.startDateTime).toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' })}
                                </div>
                                <div style={{ 
                                  overflow: 'hidden', 
                                  textOverflow: 'ellipsis',
                                  textDecoration: event.completed ? 'line-through' : 'none'
                                }}>
                                  {event.title}
                                  {event.completionStatus === 'completed_on_time' && ' ‚úÖ'}
                                  {event.completionStatus === 'completed_late' && ' ‚ö†Ô∏è'}
                                  {event.completionStatus === 'incomplete' && ' ‚ùå'}
                                </div>
                              </div>
                            );
                          })}
                          {dayEvents.length > 3 && (
                            <div className="more-events">+{dayEvents.length - 3} more</div>
                          )}
                        </div>
                      </div>
                    );
                  })}
                </div>
              </div>

              {/* Actual Section */}
              <div>
                <div style={{
                  padding: '12px 16px',
                  background: 'linear-gradient(135deg, #f0f9f4 0%, #e0f0e8 100%)',
                  borderRadius: '8px',
                  marginBottom: '16px',
                  border: '2px solid #6b9b7a',
                  display: 'flex',
                  alignItems: 'center',
                  justifyContent: 'center',
                  gap: '8px'
                }}>
                  <span style={{ fontSize: '16px', fontWeight: 600, color: '#4a7c59' }}>
                    ‚úÖ Actual Events
                  </span>
                </div>

                <div style={{ 
                  display: 'grid',
                  gridTemplateColumns: 'repeat(7, 1fr)',
                  gap: '8px',
                  marginBottom: '12px'
                }}>
                  {['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'].map(day => (
                    <div key={day} className="calendar-day-header">{day}</div>
                  ))}
                </div>

                <div style={{
                  display: 'grid',
                  gridTemplateColumns: 'repeat(7, 1fr)',
                  gap: '8px'
                }}>
                  {weekDates.map((date, index) => {
                    const dayEvents = getEventsForDate(date, 'actual');
                    const isToday = date.toDateString() === new Date().toDateString();

                    return (
                      <div
                        key={index}
                        className={`calendar-day ${isToday ? 'today' : ''}`}
                        style={{ minHeight: '120px', cursor: 'pointer' }}
                        onClick={() => handleDayClick(date)}
                      >
                        <div className="day-number">{date.getDate()}</div>
                        <div className="day-events">
                          {dayEvents.slice(0, 3).map(event => {
                            const category = categories.find(c => c.id === event.categoryId);
                            const baseColor = category?.color || '#4a7c59';
                            return (
                              <div
                                key={event.id}
                                className="event-item actual"
                                style={{ 
                                  borderLeftColor: baseColor,
                                  background: `linear-gradient(135deg, ${baseColor}B0 0%, ${baseColor}D0 100%)`,
                                  borderStyle: 'solid'
                                }}
                                title={`${event.title} - actual`}
                              >
                                <div style={{ fontSize: '10px', marginBottom: '2px', opacity: 0.8 }}>
                                  {new Date(event.startDateTime).toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' })}
                                </div>
                                <div style={{ overflow: 'hidden', textOverflow: 'ellipsis' }}>
                                  {event.title}
                                  {event.completionStatus === 'completed_on_time' && ' ‚úÖ'}
                                  {event.completionStatus === 'completed_late' && ' ‚ö†Ô∏è'}
                                  {event.completionStatus === 'incomplete' && ' ‚ùå'}
                                </div>
                              </div>
                            );
                          })}
                          {dayEvents.length > 3 && (
                            <div className="more-events">+{dayEvents.length - 3} more</div>
                          )}
                        </div>
                      </div>
                    );
                  })}
                </div>
              </div>
            </div>
          </div>
        );
      };

      const MonthlyView = () => {
        const year = currentDate.getFullYear();
        const month = currentDate.getMonth();
        const firstDay = new Date(year, month, 1);
        const lastDay = new Date(year, month + 1, 0);
        const startingDayOfWeek = firstDay.getDay();
        const daysInMonth = lastDay.getDate();

        const days = [];
        for (let i = 0; i < startingDayOfWeek; i++) {
          days.push(null);
        }
        for (let i = 1; i <= daysInMonth; i++) {
          days.push(i);
        }

        const getEventsForDay = (day) => {
          if (!day) return [];
          const date = new Date(year, month, day);
          return events.filter(e => {
            const eventDate = new Date(e.startDateTime);
            return eventDate.getDate() === day && 
                   eventDate.getMonth() === month && 
                   eventDate.getFullYear() === year;
          });
        };

        return (
          <div className="calendar-grid">
            <div className="calendar-header">
              {['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'].map(day => (
                <div key={day} className="calendar-day-header">{day}</div>
              ))}
            </div>
            <div className="calendar-body">
              {days.map((day, index) => {
                const dayEvents = getEventsForDay(day);
                const isToday = day && 
                  day === new Date().getDate() && 
                  month === new Date().getMonth() && 
                  year === new Date().getFullYear();

                return (
                  <div 
                    key={index} 
                    className={`calendar-day ${!day ? 'empty' : ''} ${isToday ? 'today' : ''}`}
                    onClick={() => {
                      if (day) {
                        const newDate = new Date(year, month, day);
                        setCurrentDate(newDate);
                        setView('daily');
                      }
                    }}
                  >
                    {day && (
                      <>
                        <div className="day-number">{day}</div>
                        <div className="day-events">
                          {dayEvents.slice(0, 3).map(event => {
                            const category = categories.find(c => c.id === event.categoryId);
                            return (
                              <div 
                                key={event.id} 
                                className={`event-item ${event.type}`}
                                style={{ borderLeftColor: category?.color }}
                                title={`${event.title} - ${event.type}`}
                              >
                                {event.title}
                              </div>
                            );
                          })}
                          {dayEvents.length > 3 && (
                            <div className="more-events">+{dayEvents.length - 3} more</div>
                          )}
                        </div>
                      </>
                    )}
                  </div>
                );
              })}
            </div>
          </div>
        );
      };

      const ProjectTimelineView = () => {
        const today = new Date();
        const currentYear = today.getFullYear();
        const [hoveredProject, setHoveredProject] = React.useState(null);
        
        // Calculate year start and end for timeline
        const yearStart = new Date(currentYear, 0, 1);
        const yearEnd = new Date(currentYear, 11, 31);
        const yearDays = Math.ceil((yearEnd - yearStart) / (1000 * 60 * 60 * 24));
        
        // Generate month markers for timeline
        const monthMarkers = Array.from({ length: 12 }, (_, i) => {
          const date = new Date(currentYear, i, 1);
          const dayOfYear = Math.ceil((date - yearStart) / (1000 * 60 * 60 * 24));
          const monthName = date.toLocaleDateString('en-US', { month: 'short' });
          return { dayOfYear, monthName };
        });
        
        const calculateProgress = (projectId) => {
          const project = yearlyProjects.find(p => p.id === projectId);
          if (!project) return null;
          
          // Calculate year-to-date actual hours
          const yearToDate = new Date(currentYear, 0, 1);
          const actualEvents = events.filter(e => 
            e.type === 'actual' &&
            e.projectId === projectId &&
            new Date(e.startDateTime) >= yearToDate &&
            new Date(e.startDateTime) <= today
          );
          
          const actualHours = actualEvents.reduce((sum, e) => {
            const duration = (new Date(e.endDateTime) - new Date(e.startDateTime)) / (1000 * 60 * 60);
            return sum + duration;
          }, 0);
          
          const plannedHours = project.plannedHours || 100;
          const percentage = Math.min(100, Math.round((actualHours / plannedHours) * 100));
          
          return {
            actualHours: Math.round(actualHours * 10) / 10,
            plannedHours,
            percentage,
            remaining: Math.max(0, plannedHours - actualHours)
          };
        };
        
        return (
          <div style={{ 
            padding: '30px 20px', 
            maxWidth: '1400px', 
            margin: '0 auto',
            minHeight: '100vh'
          }}>
            {/* Beautiful Header Banner */}
            <div style={{ 
              textAlign: 'center', 
              marginBottom: '50px',
              padding: '50px 40px',
              background: 'linear-gradient(135deg, #2d5a3d 0%, #4a7c59 50%, #6b9b7a 100%)',
              borderRadius: '20px',
              boxShadow: '0 10px 40px rgba(74, 124, 89, 0.3)',
              position: 'relative',
              overflow: 'hidden'
            }}>
              {/* Decorative circles */}
              <div style={{
                position: 'absolute',
                top: '-50px',
                right: '-50px',
                width: '200px',
                height: '200px',
                background: 'rgba(255, 255, 255, 0.1)',
                borderRadius: '50%',
                filter: 'blur(40px)'
              }} />
              <div style={{
                position: 'absolute',
                bottom: '-30px',
                left: '-30px',
                width: '150px',
                height: '150px',
                background: 'rgba(255, 255, 255, 0.08)',
                borderRadius: '50%',
                filter: 'blur(30px)'
              }} />
              
              <div style={{ position: 'relative', zIndex: 1 }}>
                <h2 style={{ 
                  fontSize: '42px', 
                  color: 'white', 
                  marginBottom: '16px',
                  fontWeight: '700',
                  textShadow: '0 2px 10px rgba(0,0,0,0.2)',
                  letterSpacing: '-0.5px'
                }}>
                  üìä Project Timeline {currentYear}
                </h2>
                <p style={{ 
                  fontSize: '18px', 
                  color: 'rgba(255, 255, 255, 0.95)',
                  fontWeight: '400',
                  marginBottom: '0',
                  textShadow: '0 1px 3px rgba(0,0,0,0.1)'
                }}>
                  Track your yearly goals with beautiful visual insights
                </p>
              </div>
              
              {yearlyProjects.length === 0 && (
                <div style={{
                  marginTop: '30px',
                  padding: '30px',
                  background: 'rgba(255, 255, 255, 0.95)',
                  borderRadius: '16px',
                  border: 'none',
                  boxShadow: '0 4px 20px rgba(0,0,0,0.1)'
                }}>
                  <div style={{ fontSize: '48px', marginBottom: '16px' }}>üéØ</div>
                  <p style={{ 
                    color: '#2d5a3d', 
                    marginBottom: '20px',
                    fontSize: '16px',
                    fontWeight: '500'
                  }}>
                    Start your journey! Add up to 3 yearly projects to track your progress
                  </p>
                  <button 
                    onClick={() => setShowProjectModal(true)}
                    style={{
                      background: 'linear-gradient(135deg, #4a7c59 0%, #3d6b4a 100%)',
                      color: 'white',
                      border: 'none',
                      padding: '14px 32px',
                      borderRadius: '10px',
                      cursor: 'pointer',
                      fontSize: '16px',
                      fontWeight: '600',
                      boxShadow: '0 4px 15px rgba(74, 124, 89, 0.4)',
                      transition: 'all 0.3s ease',
                      transform: 'translateY(0)'
                    }}
                    onMouseEnter={e => {
                      e.target.style.transform = 'translateY(-2px)';
                      e.target.style.boxShadow = '0 6px 20px rgba(74, 124, 89, 0.5)';
                    }}
                    onMouseLeave={e => {
                      e.target.style.transform = 'translateY(0)';
                      e.target.style.boxShadow = '0 4px 15px rgba(74, 124, 89, 0.4)';
                    }}
                  >
                    ‚ú® Create Your First Project
                  </button>
                </div>
              )}
            </div>
            
            {yearlyProjects.length > 0 && (
              <div style={{ 
                background: 'white', 
                borderRadius: '20px', 
                padding: '40px',
                boxShadow: '0 10px 40px rgba(0,0,0,0.08)',
                border: '1px solid rgba(107, 155, 122, 0.1)'
              }}>
                {/* Timeline Header with icons */}
                <div style={{ 
                  display: 'grid',
                  gridTemplateColumns: '280px 1fr 200px',
                  gap: '30px',
                  marginBottom: '30px',
                  paddingBottom: '20px',
                  borderBottom: '3px solid #e8f5eb'
                }}>
                  <div style={{ 
                    fontWeight: '700', 
                    color: '#2d5a3d', 
                    fontSize: '13px',
                    letterSpacing: '1px',
                    textTransform: 'uppercase',
                    display: 'flex',
                    alignItems: 'center',
                    gap: '8px'
                  }}>
                    <span style={{ fontSize: '16px' }}>üéØ</span>
                    PROJECT
                  </div>
                  <div style={{ 
                    fontWeight: '700', 
                    color: '#2d5a3d', 
                    fontSize: '13px',
                    letterSpacing: '1px',
                    textTransform: 'uppercase',
                    display: 'flex',
                    alignItems: 'center',
                    gap: '8px'
                  }}>
                    <span style={{ fontSize: '16px' }}>üìÖ</span>
                    TIMELINE {currentYear}
                  </div>
                  <div style={{ 
                    fontWeight: '700', 
                    color: '#2d5a3d', 
                    fontSize: '13px',
                    textAlign: 'center',
                    letterSpacing: '1px',
                    textTransform: 'uppercase',
                    display: 'flex',
                    alignItems: 'center',
                    justifyContent: 'center',
                    gap: '8px'
                  }}>
                    <span style={{ fontSize: '16px' }}>üìä</span>
                    PROGRESS
                  </div>
                </div>
                
                {/* Month markers with better styling */}
                <div style={{ 
                  display: 'grid',
                  gridTemplateColumns: '280px 1fr 200px',
                  gap: '30px',
                  marginBottom: '10px'
                }}>
                  <div></div>
                  <div style={{ position: 'relative', height: '24px' }}>
                    {monthMarkers.map((marker, idx) => (
                      <div
                        key={idx}
                        style={{
                          position: 'absolute',
                          left: `${(marker.dayOfYear / yearDays) * 100}%`,
                          fontSize: '11px',
                          color: '#6b9b7a',
                          transform: 'translateX(-50%)',
                          whiteSpace: 'nowrap',
                          fontWeight: '600',
                          background: 'white',
                          padding: '2px 6px',
                          borderRadius: '4px'
                        }}
                      >
                        {marker.monthName}
                      </div>
                    ))}
                  </div>
                  <div></div>
                </div>
                
                {/* Project rows */}
                {yearlyProjects.map((project, idx) => {
                  const progress = calculateProgress(project.id);
                  const deadline = new Date(project.deadline);
                  const deadlineDayOfYear = Math.ceil((deadline - yearStart) / (1000 * 60 * 60 * 24));
                  const todayDayOfYear = Math.ceil((today - yearStart) / (1000 * 60 * 60 * 24));
                  const deadlinePosition = (deadlineDayOfYear / yearDays) * 100;
                  const todayPosition = (todayDayOfYear / yearDays) * 100;
                  
                  const daysUntilDeadline = Math.ceil((deadline - today) / (1000 * 60 * 60 * 24));
                  const isOverdue = daysUntilDeadline < 0;
                  const isUrgent = daysUntilDeadline > 0 && daysUntilDeadline <= 30;
                  const isHovered = hoveredProject === project.id;
                  
                  return (
                    <div
                      key={project.id}
                      onMouseEnter={() => setHoveredProject(project.id)}
                      onMouseLeave={() => setHoveredProject(null)}
                      style={{
                        display: 'grid',
                        gridTemplateColumns: '280px 1fr 200px',
                        gap: '30px',
                        marginBottom: '30px',
                        padding: '24px',
                        background: isHovered 
                          ? 'linear-gradient(135deg, #f0f9f4 0%, #ffffff 100%)'
                          : 'linear-gradient(135deg, #fafbfc 0%, #ffffff 100%)',
                        borderRadius: '16px',
                        border: isHovered ? '2px solid #4a7c59' : '2px solid #e8f5eb',
                        boxShadow: isHovered 
                          ? '0 12px 40px rgba(74, 124, 89, 0.15)' 
                          : '0 4px 15px rgba(0,0,0,0.04)',
                        transition: 'all 0.3s cubic-bezier(0.4, 0, 0.2, 1)',
                        transform: isHovered ? 'translateY(-4px) scale(1.01)' : 'translateY(0) scale(1)',
                        cursor: 'pointer'
                      }}
                    >
                      {/* Project name with status badge */}
                      <div style={{ 
                        display: 'flex',
                        flexDirection: 'column',
                        justifyContent: 'center'
                      }}>
                        <div style={{ 
                          fontSize: '18px', 
                          fontWeight: '700', 
                          color: '#2d5a3d',
                          marginBottom: '12px',
                          display: 'flex',
                          alignItems: 'center',
                          gap: '8px'
                        }}>
                          <span>{project.name}</span>
                          {progress && progress.percentage >= 100 && (
                            <span style={{
                              fontSize: '11px',
                              background: 'linear-gradient(135deg, #4caf50 0%, #45a049 100%)',
                              color: 'white',
                              padding: '3px 8px',
                              borderRadius: '12px',
                              fontWeight: '600'
                            }}>
                              ‚úì DONE
                            </span>
                          )}
                        </div>
                        
                        {/* Status badge */}
                        <div style={{
                          display: 'inline-flex',
                          alignItems: 'center',
                          gap: '6px',
                          padding: '6px 12px',
                          borderRadius: '8px',
                          fontSize: '12px',
                          fontWeight: '600',
                          background: isOverdue 
                            ? 'linear-gradient(135deg, #ffebee 0%, #ffcdd2 100%)' 
                            : isUrgent 
                              ? 'linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%)'
                              : 'linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%)',
                          color: isOverdue ? '#d32f2f' : isUrgent ? '#f57c00' : '#2e7d32',
                          width: 'fit-content',
                          boxShadow: isOverdue 
                            ? '0 2px 8px rgba(244, 67, 54, 0.2)' 
                            : isUrgent 
                              ? '0 2px 8px rgba(255, 152, 0, 0.2)'
                              : '0 2px 8px rgba(76, 175, 80, 0.2)'
                        }}>
                          {isOverdue ? (
                            <>
                              <span>‚ö†Ô∏è</span>
                              <span>Overdue by {Math.abs(daysUntilDeadline)} days</span>
                            </>
                          ) : isUrgent ? (
                            <>
                              <span>üî•</span>
                              <span>{daysUntilDeadline} days left</span>
                            </>
                          ) : (
                            <>
                              <span>‚úì</span>
                              <span>{daysUntilDeadline} days remaining</span>
                            </>
                          )}
                        </div>
                      </div>
                      
                      {/* Enhanced Timeline bar */}
                      <div style={{ 
                        position: 'relative',
                        height: '60px',
                        display: 'flex',
                        alignItems: 'center',
                        padding: '5px 0'
                      }}>
                        {/* Background timeline with subtle pattern */}
                        <div style={{
                          position: 'absolute',
                          left: 0,
                          right: 0,
                          height: '12px',
                          background: 'linear-gradient(135deg, #e8f5eb 0%, #d4e9d9 100%)',
                          borderRadius: '6px',
                          boxShadow: 'inset 0 2px 4px rgba(0,0,0,0.05)'
                        }} />
                        
                        {/* Glossy progress bar */}
                        <div style={{
                          position: 'absolute',
                          left: 0,
                          width: `${deadlinePosition}%`,
                          height: '12px',
                          background: progress ? 
                            `linear-gradient(135deg, 
                              ${progress.percentage >= 100 ? '#4caf50' : 
                                progress.percentage >= 75 ? '#8bc34a' :
                                progress.percentage >= 50 ? '#ffc107' : '#ff9800'} 0%, 
                              ${progress.percentage >= 100 ? '#66bb6a' : 
                                progress.percentage >= 75 ? '#9ccc65' :
                                progress.percentage >= 50 ? '#ffca28' : '#ffa726'} 100%)` 
                            : 'transparent',
                          borderRadius: '6px',
                          boxShadow: progress ? '0 2px 8px rgba(0,0,0,0.15)' : 'none',
                          transition: 'all 0.3s ease',
                          overflow: 'hidden'
                        }}>
                          {/* Shine effect */}
                          {progress && (
                            <div style={{
                              position: 'absolute',
                              top: 0,
                              left: 0,
                              right: 0,
                              height: '50%',
                              background: 'linear-gradient(180deg, rgba(255,255,255,0.4) 0%, transparent 100%)',
                              borderRadius: '6px 6px 0 0'
                            }} />
                          )}
                          {/* Progress fill */}
                          <div style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            bottom: 0,
                            width: `${progress ? (progress.actualHours / progress.plannedHours) * 100 : 0}%`,
                            background: progress && progress.percentage >= 100 ? '#2e7d32' : 
                                       progress && progress.percentage >= 75 ? '#7cb342' :
                                       progress && progress.percentage >= 50 ? '#fbc02d' : '#f57c00',
                            transition: 'width 0.5s ease'
                          }} />
                        </div>
                        
                        {/* Today marker with pulse */}
                        <div style={{
                          position: 'absolute',
                          left: `${todayPosition}%`,
                          width: '3px',
                          height: '28px',
                          background: 'linear-gradient(180deg, #1b5e20 0%, #2e7d32 100%)',
                          transform: 'translateX(-50%)',
                          zIndex: 3,
                          borderRadius: '2px',
                          boxShadow: '0 2px 8px rgba(27, 94, 32, 0.4)'
                        }}>
                          {/* Pulse animation */}
                          <div style={{
                            position: 'absolute',
                            top: '50%',
                            left: '50%',
                            transform: 'translate(-50%, -50%)',
                            width: '8px',
                            height: '8px',
                            background: '#2e7d32',
                            borderRadius: '50%',
                            animation: 'pulse 2s ease-in-out infinite'
                          }} />
                          <div style={{
                            position: 'absolute',
                            top: '-24px',
                            left: '50%',
                            transform: 'translateX(-50%)',
                            padding: '2px 8px',
                            background: 'linear-gradient(135deg, #1b5e20 0%, #2e7d32 100%)',
                            color: 'white',
                            fontSize: '10px',
                            fontWeight: '700',
                            whiteSpace: 'nowrap',
                            borderRadius: '4px',
                            boxShadow: '0 2px 6px rgba(0,0,0,0.2)'
                          }}>
                            TODAY
                          </div>
                        </div>
                        
                        {/* Enhanced Deadline marker */}
                        <div style={{
                          position: 'absolute',
                          left: `${deadlinePosition}%`,
                          width: '4px',
                          height: '28px',
                          background: isOverdue 
                            ? 'linear-gradient(180deg, #c62828 0%, #f44336 100%)'
                            : 'linear-gradient(180deg, #2e7d32 0%, #4caf50 100%)',
                          transform: 'translateX(-50%)',
                          zIndex: 3,
                          borderRadius: '2px',
                          boxShadow: isOverdue 
                            ? '0 2px 8px rgba(198, 40, 40, 0.4)'
                            : '0 2px 8px rgba(46, 125, 50, 0.4)'
                        }}>
                          <div style={{
                            position: 'absolute',
                            bottom: '-28px',
                            left: '50%',
                            transform: 'translateX(-50%)',
                            padding: '2px 8px',
                            background: isOverdue 
                              ? 'linear-gradient(135deg, #c62828 0%, #f44336 100%)'
                              : 'linear-gradient(135deg, #2e7d32 0%, #4caf50 100%)',
                            color: 'white',
                            fontSize: '10px',
                            fontWeight: '700',
                            whiteSpace: 'nowrap',
                            borderRadius: '4px',
                            boxShadow: '0 2px 6px rgba(0,0,0,0.2)'
                          }}>
                            {deadline.toLocaleDateString('en-US', { month: 'short', day: 'numeric' })}
                          </div>
                        </div>
                      </div>
                      
                      {/* Beautiful Progress stats card */}
                      <div style={{ 
                        display: 'flex',
                        flexDirection: 'column',
                        justifyContent: 'center',
                        alignItems: 'center',
                        padding: '16px',
                        background: progress && progress.percentage >= 100 
                          ? 'linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%)'
                          : progress && progress.percentage >= 75 
                            ? 'linear-gradient(135deg, #f1f8e9 0%, #dcedc8 100%)'
                            : progress && progress.percentage >= 50 
                              ? 'linear-gradient(135deg, #fffde7 0%, #fff9c4 100%)'
                              : 'linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%)',
                        borderRadius: '12px',
                        border: '2px solid ' + (
                          progress && progress.percentage >= 100 ? '#4caf50' :
                          progress && progress.percentage >= 75 ? '#8bc34a' :
                          progress && progress.percentage >= 50 ? '#ffc107' : '#ff9800'
                        ),
                        boxShadow: '0 4px 12px rgba(0,0,0,0.08)',
                        transition: 'all 0.3s ease'
                      }}>
                        <div style={{ 
                          fontSize: '32px', 
                          fontWeight: '800',
                          background: progress && progress.percentage >= 100 
                            ? 'linear-gradient(135deg, #2e7d32 0%, #4caf50 100%)'
                            : progress && progress.percentage >= 75 
                              ? 'linear-gradient(135deg, #558b2f 0%, #8bc34a 100%)'
                              : progress && progress.percentage >= 50 
                                ? 'linear-gradient(135deg, #f57f17 0%, #ffc107 100%)'
                                : 'linear-gradient(135deg, #e65100 0%, #ff9800 100%)',
                          WebkitBackgroundClip: 'text',
                          WebkitTextFillColor: 'transparent',
                          marginBottom: '8px'
                        }}>
                          {progress ? `${progress.percentage}%` : '0%'}
                        </div>
                        <div style={{ 
                          fontSize: '13px', 
                          color: '#2d5a3d',
                          textAlign: 'center',
                          fontWeight: '600'
                        }}>
                          {progress ? (
                            <>
                              <div style={{ fontSize: '15px', marginBottom: '4px' }}>
                                {progress.actualHours}h / {progress.plannedHours}h
                              </div>
                              <div style={{ 
                                fontSize: '11px', 
                                color: progress.remaining > 0 ? '#6b9b7a' : '#2e7d32',
                                fontWeight: progress.remaining > 0 ? '500' : '700'
                              }}>
                                {progress.remaining > 0 ? `${Math.round(progress.remaining)}h to go` : 'üéâ Complete!'}
                              </div>
                            </>
                          ) : (
                            <div style={{ color: '#9e9e9e' }}>No progress yet</div>
                          )}
                        </div>
                      </div>
                    </div>
                  );
                })}
              </div>
            )}
            
            {/* Enhanced Action buttons */}
            <div style={{
              marginTop: '40px',
              display: 'flex',
              gap: '16px',
              justifyContent: 'center',
              flexWrap: 'wrap'
            }}>
              <button
                onClick={() => setShowProjectModal(true)}
                style={{
                  background: 'linear-gradient(135deg, #4a7c59 0%, #3d6b4a 100%)',
                  color: 'white',
                  border: 'none',
                  padding: '14px 32px',
                  borderRadius: '12px',
                  cursor: 'pointer',
                  fontSize: '15px',
                  fontWeight: '600',
                  display: 'flex',
                  alignItems: 'center',
                  gap: '10px',
                  boxShadow: '0 6px 20px rgba(74, 124, 89, 0.3)',
                  transition: 'all 0.3s cubic-bezier(0.4, 0, 0.2, 1)',
                  transform: 'translateY(0)'
                }}
                onMouseEnter={e => {
                  e.target.style.transform = 'translateY(-3px) scale(1.05)';
                  e.target.style.boxShadow = '0 10px 30px rgba(74, 124, 89, 0.4)';
                }}
                onMouseLeave={e => {
                  e.target.style.transform = 'translateY(0) scale(1)';
                  e.target.style.boxShadow = '0 6px 20px rgba(74, 124, 89, 0.3)';
                }}
              >
                <span style={{ fontSize: '18px' }}>üéØ</span>
                <span>Manage Projects</span>
              </button>
              <button
                onClick={() => setView('yearly')}
                style={{
                  background: 'white',
                  color: '#4a7c59',
                  border: '2px solid #4a7c59',
                  padding: '14px 32px',
                  borderRadius: '12px',
                  cursor: 'pointer',
                  fontSize: '15px',
                  fontWeight: '600',
                  display: 'flex',
                  alignItems: 'center',
                  gap: '10px',
                  boxShadow: '0 4px 15px rgba(0,0,0,0.08)',
                  transition: 'all 0.3s cubic-bezier(0.4, 0, 0.2, 1)',
                  transform: 'translateY(0)'
                }}
                onMouseEnter={e => {
                  e.target.style.transform = 'translateY(-3px)';
                  e.target.style.background = 'linear-gradient(135deg, #f0f9f4 0%, #e0f0e8 100%)';
                  e.target.style.boxShadow = '0 6px 20px rgba(74, 124, 89, 0.15)';
                }}
                onMouseLeave={e => {
                  e.target.style.transform = 'translateY(0)';
                  e.target.style.background = 'white';
                  e.target.style.boxShadow = '0 4px 15px rgba(0,0,0,0.08)';
                }}
              >
                <span style={{ fontSize: '18px' }}>üìÖ</span>
                <span>View Year Calendar</span>
              </button>
            </div>
          </div>
        );
      };

      const YearView = () => {
        const year = currentDate.getFullYear();
        const months = Array.from({ length: 12 }, (_, i) => i);

        const calculateProjectProgress = (projectId) => {
          const project = yearlyProjects.find(p => p.id === projectId);
          if (!project) return null;

          // Calculate YTD (Year To Date) actual hours
          const yearStart = new Date(year, 0, 1);
          const now = new Date();
          
          const actualEvents = events.filter(e => 
            e.projectId === projectId && 
            e.type === 'actual' &&
            new Date(e.startDateTime) >= yearStart &&
            new Date(e.startDateTime) <= now
          );

          const actualMinutes = actualEvents.reduce((sum, event) => {
            const start = new Date(event.startDateTime);
            const end = new Date(event.endDateTime);
            return sum + (end - start) / (1000 * 60);
          }, 0);

          const actualHours = Math.round(actualMinutes / 60 * 10) / 10;
          const plannedHours = project.plannedHours || 0;
          const percentage = plannedHours > 0 ? Math.round((actualHours / plannedHours) * 100) : 0;

          return {
            ...project,
            actualHours,
            plannedHours,
            percentage
          };
        };

        const renderMiniMonth = (monthIndex) => {
          const firstDay = new Date(year, monthIndex, 1);
          const lastDay = new Date(year, monthIndex + 1, 0);
          const startingDayOfWeek = firstDay.getDay();
          const daysInMonth = lastDay.getDate();

          const days = [];
          for (let i = 0; i < startingDayOfWeek; i++) {
            days.push(null);
          }
          for (let i = 1; i <= daysInMonth; i++) {
            days.push(i);
          }

          const isCurrentMonth = monthIndex === new Date().getMonth() && year === new Date().getFullYear();

          return (
            <div 
              key={monthIndex} 
              style={{
                background: 'white',
                borderRadius: '8px',
                padding: '12px',
                boxShadow: '0 1px 3px rgba(0,0,0,0.1)',
                cursor: 'pointer',
                transition: 'all 0.2s'
              }}
              onClick={() => {
                const newDate = new Date(year, monthIndex, 1);
                setCurrentDate(newDate);
                setView('monthly');
              }}
              onMouseEnter={e => e.currentTarget.style.boxShadow = '0 3px 8px rgba(74, 124, 89, 0.2)'}
              onMouseLeave={e => e.currentTarget.style.boxShadow = '0 1px 3px rgba(0,0,0,0.1)'}
              title={`View ${new Date(year, monthIndex).toLocaleString('default', { month: 'long' })} calendar`}
            >
              <div style={{ 
                fontSize: '14px', 
                fontWeight: 600, 
                color: '#2d5a3d',
                marginBottom: '8px',
                textAlign: 'center'
              }}>
                {new Date(year, monthIndex).toLocaleString('default', { month: 'long' })}
              </div>
              <div style={{ 
                display: 'grid', 
                gridTemplateColumns: 'repeat(7, 1fr)',
                gap: '2px'
              }}>
                {['S', 'M', 'T', 'W', 'T', 'F', 'S'].map((d, i) => (
                  <div key={i} style={{ 
                    fontSize: '10px', 
                    color: '#6b9b7a', 
                    textAlign: 'center',
                    padding: '2px'
                  }}>
                    {d}
                  </div>
                ))}
                {days.map((day, index) => {
                  const isToday = day && 
                    day === new Date().getDate() && 
                    isCurrentMonth;

                  return (
                    <div
                      key={index}
                      style={{
                        fontSize: '11px',
                        textAlign: 'center',
                        padding: '4px 2px',
                        background: isToday ? '#4a7c59' : 'transparent',
                        color: isToday ? 'white' : (day ? '#2d5a3d' : 'transparent'),
                        borderRadius: '4px',
                        fontWeight: isToday ? '600' : 'normal'
                      }}
                    >
                      {day || ''}
                    </div>
                  );
                })}
              </div>
            </div>
          );
        };

        const projectProgress = yearlyProjects.map(p => calculateProjectProgress(p.id)).filter(Boolean);

        return (
          <div style={{ 
            display: 'grid', 
            gridTemplateColumns: '2fr 1fr', 
            gap: '24px',
            padding: '24px'
          }}>
            {/* Left: 12-month calendar grid */}
            <div>
              <h3 style={{ color: '#2d5a3d', marginBottom: '16px' }}>
                {year} Calendar
              </h3>
              <div style={{
                display: 'grid',
                gridTemplateColumns: 'repeat(4, 1fr)',
                gap: '16px'
              }}>
                {months.map(renderMiniMonth)}
              </div>
            </div>

            {/* Right: Project Progress */}
            <div>
              <h3 style={{ color: '#2d5a3d', marginBottom: '16px' }}>
                üìä Yearly Project Review
              </h3>
              
              {projectProgress.length === 0 && (
                <div style={{
                  background: '#f5f7f5',
                  padding: '20px',
                  borderRadius: '8px',
                  textAlign: 'center',
                  color: '#6b9b7a'
                }}>
                  <p>No yearly projects yet.</p>
                  <p style={{ fontSize: '13px', marginTop: '8px' }}>
                    Click üéØ to add projects and track your progress!
                  </p>
                </div>
              )}

              {projectProgress.map(project => (
                <div key={project.id} style={{
                  background: 'white',
                  borderRadius: '8px',
                  padding: '16px',
                  marginBottom: '16px',
                  boxShadow: '0 2px 4px rgba(0,0,0,0.05)'
                }}>
                  <div style={{ marginBottom: '12px' }}>
                    <div style={{ 
                      fontSize: '16px', 
                      fontWeight: 600, 
                      color: '#2d5a3d',
                      marginBottom: '4px'
                    }}>
                      {project.name}
                    </div>
                    <div style={{ fontSize: '12px', color: '#6b9b7a' }}>
                      Deadline: {project.deadline.toLocaleDateString()} ({getDaysUntil(project.deadline)} days left)
                    </div>
                  </div>

                  <div style={{ marginBottom: '8px' }}>
                    <div style={{ 
                      display: 'flex', 
                      justifyContent: 'space-between',
                      fontSize: '13px',
                      marginBottom: '4px'
                    }}>
                      <span style={{ color: '#6b9b7a' }}>YTD Progress</span>
                      <span style={{ fontWeight: 600, color: '#2d5a3d' }}>
                        {project.actualHours}h / {project.plannedHours}h
                      </span>
                    </div>
                    <div style={{
                      width: '100%',
                      height: '8px',
                      background: '#e0e7e0',
                      borderRadius: '4px',
                      overflow: 'hidden'
                    }}>
                      <div style={{
                        width: `${Math.min(project.percentage, 100)}%`,
                        height: '100%',
                        background: project.percentage >= 100 ? '#4caf50' : 
                                   project.percentage >= 75 ? '#8bc34a' :
                                   project.percentage >= 50 ? '#ffc107' : '#ff9800',
                        transition: 'width 0.3s ease'
                      }}></div>
                    </div>
                    <div style={{ 
                      fontSize: '12px', 
                      color: '#6b9b7a',
                      marginTop: '4px',
                      textAlign: 'right'
                    }}>
                      {project.percentage}% complete
                    </div>
                  </div>

                  {project.percentage >= 100 && (
                    <div style={{
                      background: '#e8f5e9',
                      padding: '8px',
                      borderRadius: '4px',
                      fontSize: '12px',
                      color: '#2e7d32',
                      textAlign: 'center'
                    }}>
                      üéâ Goal achieved! Great job!
                    </div>
                  )}

                  {project.percentage < 100 && project.percentage > 0 && (
                    <div style={{
                      fontSize: '12px',
                      color: '#6b9b7a',
                      marginTop: '8px'
                    }}>
                      {project.plannedHours - project.actualHours > 0 ? 
                        `${(project.plannedHours - project.actualHours).toFixed(1)}h remaining` :
                        `${(project.actualHours - project.plannedHours).toFixed(1)}h over target`
                      }
                    </div>
                  )}
                </div>
              ))}
            </div>
          </div>

          {/* Weekly Journal Section */}
          <div style={{
            background: 'white',
            borderRadius: '16px',
            padding: '30px',
            marginTop: '30px',
            boxShadow: '0 4px 15px rgba(0,0,0,0.05)',
            border: '2px solid #e8f5eb'
          }}>
            <div style={{
              display: 'flex',
              alignItems: 'center',
              justifyContent: 'space-between',
              marginBottom: '20px'
            }}>
              <div>
                <h3 style={{
                  fontSize: '22px',
                  color: '#2d5a3d',
                  marginBottom: '8px',
                  display: 'flex',
                  alignItems: 'center',
                  gap: '12px'
                }}>
                  <span style={{ fontSize: '28px' }}>üìî</span>
                  <span>Weekly Journal</span>
                </h3>
                <p style={{ fontSize: '14px', color: '#6b9b7a', margin: 0 }}>
                  Reflect on your week and document your journey
                </p>
              </div>
            </div>
            
            {journalDocUrl ? (
              <div style={{
                background: 'linear-gradient(135deg, #f0f9f4 0%, #e0f0e8 100%)',
                padding: '20px',
                borderRadius: '12px',
                border: '2px solid #4a7c59'
              }}>
                <div style={{
                  display: 'flex',
                  alignItems: 'center',
                  justifyContent: 'space-between',
                  gap: '16px'
                }}>
                  <div style={{ flex: 1 }}>
                    <p style={{ 
                      fontSize: '13px', 
                      color: '#2d5a3d', 
                      marginBottom: '4px',
                      fontWeight: '600'
                    }}>
                      Your Journal is Ready! ‚ú®
                    </p>
                    <p style={{ 
                      fontSize: '12px', 
                      color: '#6b9b7a',
                      margin: 0
                    }}>
                      Click below to open your Google Doc and start writing
                    </p>
                  </div>
                  <div style={{ display: 'flex', gap: '8px' }}>
                    <button
                      onClick={() => window.open(journalDocUrl, '_blank')}
                      style={{
                        background: 'linear-gradient(135deg, #4a7c59 0%, #3d6b4a 100%)',
                        color: 'white',
                        border: 'none',
                        padding: '10px 20px',
                        borderRadius: '8px',
                        cursor: 'pointer',
                        fontSize: '14px',
                        fontWeight: '600',
                        display: 'flex',
                        alignItems: 'center',
                        gap: '6px',
                        boxShadow: '0 4px 12px rgba(74, 124, 89, 0.3)',
                        transition: 'all 0.2s'
                      }}
                      onMouseEnter={e => {
                        e.target.style.transform = 'translateY(-2px)';
                        e.target.style.boxShadow = '0 6px 16px rgba(74, 124, 89, 0.4)';
                      }}
                      onMouseLeave={e => {
                        e.target.style.transform = 'translateY(0)';
                        e.target.style.boxShadow = '0 4px 12px rgba(74, 124, 89, 0.3)';
                      }}
                    >
                      <span>üìù</span>
                      <span>Open Journal</span>
                    </button>
                    <button
                      onClick={() => setShowJournalModal(true)}
                      style={{
                        background: 'white',
                        color: '#4a7c59',
                        border: '2px solid #4a7c59',
                        padding: '10px 16px',
                        borderRadius: '8px',
                        cursor: 'pointer',
                        fontSize: '14px',
                        fontWeight: '500',
                        transition: 'all 0.2s'
                      }}
                      onMouseEnter={e => e.target.style.background = '#f0f9f4'}
                      onMouseLeave={e => e.target.style.background = 'white'}
                    >
                      ‚öôÔ∏è
                    </button>
                  </div>
                </div>
              </div>
            ) : (
              <div style={{
                background: '#fff8e1',
                padding: '20px',
                borderRadius: '12px',
                border: '2px dashed #ffc107',
                textAlign: 'center'
              }}>
                <p style={{ fontSize: '48px', margin: '0 0 16px 0' }}>üìù</p>
                <p style={{ 
                  fontSize: '15px', 
                  color: '#f57c00', 
                  marginBottom: '16px',
                  fontWeight: '600'
                }}>
                  Set up your weekly journal
                </p>
                <p style={{ 
                  fontSize: '13px', 
                  color: '#f57c00', 
                  marginBottom: '20px'
                }}>
                  Connect your Google Docs to start documenting your growth journey
                </p>
                <button
                  onClick={() => setShowJournalModal(true)}
                  style={{
                    background: 'linear-gradient(135deg, #ffc107 0%, #ffa000 100%)',
                    color: 'white',
                    border: 'none',
                    padding: '12px 24px',
                    borderRadius: '8px',
                    cursor: 'pointer',
                    fontSize: '14px',
                    fontWeight: '600',
                    boxShadow: '0 4px 12px rgba(255, 193, 7, 0.3)',
                    transition: 'all 0.2s'
                  }}
                  onMouseEnter={e => {
                    e.target.style.transform = 'translateY(-2px)';
                    e.target.style.boxShadow = '0 6px 16px rgba(255, 193, 7, 0.4)';
                  }}
                  onMouseLeave={e => {
                    e.target.style.transform = 'translateY(0)';
                    e.target.style.boxShadow = '0 4px 12px rgba(255, 193, 7, 0.3)';
                  }}
                >
                  üöÄ Setup Journal
                </button>
              </div>
            )}
          </div>
        );
      };

      const navigateCalendar = (direction) => {
        const newDate = new Date(currentDate);
        switch(view) {
          case 'daily':
            newDate.setDate(newDate.getDate() + direction);
            break;
          case 'weekly':
            newDate.setDate(newDate.getDate() + (direction * 7));
            break;
          case 'monthly':
            newDate.setMonth(newDate.getMonth() + direction);
            break;
          case 'yearly':
            newDate.setFullYear(newDate.getFullYear() + direction);
            break;
        }
        setCurrentDate(newDate);
      };

      return (
        <div>
          <div className="countdown-bar">
            {yearlyProjects.length === 0 && (
              <div className="countdown-item">
                <span>No yearly projects. Click settings to add up to 3 projects ‚Üí</span>
              </div>
            )}
            {yearlyProjects.map(project => {
              const daysLeft = getDaysUntil(project.deadline);
              return (
                <div key={project.id} className="countdown-item">
                  <Target />
                  <span>{daysLeft} Days until {project.name} DDL</span>
                </div>
              );
            })}
            <button className="countdown-settings" onClick={() => setShowProjectModal(true)}>
              üéØ
            </button>
          </div>

          <header className="app-header">
            <div className="header-left">
              <h1 
                onClick={() => setView('weekly')} 
                style={{ cursor: 'pointer', transition: 'color 0.2s' }}
                onMouseEnter={e => e.target.style.color = '#4a7c59'}
                onMouseLeave={e => e.target.style.color = '#2d5a3d'}
                title="Back to Weekly View"
              >
                TimeWise
              </h1>
              <div style={{ display: 'flex', alignItems: 'center', gap: '24px', marginTop: '12px' }}>
                <div className="view-switcher">
                  <button 
                    className={view === 'timeline' ? 'active' : ''}
                    onClick={() => setView('timeline')}
                  >
                    Timeline
                  </button>
                  <button 
                    className={view === 'daily' ? 'active' : ''}
                    onClick={() => setView('daily')}
                  >
                    Day
                  </button>
                  <button 
                    className={view === 'weekly' ? 'active' : ''}
                    onClick={() => setView('weekly')}
                  >
                    Week
                  </button>
                  <button 
                    className={view === 'monthly' ? 'active' : ''}
                    onClick={() => setView('monthly')}
                  >
                    Month
                  </button>
                  <button 
                    className={view === 'yearly' ? 'active' : ''}
                    onClick={() => setView('yearly')}
                  >
                    Year
                  </button>
                </div>
                <p style={{ 
                  fontSize: '17px', 
                  color: '#2d5a3d', 
                  fontWeight: '700',
                  fontStyle: 'italic',
                  margin: 0
                }}>
                  You don't have to. You choose to spend your time and life more consciously
                </p>
              </div>
            </div>

            <div className="header-right">
              {/* Tracking Streak */}
              {(() => {
                const streak = getTrackingStreak();
                return streak > 0 ? (
                  <div style={{
                    display: 'flex',
                    alignItems: 'center',
                    gap: '8px',
                    padding: '6px 12px',
                    background: 'linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%)',
                    borderRadius: '20px',
                    border: '2px solid #ff9800',
                    marginRight: '8px'
                  }}>
                    <span style={{ fontSize: '16px' }}>üî•</span>
                    <span style={{ fontSize: '14px', fontWeight: '600', color: '#e65100' }}>
                      {streak} day streak
                    </span>
                  </div>
                ) : null;
              })()}
              
              <button 
                className="btn-icon" 
                onClick={() => setShowExportModal(true)} 
                title="Export to Google Sheets"
              >
                üìã
              </button>
              <button 
                className="btn-icon" 
                onClick={() => setShowSyncModal(true)} 
                title="Google Calendar Sync"
                style={{ position: 'relative' }}
              >
                üîó
                {googleConnected && (
                  <span style={{ 
                    position: 'absolute', 
                    top: '6px', 
                    right: '6px', 
                    width: '8px', 
                    height: '8px', 
                    background: '#4caf50', 
                    borderRadius: '50%',
                    border: '2px solid white'
                  }}></span>
                )}
              </button>
              <button 
                className="btn-icon" 
                onClick={() => {
                  if (view !== 'weekly') setView('weekly');
                }} 
                title="Calendar View"
              >
                üìÖ
              </button>
              <button 
                className="btn-icon" 
                onClick={() => setShowAnalytics(true)} 
                title="Analytics"
              >
                üìä
              </button>
              <button className="btn-icon" onClick={() => setShowCategoryModal(true)} title="Manage Categories">
                üìì
              </button>
              <button className="btn-primary" onClick={() => setShowEventModal(true)}>
                <Plus /> New Event
              </button>
            </div>
          </header>

          <div className="calendar-nav">
            {view !== 'timeline' && (
              <button onClick={() => navigateCalendar(-1)}>
                <ChevronLeft />
              </button>
            )}
            <h2>
              {view === 'timeline' && `Project Timeline ${currentDate.getFullYear()}`}
              {view === 'yearly' && currentDate.getFullYear()}
              {view === 'monthly' && currentDate.toLocaleDateString('en-US', { month: 'long', year: 'numeric' })}
              {view === 'weekly' && `Week of ${currentDate.toLocaleDateString()}`}
              {view === 'daily' && currentDate.toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric', year: 'numeric' })}
            </h2>
            {view !== 'timeline' && (
              <>
                <button onClick={() => navigateCalendar(1)}>
                  <ChevronRight />
                </button>
                <button className="btn-today" onClick={() => setCurrentDate(new Date())}>Today</button>
              </>
            )}
            
            {view === 'daily' && (
              <div className="daily-toggle">
                <button 
                  className={dailyViewMode === 'calendar' ? 'active' : ''}
                  onClick={() => setDailyViewMode('calendar')}
                >
                  <Grid /> Calendar
                </button>
                <button 
                  className={dailyViewMode === 'todolist' ? 'active' : ''}
                  onClick={() => setDailyViewMode('todolist')}
                >
                  <List /> Todo List
                </button>
              </div>
            )}
          </div>

          <main className="main-content" key={viewRefreshKey}>
            {showAnalytics && <Analytics />}
            
            {!showAnalytics && view === 'timeline' && <ProjectTimelineView />}
            
            {!showAnalytics && view === 'monthly' && <MonthlyView />}
            
            {!showAnalytics && view === 'weekly' && <WeeklyView />}
            
            {!showAnalytics && view === 'daily' && dailyViewMode === 'calendar' && <DailyView />}
            
            {!showAnalytics && view === 'daily' && dailyViewMode === 'todolist' && <DailyTodoListView />}
            
            {!showAnalytics && view === 'yearly' && <YearView />}
          </main>

          {showEventModal && <EventModal />}
          {showCategoryModal && <CategoryModal />}
          {showProjectModal && <ProjectModal />}
          {showSyncModal && <GoogleSyncModal />}
          {showCompletionModal && <CompletionModal />}
          {showExportModal && <ExportModal />}
          {showGoogleSetupModal && <GoogleSetupModal />}
          {showJournalModal && <JournalModal />}
          {showWeeklyReflectionModal && <WeeklyReflectionModal />}
        </div>
      );
    };

    ReactDOM.render(<App />, document.getElementById('root'));
  </script>
</body>
</html>
